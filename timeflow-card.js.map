{"version":3,"file":"timeflow-card.js","sources":["node_modules/tslib/tslib.es6.js","node_modules/@lit/reactive-element/css-tag.js","node_modules/@lit/reactive-element/reactive-element.js","node_modules/lit-html/lit-html.js","node_modules/lit-element/lit-element.js","node_modules/@lit/reactive-element/decorators/property.js","node_modules/@lit/reactive-element/decorators/state.js","src/services/StandardTimer.ts","src/services/AlexaTimer.ts","src/services/GoogleTimer.ts","src/services/Timer.ts","src/utils/DateParser.ts","src/utils/ConfigValidator.ts","src/services/TemplateService.ts","src/types/index.ts","src/utils/TimeUtils.ts","src/services/CountdownService.ts","src/utils/StyleManager.ts","src/utils/localize.ts","node_modules/lit-html/directive.js","src/utils/handle-action.ts","src/utils/action-handler.ts","src/utils/ErrorDisplay.ts","src/components/TimeFlowCard.ts","src/components/ProgressCircle.ts","src/components/TimeFlowCardEditor.ts","src/index.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,e=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&\"adoptedStyleSheets\"in Document.prototype&&\"replace\"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class n{constructor(t,e,o){if(this._$cssResult$=!0,o!==s)throw Error(\"CSSResult is not constructable. Use `unsafeCSS` or `css` instead.\");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const s=this.t;if(e&&void 0===t){const e=void 0!==s&&1===s.length;e&&(t=o.get(s)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&o.set(s,t))}return t}toString(){return this.cssText}}const r=t=>new n(\"string\"==typeof t?t:t+\"\",void 0,s),i=(t,...e)=>{const o=1===t.length?t[0]:e.reduce(((e,s,o)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if(\"number\"==typeof t)return t;throw Error(\"Value passed to 'css' function must be a 'css' function result: \"+t+\". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.\")})(s)+t[o+1]),t[0]);return new n(o,t,s)},S=(s,o)=>{if(e)s.adoptedStyleSheets=o.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const e of o){const o=document.createElement(\"style\"),n=t.litNonce;void 0!==n&&o.setAttribute(\"nonce\",n),o.textContent=e.cssText,s.appendChild(o)}},c=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e=\"\";for(const s of t.cssRules)e+=s.cssText;return r(e)})(t):t;export{n as CSSResult,S as adoptStyles,i as css,c as getCompatibleStyle,e as supportsAdoptingStyleSheets,r as unsafeCSS};\n//# sourceMappingURL=css-tag.js.map\n","import{getCompatibleStyle as t,adoptStyles as s}from\"./css-tag.js\";export{CSSResult,css,supportsAdoptingStyleSheets,unsafeCSS}from\"./css-tag.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{is:i,defineProperty:e,getOwnPropertyDescriptor:h,getOwnPropertyNames:r,getOwnPropertySymbols:o,getPrototypeOf:n}=Object,a=globalThis,c=a.trustedTypes,l=c?c.emptyScript:\"\",p=a.reactiveElementPolyfillSupport,d=(t,s)=>t,u={toAttribute(t,s){switch(s){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,s){let i=t;switch(s){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},f=(t,s)=>!i(t,s),b={attribute:!0,type:String,converter:u,reflect:!1,useDefault:!1,hasChanged:f};Symbol.metadata??=Symbol(\"metadata\"),a.litPropertyMetadata??=new WeakMap;class y extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,s=b){if(s.state&&(s.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((s=Object.create(s)).wrapped=!0),this.elementProperties.set(t,s),!s.noAccessor){const i=Symbol(),h=this.getPropertyDescriptor(t,i,s);void 0!==h&&e(this.prototype,t,h)}}static getPropertyDescriptor(t,s,i){const{get:e,set:r}=h(this.prototype,t)??{get(){return this[s]},set(t){this[s]=t}};return{get:e,set(s){const h=e?.call(this);r?.call(this,s),this.requestUpdate(t,h,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??b}static _$Ei(){if(this.hasOwnProperty(d(\"elementProperties\")))return;const t=n(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(d(\"finalized\")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d(\"properties\"))){const t=this.properties,s=[...r(t),...o(t)];for(const i of s)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const s=litPropertyMetadata.get(t);if(void 0!==s)for(const[t,i]of s)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,s]of this.elementProperties){const i=this._$Eu(t,s);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const i=[];if(Array.isArray(s)){const e=new Set(s.flat(1/0).reverse());for(const s of e)i.unshift(t(s))}else void 0!==s&&i.push(t(s));return i}static _$Eu(t,s){const i=s.attribute;return!1===i?void 0:\"string\"==typeof i?i:\"string\"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,s=this.constructor.elementProperties;for(const i of s.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return s(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,s,i){this._$AK(t,i)}_$ET(t,s){const i=this.constructor.elementProperties.get(t),e=this.constructor._$Eu(t,i);if(void 0!==e&&!0===i.reflect){const h=(void 0!==i.converter?.toAttribute?i.converter:u).toAttribute(s,i.type);this._$Em=t,null==h?this.removeAttribute(e):this.setAttribute(e,h),this._$Em=null}}_$AK(t,s){const i=this.constructor,e=i._$Eh.get(t);if(void 0!==e&&this._$Em!==e){const t=i.getPropertyOptions(e),h=\"function\"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:u;this._$Em=e;const r=h.fromAttribute(s,t.type);this[e]=r??this._$Ej?.get(e)??r,this._$Em=null}}requestUpdate(t,s,i){if(void 0!==t){const e=this.constructor,h=this[t];if(i??=e.getPropertyOptions(t),!((i.hasChanged??f)(h,s)||i.useDefault&&i.reflect&&h===this._$Ej?.get(t)&&!this.hasAttribute(e._$Eu(t,i))))return;this.C(t,s,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,s,{useDefault:i,reflect:e,wrapped:h},r){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,r??s??this[t]),!0!==h||void 0!==r)||(this._$AL.has(t)||(this.hasUpdated||i||(s=void 0),this._$AL.set(t,s)),!0===e&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,s]of this._$Ep)this[t]=s;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[s,i]of t){const{wrapped:t}=i,e=this[s];!0!==t||this._$AL.has(s)||void 0===e||this.C(s,void 0,i,e)}}let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),this._$EO?.forEach((t=>t.hostUpdate?.())),this.update(s)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(s)}willUpdate(t){}_$AE(t){this._$EO?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((t=>this._$ET(t,this[t]))),this._$EM()}updated(t){}firstUpdated(t){}}y.elementStyles=[],y.shadowRootOptions={mode:\"open\"},y[d(\"elementProperties\")]=new Map,y[d(\"finalized\")]=new Map,p?.({ReactiveElement:y}),(a.reactiveElementVersions??=[]).push(\"2.1.1\");export{y as ReactiveElement,s as adoptStyles,u as defaultConverter,t as getCompatibleStyle,f as notEqual};\n//# sourceMappingURL=reactive-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,i=t.trustedTypes,s=i?i.createPolicy(\"lit-html\",{createHTML:t=>t}):void 0,e=\"$lit$\",h=`lit$${Math.random().toFixed(9).slice(2)}$`,o=\"?\"+h,n=`<${o}>`,r=document,l=()=>r.createComment(\"\"),c=t=>null===t||\"object\"!=typeof t&&\"function\"!=typeof t,a=Array.isArray,u=t=>a(t)||\"function\"==typeof t?.[Symbol.iterator],d=\"[ \\t\\n\\f\\r]\",f=/<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))/g,v=/-->/g,_=/>/g,m=RegExp(`>|${d}(?:([^\\\\s\"'>=/]+)(${d}*=${d}*(?:[^ \\t\\n\\f\\r\"'\\`<>=]|(\"|')|))|$)`,\"g\"),p=/'/g,g=/\"/g,$=/^(?:script|style|textarea|title)$/i,y=t=>(i,...s)=>({_$litType$:t,strings:i,values:s}),x=y(1),b=y(2),w=y(3),T=Symbol.for(\"lit-noChange\"),E=Symbol.for(\"lit-nothing\"),A=new WeakMap,C=r.createTreeWalker(r,129);function P(t,i){if(!a(t)||!t.hasOwnProperty(\"raw\"))throw Error(\"invalid template strings array\");return void 0!==s?s.createHTML(i):i}const V=(t,i)=>{const s=t.length-1,o=[];let r,l=2===i?\"<svg>\":3===i?\"<math>\":\"\",c=f;for(let i=0;i<s;i++){const s=t[i];let a,u,d=-1,y=0;for(;y<s.length&&(c.lastIndex=y,u=c.exec(s),null!==u);)y=c.lastIndex,c===f?\"!--\"===u[1]?c=v:void 0!==u[1]?c=_:void 0!==u[2]?($.test(u[2])&&(r=RegExp(\"</\"+u[2],\"g\")),c=m):void 0!==u[3]&&(c=m):c===m?\">\"===u[0]?(c=r??f,d=-1):void 0===u[1]?d=-2:(d=c.lastIndex-u[2].length,a=u[1],c=void 0===u[3]?m:'\"'===u[3]?g:p):c===g||c===p?c=m:c===v||c===_?c=f:(c=m,r=void 0);const x=c===m&&t[i+1].startsWith(\"/>\")?\" \":\"\";l+=c===f?s+n:d>=0?(o.push(a),s.slice(0,d)+e+s.slice(d)+h+x):s+h+(-2===d?i:x)}return[P(t,l+(t[s]||\"<?>\")+(2===i?\"</svg>\":3===i?\"</math>\":\"\")),o]};class N{constructor({strings:t,_$litType$:s},n){let r;this.parts=[];let c=0,a=0;const u=t.length-1,d=this.parts,[f,v]=V(t,s);if(this.el=N.createElement(f,n),C.currentNode=this.el.content,2===s||3===s){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(r=C.nextNode())&&d.length<u;){if(1===r.nodeType){if(r.hasAttributes())for(const t of r.getAttributeNames())if(t.endsWith(e)){const i=v[a++],s=r.getAttribute(t).split(h),e=/([.?@])?(.*)/.exec(i);d.push({type:1,index:c,name:e[2],strings:s,ctor:\".\"===e[1]?H:\"?\"===e[1]?I:\"@\"===e[1]?L:k}),r.removeAttribute(t)}else t.startsWith(h)&&(d.push({type:6,index:c}),r.removeAttribute(t));if($.test(r.tagName)){const t=r.textContent.split(h),s=t.length-1;if(s>0){r.textContent=i?i.emptyScript:\"\";for(let i=0;i<s;i++)r.append(t[i],l()),C.nextNode(),d.push({type:2,index:++c});r.append(t[s],l())}}}else if(8===r.nodeType)if(r.data===o)d.push({type:2,index:c});else{let t=-1;for(;-1!==(t=r.data.indexOf(h,t+1));)d.push({type:7,index:c}),t+=h.length-1}c++}}static createElement(t,i){const s=r.createElement(\"template\");return s.innerHTML=t,s}}function S(t,i,s=t,e){if(i===T)return i;let h=void 0!==e?s._$Co?.[e]:s._$Cl;const o=c(i)?void 0:i._$litDirective$;return h?.constructor!==o&&(h?._$AO?.(!1),void 0===o?h=void 0:(h=new o(t),h._$AT(t,s,e)),void 0!==e?(s._$Co??=[])[e]=h:s._$Cl=h),void 0!==h&&(i=S(t,h._$AS(t,i.values),h,e)),i}class M{constructor(t,i){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:i},parts:s}=this._$AD,e=(t?.creationScope??r).importNode(i,!0);C.currentNode=e;let h=C.nextNode(),o=0,n=0,l=s[0];for(;void 0!==l;){if(o===l.index){let i;2===l.type?i=new R(h,h.nextSibling,this,t):1===l.type?i=new l.ctor(h,l.name,l.strings,this,t):6===l.type&&(i=new z(h,this,t)),this._$AV.push(i),l=s[++n]}o!==l?.index&&(h=C.nextNode(),o++)}return C.currentNode=r,e}p(t){let i=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(t,s,i),i+=s.strings.length-2):s._$AI(t[i])),i++}}class R{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,i,s,e){this.type=2,this._$AH=E,this._$AN=void 0,this._$AA=t,this._$AB=i,this._$AM=s,this.options=e,this._$Cv=e?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const i=this._$AM;return void 0!==i&&11===t?.nodeType&&(t=i.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,i=this){t=S(this,t,i),c(t)?t===E||null==t||\"\"===t?(this._$AH!==E&&this._$AR(),this._$AH=E):t!==this._$AH&&t!==T&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):u(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==E&&c(this._$AH)?this._$AA.nextSibling.data=t:this.T(r.createTextNode(t)),this._$AH=t}$(t){const{values:i,_$litType$:s}=t,e=\"number\"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=N.createElement(P(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===e)this._$AH.p(i);else{const t=new M(e,this),s=t.u(this.options);t.p(i),this.T(s),this._$AH=t}}_$AC(t){let i=A.get(t.strings);return void 0===i&&A.set(t.strings,i=new N(t)),i}k(t){a(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,e=0;for(const h of t)e===i.length?i.push(s=new R(this.O(l()),this.O(l()),this,this.options)):s=i[e],s._$AI(h),e++;e<i.length&&(this._$AR(s&&s._$AB.nextSibling,e),i.length=e)}_$AR(t=this._$AA.nextSibling,i){for(this._$AP?.(!1,!0,i);t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class k{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,i,s,e,h){this.type=1,this._$AH=E,this._$AN=void 0,this.element=t,this.name=i,this._$AM=e,this.options=h,s.length>2||\"\"!==s[0]||\"\"!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=E}_$AI(t,i=this,s,e){const h=this.strings;let o=!1;if(void 0===h)t=S(this,t,i,0),o=!c(t)||t!==this._$AH&&t!==T,o&&(this._$AH=t);else{const e=t;let n,r;for(t=h[0],n=0;n<h.length-1;n++)r=S(this,e[s+n],i,n),r===T&&(r=this._$AH[n]),o||=!c(r)||r!==this._$AH[n],r===E?t=E:t!==E&&(t+=(r??\"\")+h[n+1]),this._$AH[n]=r}o&&!e&&this.j(t)}j(t){t===E?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??\"\")}}class H extends k{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===E?void 0:t}}class I extends k{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==E)}}class L extends k{constructor(t,i,s,e,h){super(t,i,s,e,h),this.type=5}_$AI(t,i=this){if((t=S(this,t,i,0)??E)===T)return;const s=this._$AH,e=t===E&&s!==E||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,h=t!==E&&(s===E||e);e&&this.element.removeEventListener(this.name,this,s),h&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){\"function\"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class z{constructor(t,i,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=i,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){S(this,t)}}const Z={M:e,P:h,A:o,C:1,L:V,R:M,D:u,V:S,I:R,H:k,N:I,U:L,B:H,F:z},j=t.litHtmlPolyfillSupport;j?.(N,R),(t.litHtmlVersions??=[]).push(\"3.3.1\");const B=(t,i,s)=>{const e=s?.renderBefore??i;let h=e._$litPart$;if(void 0===h){const t=s?.renderBefore??null;e._$litPart$=h=new R(i.insertBefore(l(),t),t,void 0,s??{})}return h._$AI(t),h};export{Z as _$LH,x as html,w as mathml,T as noChange,E as nothing,B as render,b as svg};\n//# sourceMappingURL=lit-html.js.map\n","import{ReactiveElement as t}from\"@lit/reactive-element\";export*from\"@lit/reactive-element\";import{render as e,noChange as r}from\"lit-html\";export*from\"lit-html\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=globalThis;class i extends t{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=e(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return r}}i._$litElement$=!0,i[\"finalized\"]=!0,s.litElementHydrateSupport?.({LitElement:i});const o=s.litElementPolyfillSupport;o?.({LitElement:i});const n={_$AK:(t,e,r)=>{t._$AK(e,r)},_$AL:t=>t._$AL};(s.litElementVersions??=[]).push(\"4.2.1\");export{i as LitElement,n as _$LE};\n//# sourceMappingURL=lit-element.js.map\n","import{defaultConverter as t,notEqual as e}from\"../reactive-element.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const o={attribute:!0,type:String,converter:t,reflect:!1,hasChanged:e},r=(t=o,e,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(void 0===s&&globalThis.litPropertyMetadata.set(i,s=new Map),\"setter\"===n&&((t=Object.create(t)).wrapped=!0),s.set(r.name,t),\"accessor\"===n){const{name:o}=r;return{set(r){const n=e.get.call(this);e.set.call(this,r),this.requestUpdate(o,n,t)},init(e){return void 0!==e&&this.C(o,void 0,t,e),e}}}if(\"setter\"===n){const{name:o}=r;return function(r){const n=this[o];e.call(this,r),this.requestUpdate(o,n,t)}}throw Error(\"Unsupported decorator location: \"+n)};function n(t){return(e,o)=>\"object\"==typeof o?r(t,e,o):((t,e,o)=>{const r=e.hasOwnProperty(o);return e.constructor.createProperty(o,t),r?Object.getOwnPropertyDescriptor(e,o):void 0})(t,e,o)}export{n as property,r as standardProperty};\n//# sourceMappingURL=property.js.map\n","import{property as t}from\"./property.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function r(r){return t({...r,state:!0,attribute:!1})}export{r as state};\n//# sourceMappingURL=state.js.map\n","import { HomeAssistant } from '../types/index';\nimport { TimerData } from './Timer';\n\n/**\n * StandardTimerService - Handles Home Assistant native timer entities\n * Focused on timer.* domain entities with standard HA timer behavior\n */\nexport class StandardTimerService {\n  /**\n   * Handles standard HA timer data extraction\n   * @param entityId - Timer entity ID\n   * @param entity - Entity state object\n   * @param parseDuration - Duration parsing utility function\n   * @returns TimerData for standard timer\n   */\n  static getStandardTimerData(\n    entityId: string, \n    entity: any, \n    parseDuration: (duration: any) => number\n  ): TimerData | null {\n    const state = entity.state;\n    const attributes = entity.attributes;\n\n    // Timer states: idle, active, paused\n    const isActive = state === 'active';\n    const isPaused = state === 'paused';\n    const isIdle = state === 'idle';\n\n    // Get duration from attributes (in seconds or HH:MM:SS format)\n    let duration = 0;\n    if (attributes.duration) {\n      duration = parseDuration(attributes.duration);\n    }\n\n    // Calculate remaining time\n    let remaining = 0;\n    let finishesAt: Date | null = null;\n\n    if (isActive || isPaused) {\n      if (attributes.finishes_at) {\n        // Parse finishes_at timestamp\n        finishesAt = new Date(attributes.finishes_at);\n        if (!isNaN(finishesAt.getTime())) {\n          remaining = Math.max(0, Math.floor((finishesAt.getTime() - Date.now()) / 1000));\n        }\n      } else if (attributes.remaining) {\n        // Fallback to remaining attribute if available\n        remaining = parseDuration(attributes.remaining);\n      }\n    }\n\n    // Calculate progress (0-100)\n    let progress = 0;\n    if (duration > 0) {\n      if (isIdle) {\n        progress = 0;\n      } else {\n        const elapsed = duration - remaining;\n        progress = Math.min(100, Math.max(0, (elapsed / duration) * 100));\n      }\n    }\n\n    return {\n      isActive,\n      isPaused,\n      duration,\n      remaining,\n      finishesAt,\n      progress,\n      isAlexaTimer: false\n    };\n  }\n}\n","import { HomeAssistant } from '../types/index';\nimport { TimerData } from './Timer';\n\n/**\n * AlexaTimerService - Handles Amazon Alexa Media Player timer entities\n * Focused on sensor.*_next_timer entities with rich Alexa timer attributes\n */\nexport class AlexaTimerService {\n  // Per-entity cache to track Alexa timer IDs and transitions\n  private static alexaIdCache: Map<string, { finishedWhileActiveId?: string }> = new Map();\n\n  /**\n   * Handles Alexa timer data extraction\n   * @param entityId - Alexa timer entity ID\n   * @param entity - Entity state object\n   * @param hass - Home Assistant object\n   * @param isISOTimestamp - ISO timestamp validation function\n   * @param parseDuration - Duration parsing utility function\n   * @returns TimerData for Alexa timer\n   */\n  static getAlexaTimerData(\n    entityId: string, \n    entity: any, \n    hass: HomeAssistant,\n    isISOTimestamp: (str: string) => boolean,\n    parseDuration: (duration: any) => number\n  ): TimerData | null {\n    const { state, attributes } = entity;\n\n    // 1) Parse rich JSON first (status authority comes from attributes, not entity.state)\n    const activeTimers = this.parseJson(attributes.sorted_active) ?? [];\n    const allTimers    = this.parseJson(attributes.sorted_all)    ?? [];\n    const totalActive: number = (attributes.total_active as number) ?? activeTimers.length ?? 0;\n    const totalAll: number    = (attributes.total_all as number)    ?? allTimers.length    ?? 0;\n\n    // Build quick lookups keyed by the ID (handles both tuple and object formats)\n    const activeMap = new Map<string, any>();\n    for (const t of activeTimers) {\n      const entry = this.extractTimerEntry(t);\n      if (entry) {\n        activeMap.set(entry.id, entry.data);\n      }\n    }\n    const allMap = new Map<string, any>();\n    for (const t of allTimers) {\n      const entry = this.extractTimerEntry(t);\n      if (entry) {\n        allMap.set(entry.id, entry.data);\n      }\n    }\n\n    // ID-based finished tracking: if an active timer's triggerTime has passed, remember that ID\n    const nowTs = Date.now();\n    let cache = this.alexaIdCache.get(entityId);\n    if (!cache) { cache = {}; this.alexaIdCache.set(entityId, cache); }\n    // Determine candidates that have finished but are still listed as active\n    const finishedActiveIds: Array<{ id: string; trig: number }> = [];\n    for (const [id, data] of activeMap.entries()) {\n      const trig = typeof data?.triggerTime === 'number' ? data.triggerTime : 0;\n      if (trig && trig <= nowTs) {\n        finishedActiveIds.push({ id, trig });\n      }\n    }\n    if (finishedActiveIds.length > 0) {\n      // Choose the one that should have finished earliest\n      finishedActiveIds.sort((a, b) => a.trig - b.trig);\n      cache.finishedWhileActiveId = finishedActiveIds[0].id;\n    } else if (cache.finishedWhileActiveId && !activeMap.has(cache.finishedWhileActiveId)) {\n      // Clear once the finished item leaves the active list\n      delete cache.finishedWhileActiveId;\n    }\n\n    // Determine state: Active > Paused > Finished > None\n    let isActive = false;\n    let isPaused = false;\n    let isFinished = false;\n    let primaryTimer: any | null = null;\n    let primaryId: string | undefined;\n\n    if (totalActive > 0 && activeTimers.length > 0) {\n      // Prefer the ID we know just finished while still listed as active\n      if (cache.finishedWhileActiveId && activeMap.has(cache.finishedWhileActiveId)) {\n        primaryId = cache.finishedWhileActiveId;\n        primaryTimer = activeMap.get(primaryId) ?? null;\n        isActive = !!primaryTimer;\n        isFinished = true; // enforce finished view for this ID\n      } else {\n        // Choose the active timer (prefer the one with shortest remainingTime)\n        if (activeTimers.length === 1) {\n          const entry = this.extractTimerEntry(activeTimers[0]);\n          primaryId = entry?.id;\n          primaryTimer = entry?.data ?? null;\n        } else {\n          let bestId: string | undefined;\n          let best: any = null;\n          let shortest = Number.POSITIVE_INFINITY;\n          for (const t of activeTimers) {\n            const entry = this.extractTimerEntry(t);\n            if (entry && typeof entry.data?.remainingTime === 'number' && entry.data.remainingTime < shortest) {\n              shortest = entry.data.remainingTime;\n              best = entry.data;\n              bestId = entry.id;\n            }\n          }\n          primaryId = bestId;\n          primaryTimer = best;\n        }\n        isActive = !!primaryTimer;\n        // Edge: if the selected active timer is actually past its trigger, mark finished\n        if (isActive && primaryTimer && typeof primaryTimer.triggerTime === 'number' && primaryTimer.triggerTime <= nowTs) {\n          isFinished = true;\n          cache.finishedWhileActiveId = primaryId; // remember which one\n        }\n      }\n    } else if (totalAll > 0 && allTimers.length > 0) {\n      // No active timers: prefer a paused timer if any; do not show finished based solely on sorted_all\n      // Find the most recently updated paused timer\n      let mostRecentPaused: any = null;\n      let latest = -Infinity;\n      for (const [id, data] of allMap.entries()) {\n        if (data?.status === 'PAUSED') {\n          const updated = typeof data.lastUpdatedDate === 'number' ? data.lastUpdatedDate : -Infinity;\n          if (updated > latest) {\n            latest = updated;\n            mostRecentPaused = data;\n            primaryId = id;\n          }\n        }\n      }\n      if (mostRecentPaused) {\n        primaryTimer = mostRecentPaused;\n        isPaused = true;\n      }\n    }\n\n    // 2) Compute duration/remaining/progress, preferring rich data; fallback to legacy entity.state\n    let remaining = 0;\n    let duration = 0;\n    let finishesAt: Date | null = null;\n    let progress = 0;\n\n    if (primaryTimer) {\n      const now = Date.now();\n      const rtMs = typeof primaryTimer.remainingTime === 'number' ? primaryTimer.remainingTime : 0; // ms\n      const odMs = typeof primaryTimer.originalDurationInMillis === 'number' ? primaryTimer.originalDurationInMillis : 0; // ms\n      const trig = typeof primaryTimer.triggerTime === 'number' ? primaryTimer.triggerTime : 0; // epoch ms\n\n      duration = Math.max(0, Math.floor(odMs / 1000));\n\n    if (isActive) {\n        // Prefer triggerTime for live ticking\n        if (trig && trig > now) {\n          remaining = Math.max(0, Math.floor((trig - now) / 1000));\n          finishesAt = new Date(trig);\n        } else {\n          // Fallback to remainingTime snapshot\n          remaining = Math.max(0, Math.floor(rtMs / 1000));\n          if (remaining > 0) finishesAt = new Date(now + remaining * 1000);\n        }\n\n        // If we've passed triggerTime or remaining is zero, mark as finished, but keep active until it leaves sorted_active\n        if ((trig && trig <= now) || remaining <= 0 || (primaryTimer.status === 'OFF' && rtMs === 0)) {\n          remaining = 0;\n          finishesAt = null;\n          isFinished = true;\n        }\n    } else if (isPaused) {\n        // While paused, trust remainingTime snapshot and do not set finishesAt\n        remaining = Math.max(0, Math.floor(rtMs / 1000));\n        finishesAt = null;\n      } else {\n        // Idle/none selected in no-active case: leave remaining at 0\n        remaining = Math.max(0, Math.floor(rtMs / 1000));\n        finishesAt = null;\n      }\n\n    if (duration > 0) {\n        const elapsed = Math.max(0, duration - remaining);\n        progress = Math.min(100, Math.max(0, (elapsed / duration) * 100));\n        // If still in active list but progress reached 100, enforce finished view\n        if (isActive && progress >= 100) {\n          remaining = 0;\n          isFinished = true;\n        }\n      }\n    } else {\n      // Legacy fallback for remaining/duration when no rich item is available\n      if (state && state !== 'unavailable' && state !== 'unknown') {\n        if (isISOTimestamp(state)) {\n          finishesAt = new Date(state);\n          if (!isNaN(finishesAt.getTime())) {\n            remaining = Math.max(0, Math.floor((finishesAt.getTime() - Date.now()) / 1000));\n          }\n        } else if (!isNaN(parseFloat(state))) {\n          remaining = Math.max(0, parseFloat(state));\n        } else if (typeof state === 'string' && state.includes(':')) {\n          remaining = parseDuration(state);\n        }\n      }\n\n      if (attributes.original_duration) {\n        duration = parseDuration(attributes.original_duration);\n      } else if (attributes.duration) {\n        duration = parseDuration(attributes.duration);\n      } else if (finishesAt && entity.last_changed) {\n        const start = new Date(entity.last_changed).getTime();\n        const end   = finishesAt.getTime();\n        if (!isNaN(start) && end > start) duration = Math.floor((end - start) / 1000);\n      }\n\n      if (duration > 0) {\n        const elapsed = duration - remaining;\n        progress = Math.min(100, Math.max(0, (elapsed / duration) * 100));\n      }\n    }\n\n    // Note: Do not collapse to \"No timers\" based solely on a dismissed flag.\n    // We'll show \"timer complete\" as long as a finished timer exists in sorted_all.\n\n    // 3) Label selection (prefer label from primary timer)\n    // Use extractTimerLabel to handle both timerLabel and label fields\n    let label: string | undefined = this.extractTimerLabel(primaryTimer);\n    if (!label && activeTimers.length > 0) {\n      const firstActive = this.extractTimerEntry(activeTimers[0]);\n      label = this.extractTimerLabel(firstActive?.data);\n    }\n    if (!label && allTimers.length > 0) {\n      const firstAll = this.extractTimerEntry(allTimers[0]);\n      label = this.extractTimerLabel(firstAll?.data);\n    }\n\n    return {\n      isActive,\n    isPaused,\n      duration,\n      remaining,\n      finishesAt,\n    progress,\n    finished: isFinished,\n      isAlexaTimer: true,\n      alexaDevice: this.extractAlexaDevice(entityId, attributes),\n      timerLabel: label ?? this.extractAlexaDevice(entityId, attributes),\n    timerStatus: isPaused ? 'PAUSED' : (isActive ? 'ON' : 'OFF'),\n      userDefinedLabel: label,\n    };\n  }\n\n  /**\n   * Legacy fallback for Alexa timer parsing (when rich attributes unavailable)\n   * @param entityId - Entity ID\n   * @param entity - Entity object\n   * @param state - Entity state\n   * @param attributes - Entity attributes\n   * @param isISOTimestamp - ISO timestamp validation function\n   * @param parseDuration - Duration parsing utility function\n   * @returns TimerData object\n   */\n  static parseLegacyAlexaTimer(\n    entityId: string, \n    entity: any, \n    state: any, \n    attributes: any,\n    isISOTimestamp: (str: string) => boolean,\n    parseDuration: (duration: any) => number\n  ): TimerData | null {\n    // Alexa timers might be stored as timestamps or duration strings\n    let remaining = 0;\n    let duration = 0;\n    let finishesAt: Date | null = null;\n    let isActive = false;\n    \n    // Handle different Alexa timer formats\n    if (state && state !== 'unavailable' && state !== 'unknown') {\n      // Case 1: State is a timestamp (end time)\n      if (isISOTimestamp(state)) {\n        finishesAt = new Date(state);\n        if (!isNaN(finishesAt.getTime())) {\n          const now = Date.now();\n          remaining = Math.max(0, Math.floor((finishesAt.getTime() - now) / 1000));\n          isActive = remaining > 0;\n        }\n      }\n      // Case 2: State is duration in seconds\n      else if (!isNaN(parseFloat(state))) {\n        remaining = Math.max(0, parseFloat(state));\n        isActive = remaining > 0;\n      }\n      // Case 3: State is duration string (HH:MM:SS)\n      else if (typeof state === 'string' && state.includes(':')) {\n        remaining = parseDuration(state);\n        isActive = remaining > 0;\n      }\n    }\n\n    // Try to get duration from attributes\n    let hasOriginalDuration = false;\n    if (attributes.original_duration) {\n      duration = parseDuration(attributes.original_duration);\n      hasOriginalDuration = true;\n    } else if (attributes.duration) {\n      duration = parseDuration(attributes.duration);\n      hasOriginalDuration = true;\n    } else if (finishesAt && entity.last_changed) {\n      // Try to calculate duration from finishesAt and last_changed (when timer was set)\n      const startTime = new Date(entity.last_changed).getTime();\n      const endTime = finishesAt.getTime();\n      if (!isNaN(startTime) && endTime > startTime) {\n        duration = Math.floor((endTime - startTime) / 1000);\n        hasOriginalDuration = true;\n      }\n    }\n    \n    if (!hasOriginalDuration) {\n      // If no original duration, we can't calculate meaningful progress\n      // For display purposes, we'll use remaining as duration, but handle progress specially\n      duration = remaining > 0 ? remaining : 0;\n      hasOriginalDuration = false;\n    }\n\n    // Calculate progress - IMPROVED LOGIC based on timer-bar-card approach\n    let progress = 0;\n    if (hasOriginalDuration && duration > 0) {\n      // We have a real original duration, calculate normal progress\n      if (isActive && remaining >= 0) {\n        const elapsed = duration - remaining;\n        progress = Math.min(100, Math.max(0, (elapsed / duration) * 100));\n      } else if (remaining === 0 && duration > 0) {\n        progress = 100; // Timer finished (only if we had a real duration)\n      }\n    } else {\n      // No original duration available - handle differently for better accuracy\n      if (isActive && remaining > 0) {\n        // For Alexa timers without original duration, we need to be smarter\n        // Option 1: Use entity's last_changed to estimate start time\n        const lastChanged = entity.last_changed ? new Date(entity.last_changed).getTime() : Date.now();\n        const now = Date.now();\n        const timeSinceChanged = (now - lastChanged) / 1000; // seconds\n        \n        // If the timer was recently updated, we can estimate duration\n        if (timeSinceChanged < remaining) {\n          const estimatedDuration = remaining + timeSinceChanged;\n          const elapsed = timeSinceChanged;\n          progress = Math.min(100, Math.max(0, (elapsed / estimatedDuration) * 100));\n        } else {\n          // Fallback: start progress from 0% for active timers without duration\n          // This prevents the \"75%\" issue you're experiencing\n          progress = 0;\n        }\n      } else {\n        // No active timer OR no remaining time\n        // Check if this is actually a \"no timer\" state vs \"timer finished\" state\n        if (state === 'unavailable' || state === 'unknown' || state === 'none' || state === null || state === '') {\n          progress = 0; // No timer present - show empty progress\n        } else if (remaining === 0 && (isActive === false)) {\n          // This could be a finished timer, but without original duration we can't be sure\n          // Default to empty progress to avoid showing full progress incorrectly\n          progress = 0;\n        } else {\n          progress = 0; // Default case\n        }\n      }\n    }\n\n    // Extract Alexa-specific info using legacy methods\n    const alexaDevice = this.extractAlexaDevice(entityId, attributes);\n    const timerLabel = attributes.friendly_name || attributes.timer_label || this.formatAlexaTimerName(entityId);\n\n    return {\n      isActive,\n      isPaused: false, // Alexa timers don't typically pause in legacy mode\n      duration,\n      remaining,\n      finishesAt,\n      progress,\n      isAlexaTimer: true,\n      alexaDevice,\n      timerLabel,\n      timerStatus: isActive ? \"ON\" : \"OFF\",\n      userDefinedLabel: undefined // Not available in legacy mode\n    };\n  }\n\n  /**\n   * AUTO-DISCOVERY: Attempts to find Alexa timer entities in Home Assistant\n   * @param hass - Home Assistant object\n   * @param isAlexaTimer - Alexa timer detection function\n   * @param getTimerData - Timer data extraction function\n   * @returns string[] - Array of potential Alexa timer entity IDs\n   */\n  static discoverAlexaTimers(\n    hass: HomeAssistant,\n    isAlexaTimer: (entityId: string) => boolean,\n    getTimerData: (entityId: string, hass: HomeAssistant) => TimerData | null\n  ): string[] {\n    if (!hass || !hass.states) return [];\n    \n    const alexaTimers: string[] = [];\n    \n    for (const entityId in hass.states) {\n      if (isAlexaTimer(entityId)) {\n        const entity = hass.states[entityId];\n        // Include if rich attributes indicate any timers, regardless of entity.state\n        const attributes = entity.attributes || {};\n        const activeTimers = this.parseJson(attributes.sorted_active) ?? [];\n        const allTimers    = this.parseJson(attributes.sorted_all)    ?? [];\n\n        const hasActive = Array.isArray(activeTimers) && activeTimers.length > 0;\n        let hasPaused = false;\n        if (!hasActive && Array.isArray(allTimers) && allTimers.length > 0) {\n          for (const t of allTimers) {\n            const entry = this.extractTimerEntry(t);\n            const data = entry?.data;\n            if (data && data.status === 'PAUSED' && typeof data.remainingTime === 'number' && data.remainingTime > 0) {\n              hasPaused = true;\n              break;\n            }\n          }\n        }\n\n        if (hasActive || hasPaused) {\n          alexaTimers.push(entityId);\n          continue;\n        }\n        // Fallback: compute and include only if active or paused according to parser\n        const timerData = getTimerData(entityId, hass);\n        if (timerData && (timerData.isActive || timerData.isPaused)) {\n          alexaTimers.push(entityId);\n        }\n      }\n    }\n    \n    return alexaTimers;\n  }\n\n  /**\n   * Helper method to parse JSON strings/arrays\n   */\n  private static parseJson(src: any): any[] | null {\n    if (Array.isArray(src)) return src;\n    if (typeof src === 'string') { \n      try { \n        return JSON.parse(src); \n      } catch {} \n    }\n    return null;\n  }\n\n  /**\n   * Helper to extract id and data from timer entry\n   * Handles both old tuple format [id, data] and new object format {id, ...data}\n   * @param entry - Timer entry (either tuple or object)\n   * @returns {id, data} or null if invalid\n   */\n  private static extractTimerEntry(entry: any): { id: string; data: any } | null {\n    // New object format: {id, timerLabel, status, remainingTime, ...}\n    if (entry && typeof entry === 'object' && !Array.isArray(entry) && entry.id) {\n      return { id: String(entry.id), data: entry };\n    }\n    // Old tuple format: [id, {timerLabel, status, remainingTime, ...}]\n    if (Array.isArray(entry) && entry.length >= 2 && entry[0] && entry[1]) {\n      return { id: String(entry[0]), data: entry[1] };\n    }\n    return null;\n  }\n\n  /**\n   * Helper to extract timer label from timer data\n   * Checks timerLabel first (sorted_* format), then label (brief format)\n   * @param data - Timer data object\n   * @returns Timer label or undefined\n   */\n  private static extractTimerLabel(data: any): string | undefined {\n    if (!data) return undefined;\n    // timerLabel is used in sorted_active/sorted_all\n    if (data.timerLabel) return data.timerLabel;\n    // label is used in brief.active/brief.all (generic resolved label)\n    if (data.label) return data.label;\n    return undefined;\n  }\n\n  /**\n   * Extracts Alexa device name from entity ID or attributes\n   * @param entityId - Entity ID\n   * @param attributes - Entity attributes\n   * @returns string - Device name\n   */\n  private static extractAlexaDevice(entityId: string, attributes: any): string {\n    // First try to clean up friendly_name if it exists\n    if (attributes.friendly_name) {\n      let deviceName = attributes.friendly_name;\n      \n      // Remove common timer-related suffixes that clutter the display\n      deviceName = deviceName\n        .replace(/\\s*next\\s*timer$/i, '')\n        .replace(/\\s*timer$/i, '')\n        .replace(/\\s*echo\\s*timer$/i, '')\n        .replace(/\\s*alexa\\s*timer$/i, '')\n        .trim();\n      \n      if (deviceName) return deviceName;\n    }\n\n    // Try to extract from entity ID pattern: sensor.device_name_next_timer\n    if (entityId.includes('_next_timer')) {\n      const devicePart = entityId\n        .replace(/^sensor\\./, '')\n        .replace(/_next_timer$/, '')\n        .replace(/_/g, ' ')\n        .replace(/\\b\\w/g, l => l.toUpperCase());\n      \n      if (devicePart) return devicePart;\n    }\n    \n    // Try from other attributes\n    if (attributes.device_name) return attributes.device_name;\n    if (attributes.device) return attributes.device;\n    \n    // Fallback\n    return 'Alexa Device';\n  }\n\n  /**\n   * Formats Alexa timer name from entity ID\n   * @param entityId - Entity ID\n   * @returns string - Formatted name\n   */\n  private static formatAlexaTimerName(entityId: string): string {\n    return entityId\n      .replace(/^sensor\\./, '')\n      .replace(/_next_timer$/, '')\n      .replace(/_timer$/, '')\n      .replace(/_/g, ' ')\n      .replace(/\\b\\w/g, l => l.toUpperCase());\n  }\n}\n","import { HomeAssistant } from '../types/index';\nimport { TimerData } from './Timer';\n\n/**\n * GoogleTimerService - Handles Google Home custom component timer entities\n * Implements timer ID level tracking similar to Alexa for Google Home timers\n * Based on ha-google-home integration: https://github.com/leikoilja/ha-google-home\n */\nexport class GoogleTimerService {\n  \n  // Cache for Google timer ID-based finished state persistence and paused snapshots\n  private static googleIdCache = new Map<string, {\n    finishedTimerId?: string;\n    lastDuration?: number;\n    lastLabel?: string;\n    pausedSnapshots?: Map<string, { remaining: number; pausedAt: number; wasActive?: boolean }>;\n  }>();\n\n  /**\n   * Handles Google Home timer data extraction with timer ID tracking.\n   * @param entityId - Google Home timer entity ID\n   * @param entity - Entity state object\n   * @param hass - Home Assistant object\n   * @param parseDuration - Duration parsing utility function\n   * @returns TimerData for the primary Google Home timer\n   */\n  static getGoogleTimerData(\n    entityId: string,\n    entity: any,\n    hass: HomeAssistant,\n    parseDuration: (duration: any) => number\n  ): TimerData | null {\n    const { state, attributes } = entity;\n\n    // The ha-google-home integration stores timers in a list attribute\n    const allTimers = attributes.timers || [];\n\n    if (!Array.isArray(allTimers) || allTimers.length === 0) {\n      // If timers array is completely empty, clear any cached finished timer\n      // This handles the case when a ringing timer gets dismissed\n      const entityCache = this.googleIdCache.get(entityId);\n      if (entityCache?.finishedTimerId) {\n        // Clear the finished timer cache since no timers exist anymore\n        delete entityCache.finishedTimerId;\n        delete entityCache.lastDuration;\n        delete entityCache.lastLabel;\n      }\n      \n      // Return \"no timers\" state instead of null for auto-discovery compatibility\n      return {\n        isActive: false,\n        isPaused: false,\n        duration: 0,\n        remaining: 0,\n        finishesAt: null,\n        progress: 0,\n        finished: false,\n        isGoogleTimer: true,\n        userDefinedLabel: undefined,\n        googleTimerId: undefined,\n        googleTimerStatus: 'none',\n      };\n    }\n\n    // Create maps for active and all timers with timer_id as key\n    const activeTimers = new Map<string, any>();\n    const allTimersMap = new Map<string, any>();\n\n    for (const timer of allTimers) {\n      if (timer.timer_id) {\n        allTimersMap.set(String(timer.timer_id), timer);\n        if (timer.status === 'set' || timer.status === 'ringing') {\n          activeTimers.set(String(timer.timer_id), timer);\n        }\n      }\n    }\n\n    // Timer ID level tracking - detect finished timers\n    const now = Date.now() / 1000; // Convert to seconds to match fire_time\n    let entityCache = this.googleIdCache.get(entityId);\n    if (!entityCache) {\n      entityCache = {};\n      this.googleIdCache.set(entityId, entityCache);\n    }\n\n    // Check for finished timers (timers that were active but now missing/expired/ringing)\n    const finishedCandidates: Array<{id: string, fireTime: number, timer: any}> = [];\n    \n    // Check active timers that have passed their fire_time\n    for (const [timerId, timer] of activeTimers.entries()) {\n      if (timer.fire_time && timer.fire_time <= now && timer.status !== 'ringing') {\n        finishedCandidates.push({id: timerId, fireTime: timer.fire_time, timer});\n      }\n    }\n    \n    // Check for ringing timers (they are finished/completed)\n    for (const timer of allTimers) {\n      if (timer.timer_id && timer.status === 'ringing') {\n        const timerId = String(timer.timer_id);\n        const fireTime = timer.fire_time || now - 1; // Use fire_time or current time if missing\n        finishedCandidates.push({id: timerId, fireTime, timer});\n      }\n    }\n\n    // Sort by fire time and pick the most recently finished\n    if (finishedCandidates.length > 0) {\n      finishedCandidates.sort((a, b) => b.fireTime - a.fireTime);\n      entityCache.finishedTimerId = finishedCandidates[0].id;\n      const finishedTimer = finishedCandidates[0].timer;\n      if (finishedTimer) {\n        entityCache.lastDuration = finishedTimer.duration || 0;\n        entityCache.lastLabel = finishedTimer.label || 'Timer';\n      }\n    }\n\n    // Clean up finished timer cache if the finished timer is no longer in the timers array\n    if (entityCache.finishedTimerId) {\n      const finishedTimerStillExists = allTimers.some((timer: any) => \n        String(timer.timer_id) === entityCache.finishedTimerId\n      );\n      \n      if (!finishedTimerStillExists) {\n        // Timer was dismissed or removed, clear the cache immediately\n        delete entityCache.finishedTimerId;\n        delete entityCache.lastDuration;\n        delete entityCache.lastLabel;\n      }\n    }\n\n    // Find primary timer to display\n    let primaryTimer: any = null;\n    let primaryTimerId: string | null = null;\n\n    // 1. Check for ringing timers first (immediate finished state)\n    for (const timer of allTimers) {\n      if (timer.timer_id && timer.status === 'ringing') {\n        return {\n          isActive: false,\n          isPaused: false,\n          duration: timer.duration || 0,\n          remaining: 0,\n          finishesAt: null,\n          progress: 100,\n          finished: true,\n          isGoogleTimer: true,\n          userDefinedLabel: timer.label || undefined,\n          googleTimerId: String(timer.timer_id),\n          googleTimerStatus: 'ringing',\n        };\n      }\n    }\n\n    // 2. Check if we have a finished timer to display\n    if (entityCache.finishedTimerId && allTimersMap.has(entityCache.finishedTimerId)) {\n      const finishedTimer = allTimersMap.get(entityCache.finishedTimerId);\n      if (finishedTimer && finishedTimer.fire_time <= now) {\n        return {\n          isActive: false,\n          isPaused: false,\n          duration: finishedTimer.duration || 0,\n          remaining: 0,\n          finishesAt: null,\n          progress: 100,\n          finished: true,\n          isGoogleTimer: true,\n          userDefinedLabel: finishedTimer.label || undefined,\n          googleTimerId: String(finishedTimer.timer_id),\n          googleTimerStatus: finishedTimer.status || 'ringing',\n        };\n      }\n    }\n\n    // 3. Find active timer with earliest fire time\n    let earliestFireTime = Number.POSITIVE_INFINITY;\n    for (const [timerId, timer] of activeTimers.entries()) {\n      if (timer.fire_time && timer.fire_time < earliestFireTime) {\n        earliestFireTime = timer.fire_time;\n        primaryTimer = timer;\n        primaryTimerId = timerId;\n      }\n    }\n\n    // 4. If no active timers, check for paused timers\n    if (!primaryTimer) {\n      for (const timer of allTimers) {\n        if (timer.timer_id) {\n          const status = String(timer.status || '').toLowerCase().trim();\n          if (status === 'paused') {\n            primaryTimer = timer;\n            primaryTimerId = String(timer.timer_id);\n            break;\n          }\n        }\n      }\n    }\n\n    if (!primaryTimer) {\n      // If we have timers but none are active or paused, use the first one as a fallback\n      // This helps in cases where the state is not one we explicitly handle\n      if (allTimers.length > 0) {\n        primaryTimer = allTimers[0];\n        primaryTimerId = String(allTimers[0].timer_id || 'unknown');\n      } else {\n        return null; // No timers at all\n      }\n    }\n\n    // --- Calculate timer properties ---\n    const statusStr = String(primaryTimer.status || '').toLowerCase().trim();\n    const isActive = statusStr === 'set' || statusStr === 'ringing';\n    const isPaused = statusStr === 'paused';\n    const isRinging = statusStr === 'ringing';\n\n    const duration = typeof primaryTimer.duration === 'number' \n      ? primaryTimer.duration \n      : parseDuration(primaryTimer.duration || '0');\n    \n    let remaining = 0;\n    let finishesAt: Date | null = null;\n    let isFinished = false;\n\n    if (!entityCache.pausedSnapshots) {\n      entityCache.pausedSnapshots = new Map();\n    }\n    const previousSnapshot = entityCache.pausedSnapshots.get(primaryTimerId!);\n    \n    if (isActive) {\n      const fireTimeMs = primaryTimer.fire_time ? primaryTimer.fire_time * 1000 : 0;\n      \n      if (fireTimeMs && fireTimeMs > Date.now()) {\n        remaining = Math.max(0, Math.floor((fireTimeMs - Date.now()) / 1000));\n        finishesAt = new Date(fireTimeMs);\n        \n        entityCache.pausedSnapshots.set(primaryTimerId!, {\n          remaining,\n          pausedAt: now,\n          wasActive: true\n        });\n      } else {\n        remaining = 0;\n        finishesAt = null;\n        isFinished = true;\n      }\n    } else if (isPaused) {\n      // For paused timers, determine remaining time from cache or duration\n      if (previousSnapshot) {\n          remaining = previousSnapshot.remaining;\n      } else {\n          // No cached data, use duration as a fallback. This can happen if HA restarts.\n          remaining = duration;\n      }\n      \n      // Update cache to reflect current paused state\n      entityCache.pausedSnapshots.set(primaryTimerId!, {\n        remaining,\n        pausedAt: now,\n        wasActive: false\n      });\n      finishesAt = null;\n    } else {\n      // Timer is in another state (e.g., idle, or just finished)\n      remaining = 0;\n      finishesAt = null;\n      isFinished = true;\n    }\n\n    // Calculate progress\n    let progress = 0;\n    if (duration > 0) {\n      if (isRinging || isFinished || (remaining === 0 && !isPaused)) {\n        progress = 100;\n      } else {\n        const elapsed = Math.max(0, duration - remaining);\n        progress = Math.min(100, Math.max(0, (elapsed / duration) * 100));\n      }\n    }\n    \n    if (!isFinished) {\n      isFinished = isRinging || (remaining === 0 && !isPaused);\n    }\n\n    if (entityCache.pausedSnapshots && primaryTimerId && (isFinished || isActive)) {\n      if (isActive && previousSnapshot?.wasActive === false) {\n          // Timer was paused and is now active, clear snapshot\n          entityCache.pausedSnapshots.delete(primaryTimerId);\n      } else if (isFinished) {\n          // Timer finished, clear snapshot\n          entityCache.pausedSnapshots.delete(primaryTimerId);\n      }\n    }\n\n    return {\n      isActive: isActive && !isRinging,\n      isPaused,\n      duration,\n      remaining,\n      finishesAt,\n      progress,\n      finished: isFinished,\n      isGoogleTimer: true,\n      userDefinedLabel: primaryTimer.label || undefined,\n      googleTimerId: primaryTimerId || undefined,\n      googleTimerStatus: primaryTimer.status,\n    };\n  }\n\n  /**\n   * AUTO-DISCOVERY: Finds Google Home entities with timers in a displayable state.\n   * @param hass - Home Assistant object\n   * @param isGoogleTimer - Google timer detection function\n   * @returns string[] - Array of entity IDs with active, paused, or ringing timers\n   */\n  static discoverGoogleTimers(\n    hass: HomeAssistant,\n    isGoogleTimer: (entityId: string) => boolean,\n    getTimerData: (entityId: string, hass: HomeAssistant) => TimerData | null\n  ): string[] {\n    if (!hass || !hass.states) return [];\n    \n    const googleTimers: string[] = [];\n    \n    for (const entityId in hass.states) {\n      if (isGoogleTimer(entityId)) {\n        const entity = hass.states[entityId];\n        \n        // Don't skip based on entity state - Google Home entities can be \"unavailable\" \n        // but still have valid timer data in attributes\n        const attributes = entity.attributes || {};\n        const timers = attributes.timers || [];\n\n        if (Array.isArray(timers) && timers.length > 0) {\n          const hasDisplayableTimer = timers.some(timer => {\n            const status = String(timer.status || '').toLowerCase().trim();\n            return status === 'set' || status === 'ringing' || status === 'paused';\n          });\n          \n          if (hasDisplayableTimer) {\n            googleTimers.push(entityId);\n          }\n        }\n      }\n    }\n    \n    return googleTimers;\n  }\n\n  /**\n   * Manually clear finished timer cache for an entity (for user dismissal)\n   * @param entityId - Google Home timer entity ID\n   */\n  static clearFinishedTimer(entityId: string): void {\n    const entityCache = this.googleIdCache.get(entityId);\n    if (entityCache && entityCache.finishedTimerId) {\n      delete entityCache.finishedTimerId;\n      delete entityCache.lastDuration;\n      delete entityCache.lastLabel;\n    }\n  }\n}\n","import { HomeAssistant } from '../types/index';\nimport { StandardTimerService } from './StandardTimer';\nimport { AlexaTimerService } from './AlexaTimer';\nimport { GoogleTimerService } from './GoogleTimer';\nimport { LocalizeFunction } from '../utils/localize';\n\nexport interface TimerData {\n  isActive: boolean;\n  isPaused: boolean;\n  duration: number; // in seconds\n  remaining: number; // in seconds\n  finishesAt: Date | null;\n  progress: number; // 0-100\n  finished?: boolean; // explicit finished flag (Alexa)\n  // NEW: Alexa-specific properties\n  isAlexaTimer?: boolean;\n  alexaDevice?: string;\n  timerLabel?: string;\n  // Enhanced Alexa properties\n  timerStatus?: \"ON\" | \"OFF\" | \"PAUSED\"; // Precise status from attributes\n  userDefinedLabel?: string; // User-defined timer label (e.g., \"Pizza\")\n  // NEW: Google Home specific properties\n  isGoogleTimer?: boolean;\n  googleTimerId?: string; // Google Home timer_id for tracking\n  googleTimerStatus?: \"none\" | \"set\" | \"ringing\" | \"paused\"; // Google Home timer status (includes ringing)\n}\n\n/**\n * TimerEntityService - Enhanced with Amazon Alexa & Google Home Timer support\n * Handles Home Assistant timer entity integration including Alexa Media Player and Google Home timers\n * Acts as orchestrator between StandardTimer, AlexaTimer, and GoogleTimer services\n */\nexport class TimerEntityService {\n  \n  /**\n   * Checks if an entity ID is a timer entity (including Alexa and Google timers)\n   * @param entityId - Entity ID to check\n   * @returns boolean - Whether the entity is a timer\n   */\n  static isTimerEntity(entityId: string): boolean {\n    if (!entityId) return false;\n    \n    // Standard HA timers\n    if (entityId.startsWith('timer.')) return true;\n    \n    // Alexa Media Player timer sensors\n    if (entityId.includes('_next_timer') || \n        entityId.includes('alexa_timer') || \n        (entityId.startsWith('sensor.') && entityId.includes('timer'))) {\n      return true;\n    }\n    \n    // Google Home timer sensors (ha-google-home integration)\n    // Pattern: sensor.{device_name}_timers\n    if (entityId.startsWith('sensor.') && entityId.endsWith('_timers')) {\n      return true;\n    }\n    \n    // Fallback for Google Home timers that might have different patterns\n    if (entityId.includes('google_home') && entityId.includes('timer')) {\n      return true;\n    }\n    \n    return false;\n  }\n\n  /**\n   * Checks if entity is an Alexa timer specifically\n   * @param entityId - Entity ID to check\n   * @returns boolean - Whether this is an Alexa timer\n   */\n  static isAlexaTimer(entityId: string): boolean {\n    return entityId.includes('_next_timer') || \n           entityId.includes('alexa_timer') || \n           (entityId.startsWith('sensor.') && entityId.includes('alexa') && entityId.includes('timer'));\n  }\n\n  /**\n   * Checks if entity is a Google Home timer specifically\n   * @param entityId - Entity ID to check\n   * @returns boolean - Whether this is a Google Home timer\n   */\n  static isGoogleTimer(entityId: string): boolean {\n    // Primary pattern for ha-google-home integration: sensor.{device_name}_timers\n    if (entityId.startsWith('sensor.') && entityId.endsWith('_timers')) {\n      return true;\n    }\n    \n    // Secondary patterns for Google Home timers\n    return entityId.includes('google_home') && entityId.includes('timer');\n  }\n\n  /**\n   * Gets timer data from a Home Assistant timer entity (including Alexa and Google timers)\n   * @param entityId - Timer entity ID\n   * @param hass - Home Assistant object\n   * @returns TimerData object with timer information\n   */\n  static getTimerData(entityId: string, hass: HomeAssistant): TimerData | null {\n    if (!hass || !entityId || !this.isTimerEntity(entityId)) {\n      return null;\n    }\n\n    const entity = hass.states[entityId];\n    if (!entity) {\n      return null;\n    }\n\n    // Handle Alexa timers\n    if (this.isAlexaTimer(entityId)) {\n      return AlexaTimerService.getAlexaTimerData(\n        entityId, \n        entity, \n        hass,\n        this.isISOTimestamp,\n        this.parseDuration\n      );\n    }\n\n    // Handle Google Home timers\n    if (this.isGoogleTimer(entityId)) {\n      return GoogleTimerService.getGoogleTimerData(\n        entityId,\n        entity,\n        hass,\n        this.parseDuration\n      );\n    }\n\n    // Handle standard HA timers\n    return StandardTimerService.getStandardTimerData(\n      entityId, \n      entity, \n      this.parseDuration\n    );\n  }\n  /**\n   * AUTO-DISCOVERY: Attempts to find Alexa timer entities in Home Assistant\n   * @param hass - Home Assistant object\n   * @returns string[] - Array of potential Alexa timer entity IDs\n   */\n  static discoverAlexaTimers(hass: HomeAssistant): string[] {\n    return AlexaTimerService.discoverAlexaTimers(\n      hass, \n      (entityId: string) => this.isAlexaTimer(entityId), \n      (entityId: string, hass: HomeAssistant) => this.getTimerData(entityId, hass)\n    );\n  }\n\n  /**\n   * AUTO-DISCOVERY: Attempts to find Google Home timer entities in Home Assistant\n   * @param hass - Home Assistant object\n   * @returns string[] - Array of potential Google Home timer entity IDs\n   */\n  static discoverGoogleTimers(hass: HomeAssistant): string[] {\n    return GoogleTimerService.discoverGoogleTimers(\n      hass,\n      (entityId: string) => this.isGoogleTimer(entityId),\n      (entityId: string, hass: HomeAssistant) => this.getTimerData(entityId, hass)\n    );\n  }\n\n  /**\n   * Checks if a string is an ISO timestamp\n   * @param str - String to check\n   * @returns boolean - Whether string is ISO timestamp\n   */\n  private static isISOTimestamp(str: string): boolean {\n    // Check for ISO 8601 format\n    const isoRegex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?([+-]\\d{2}:\\d{2}|Z)?$/;\n    return isoRegex.test(str);\n  }\n\n  /**\n   * Parses duration from various formats (seconds, HH:MM:SS, etc.)\n   * @param duration - Duration value to parse\n   * @returns number - Duration in seconds\n   */\n  private static parseDuration(duration: any): number {\n    if (typeof duration === 'number') {\n      return duration;\n    }\n\n    if (typeof duration !== 'string') {\n      return 0;\n    }\n\n    // Handle HH:MM:SS format\n    if (duration.includes(':')) {\n      const parts = duration.split(':').map(Number);\n      if (parts.length === 3) {\n        // HH:MM:SS\n        return parts[0] * 3600 + parts[1] * 60 + parts[2];\n      } else if (parts.length === 2) {\n        // MM:SS\n        return parts[0] * 60 + parts[1];\n      }\n    }\n\n    // Try to parse as number (seconds)\n    const seconds = parseFloat(duration);\n    return isNaN(seconds) ? 0 : seconds;\n  }\n\n  /**\n   * Formats remaining time as human-readable string\n   * @param remaining - Remaining time in seconds\n   * @param showSeconds - Whether to include seconds in output\n   * @param localize - Optional localization function for time unit labels\n   * @param useCompact - Whether to use compact format (e.g., \"5h30m\") vs full format (e.g., \"5 hours 30 minutes\")\n   * @returns string - Formatted time string\n   */\n  static formatRemainingTime(\n    remaining: number,\n    showSeconds: boolean = true,\n    localize?: LocalizeFunction,\n    useCompact: boolean = true\n  ): string {\n    if (remaining <= 0) {\n      return '0:00';\n    }\n\n    const hours = Math.floor(remaining / 3600);\n    const minutes = Math.floor((remaining % 3600) / 60);\n    const seconds = Math.floor(remaining % 60);\n\n    if (useCompact) {\n      // Compact format: 5h 30m 25s (with spaces between units)\n      const h = localize ? localize('time.hour_compact') : 'h';\n      const m = localize ? localize('time.minute_compact') : 'm';\n      const s = localize ? localize('time.second_compact') : 's';\n\n      if (hours > 0) {\n        if (showSeconds) {\n          return `${hours}${h} ${minutes.toString().padStart(2, '0')}${m} ${seconds.toString().padStart(2, '0')}${s}`;\n        } else {\n          return `${hours}${h} ${minutes.toString().padStart(2, '0')}${m}`;\n        }\n      } else {\n        if (showSeconds) {\n          return `${minutes}${m} ${seconds.toString().padStart(2, '0')}${s}`;\n        } else {\n          return `${minutes}${m}`;\n        }\n      }\n    } else {\n      // Full format: 5 hours 30 minutes 25 seconds\n      const parts: string[] = [];\n\n      if (hours > 0) {\n        const hourUnit = localize \n          ? (hours === 1 ? localize('time.hour_full') : localize('time.hours_full'))\n          : (hours === 1 ? 'hour' : 'hours');\n        parts.push(`${hours} ${hourUnit}`);\n      }\n\n      if (minutes > 0) {\n        const minUnit = localize\n          ? (minutes === 1 ? localize('time.minute_full') : localize('time.minutes_full'))\n          : (minutes === 1 ? 'minute' : 'minutes');\n        parts.push(`${minutes} ${minUnit}`);\n      }\n\n      if (showSeconds && seconds > 0) {\n        const secUnit = localize\n          ? (seconds === 1 ? localize('time.second_full') : localize('time.seconds_full'))\n          : (seconds === 1 ? 'second' : 'seconds');\n        parts.push(`${seconds} ${secUnit}`);\n      }\n\n      if (parts.length === 0) {\n        return '0 ' + (localize ? localize('time.minutes_full') : 'minutes');\n      }\n\n      return parts.join(' ');\n    }\n  }\n\n  /**\n   * Gets appropriate title text for timer entity (enhanced for Alexa and Google Home)\n   * @param entityId - Timer entity ID\n   * @param hass - Home Assistant object\n   * @param customTitle - Custom title override\n   * @returns string - Title text\n   */\n  static getTimerTitle(entityId: string, hass: HomeAssistant, customTitle?: string): string {\n    if (customTitle) {\n      return customTitle;\n    }\n\n    if (!hass || !entityId) {\n      return 'Timer';\n    }\n\n    const entity = hass.states[entityId];\n    if (!entity) {\n      return 'Timer';\n    }\n\n    // Handle Alexa timers\n    if (this.isAlexaTimer(entityId)) {\n      const timerData = AlexaTimerService.getAlexaTimerData(\n        entityId, \n        entity, \n        hass,\n        this.isISOTimestamp,\n        this.parseDuration\n      );\n      if (timerData?.timerLabel) {\n        return timerData.timerLabel;\n      }\n      return this.formatAlexaTimerName(entityId);\n    }\n\n    // Handle Google Home timers\n    if (this.isGoogleTimer(entityId)) {\n      const timerData = GoogleTimerService.getGoogleTimerData(\n        entityId,\n        entity,\n        hass,\n        this.parseDuration\n      );\n      if (timerData?.userDefinedLabel) {\n        return timerData.userDefinedLabel;\n      }\n      return this.formatGoogleTimerName(entityId);\n    }\n\n    // Use friendly name or fall back to entity ID\n    return entity.attributes.friendly_name || entityId.replace('timer.', '').replace(/_/g, ' ');\n  }\n\n  /**\n   * Formats Alexa timer name from entity ID\n   * @param entityId - Entity ID\n   * @returns string - Formatted name\n   */\n  private static formatAlexaTimerName(entityId: string): string {\n    return entityId\n      .replace(/^sensor\\./, '')\n      .replace(/_next_timer$/, '')\n      .replace(/_timer$/, '')\n      .replace(/_/g, ' ')\n      .replace(/\\b\\w/g, l => l.toUpperCase());\n  }\n\n  /**\n   * Formats Google Home timer name from entity ID\n   * @param entityId - Entity ID\n   * @returns string - Formatted name\n   */\n  private static formatGoogleTimerName(entityId: string): string {\n    return entityId\n      .replace(/^sensor\\./, '')\n      .replace(/_timers$/, '')\n      .replace(/_/g, ' ')\n      .replace(/\\b\\w/g, l => l.toUpperCase()) + ' Timers';\n  }\n\n  /**\n   * Checks if a timer is expired\n   * @param timerData - Timer data object\n   * @returns boolean - Whether the timer is expired\n   */\n  static isTimerExpired(timerData: TimerData): boolean {\n    if (!timerData) return false;\n    \n    if (timerData.isAlexaTimer) {\n      return !!timerData.finished || (timerData.remaining === 0 && timerData.progress >= 100);\n    }\n    \n    if (timerData.isGoogleTimer) {\n      return !!timerData.finished || (timerData.remaining === 0 && timerData.progress >= 100);\n    }\n    \n    // Standard HA timer\n    return !timerData.isActive && !timerData.isPaused && timerData.progress >= 100;\n  }\n\n  /**\n   * Gets subtitle text for timer display\n   * @param timerData - Timer data object\n   * @param showSeconds - Whether to show seconds in display\n   * @param localize - Localization function for translating status text\n   * @param useCompact - Whether to use compact format for time (default: true)\n   * @returns string - Subtitle text\n   */\n  static getTimerSubtitle(\n    timerData: TimerData,\n    showSeconds: boolean = true,\n    localize?: LocalizeFunction,\n    useCompact: boolean = true\n  ): string {\n    if (!timerData) {\n      return 'Timer not found';\n    }\n\n    // Use localize if provided, otherwise provide backward compatibility\n    const t = localize || ((key: string) => key);\n\n    if (timerData.isAlexaTimer) {\n      if (timerData.finished) {\n        return timerData.userDefinedLabel\n          ? t('timer.complete_with_label', { label: timerData.userDefinedLabel })\n          : t('timer.complete');\n      }\n\n      if (timerData.isActive && timerData.remaining > 0) {\n        const remaining = this.formatRemainingTime(timerData.remaining, showSeconds, localize, useCompact);\n        return timerData.userDefinedLabel\n          ? t('timer.remaining_with_label', { time: remaining, label: timerData.userDefinedLabel })\n          : timerData.alexaDevice\n          ? t('timer.remaining_with_device', { time: remaining, device: timerData.alexaDevice })\n          : t('timer.remaining', { time: remaining });\n      }\n\n      if (timerData.isPaused && timerData.remaining > 0) {\n        const remaining = this.formatRemainingTime(timerData.remaining, showSeconds, localize, useCompact);\n        return timerData.userDefinedLabel\n          ? t('timer.paused_with_time', { label: timerData.userDefinedLabel, time: remaining })\n          : timerData.alexaDevice\n          ? t('timer.paused_alexa', { device: timerData.alexaDevice, time: remaining })\n          : t('timer.paused_without_label', { time: remaining });\n      }\n\n      if (timerData.finished || (timerData.remaining === 0 && timerData.progress >= 100)) {\n        return timerData.userDefinedLabel\n          ? t('timer.complete_with_label', { label: timerData.userDefinedLabel })\n          : t('timer.complete');\n      }\n\n      return timerData.alexaDevice\n        ? t('timer.no_timers_device', { device: timerData.alexaDevice })\n        : t('timer.no_timers');\n    }\n\n    if (timerData.isGoogleTimer) {\n      const isRinging = timerData.googleTimerStatus === 'ringing';\n\n      if (timerData.finished || isRinging) {\n        return timerData.userDefinedLabel\n          ? t('timer.complete_with_label', { label: timerData.userDefinedLabel })\n          : t('timer.complete');\n      }\n\n      if (timerData.isActive && timerData.remaining > 0) {\n        const remaining = this.formatRemainingTime(timerData.remaining, showSeconds, localize, useCompact);\n        return timerData.userDefinedLabel\n          ? t('timer.remaining_with_label', { time: remaining, label: timerData.userDefinedLabel })\n          : t('timer.remaining_with_device', { time: remaining, device: 'Google Home' });\n      }\n\n      if (timerData.isPaused && timerData.remaining > 0) {\n        const remaining = this.formatRemainingTime(timerData.remaining, showSeconds, localize, useCompact);\n        return timerData.userDefinedLabel\n          ? t('timer.paused_with_time', { label: timerData.userDefinedLabel, time: remaining })\n          : t('timer.google_paused', { time: remaining });\n      }\n\n      if (timerData.finished || isRinging || (timerData.remaining === 0 && timerData.progress >= 100)) {\n        return timerData.userDefinedLabel\n          ? t('timer.complete_with_label', { label: timerData.userDefinedLabel })\n          : t('timer.complete');\n      }\n\n      return t('timer.no_timers_google');\n    }\n\n    // Standard HA timer\n    if (timerData.isActive) {\n      return t('timer.remaining', { time: this.formatRemainingTime(timerData.remaining, showSeconds, localize, useCompact) });\n    }\n\n    if (timerData.isPaused) {\n      return t('timer.paused_time_left', { time: this.formatRemainingTime(timerData.remaining, showSeconds, localize, useCompact) });\n    }\n\n    if (timerData.duration > 0) {\n      return t('timer.ready_with_time', { time: this.formatRemainingTime(timerData.duration, showSeconds, localize, useCompact) });\n    }\n\n    return t('timer.timer_ready');\n  }\n\n  /**\n   * Gets timer state color based on status\n   * @param timerData - Timer data object\n   * @param defaultColor - Default color if no specific state\n   * @returns string - Color hex value\n   */\n  static getTimerStateColor(timerData: TimerData, defaultColor: string = '#4caf50'): string {\n    if (!timerData) return defaultColor;\n    \n    if (timerData.isAlexaTimer) {\n      if (timerData.isActive && timerData.remaining > 0) {\n        return '#00d4ff'; // Alexa blue\n      }\n      \n      if (this.isTimerExpired(timerData)) {\n        return '#ff4444'; // Red for expired\n      }\n      \n      return '#888888'; // Gray for inactive\n    }\n\n    if (timerData.isGoogleTimer) {\n      if (timerData.isActive && timerData.remaining > 0) {\n        return '#34a853'; // Google green\n      }\n      \n      if (this.isTimerExpired(timerData)) {\n        return '#ff4444'; // Red for expired\n      }\n      \n      return '#888888'; // Gray for inactive\n    }\n    \n    // Standard HA timer colors\n    if (timerData.isActive) {\n      return '#4caf50'; // Green for active\n    }\n    \n    if (timerData.isPaused) {\n      return '#ff9800'; // Orange for paused\n    }\n    \n    if (this.isTimerExpired(timerData)) {\n      return '#f44336'; // Red for expired\n    }\n    \n    return '#9e9e9e'; // Gray for idle\n  }\n}","/**\n * DateParser - Enhanced date parsing utility with a more streamlined fallback system\n * Handles cross-browser compatibility and edge cases for date string parsing\n */\nexport class DateParser {\n  /**\n   * Main entry point for date parsing with a hybrid approach\n   * @param {string} dateString - ISO date string to parse\n   * @returns {number} - Unix timestamp in milliseconds\n   */\n  static parseISODate(dateString: string): number {\n    // First, try a robust manual parsing for common ISO formats.\n    // This is more consistent across browsers than new Date().\n    try {\n      const manualResult = this.parseISODateManual(dateString);\n      if (!isNaN(manualResult)) {\n        return manualResult;\n      }\n    } catch (e) {\n      // Fall through to other methods if manual parsing fails\n    }\n\n    // Second, try the native Date constructor, which can handle more formats.\n    const nativeResult = new Date(dateString);\n    if (!isNaN(nativeResult.getTime()) && this.isValidDateResult(nativeResult, dateString)) {\n      return nativeResult.getTime();\n    }\n    \n    // If all else fails, use the final fallback.\n    return this.parseISODateFallback(dateString);\n  }\n\n  /**\n   * Validates that a parsed date result is reasonable\n   * @param {Date} dateObj - Parsed date object\n   * @param {string} originalString - Original date string\n   * @returns {boolean} - Whether the date is valid\n   */\n  static isValidDateResult(dateObj: Date, originalString: string): boolean {\n    const timestamp = dateObj.getTime();\n    \n    // Check for reasonable date range (1970-2100)\n    const minTimestamp = new Date('1970-01-01').getTime();\n    const maxTimestamp = new Date('2100-12-31').getTime();\n    \n    if (timestamp < minTimestamp || timestamp > maxTimestamp) {\n      return false;\n    }\n    \n    // Check for February 29th in non-leap years\n    if (typeof originalString === 'string' && originalString.includes('02-29')) {\n      const year = dateObj.getFullYear();\n      if (!this.isLeapYear(year)) {\n        return false;\n      }\n    }\n    \n    return true;\n  }\n\n  /**\n   * Check if a year is a leap year\n   * @param {number} year - Year to check\n   * @returns {boolean} - Whether the year is a leap year\n   */\n  static isLeapYear(year: number): boolean {\n    return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);\n  }\n\n  /**\n   * Enhanced manual parsing with better error handling\n   * @param {string} dateString - Date string to parse\n   * @returns {number} - Unix timestamp\n   */\n  static parseISODateManual(dateString: string): number {\n    if (typeof dateString === 'string' && dateString.includes('T')) {\n      // Check if the string contains timezone information (Z, +XX:XX, -XX:XX)\n      const hasTimezone = /[+-]\\d{2}:\\d{2}$|Z$/.test(dateString);\n      \n      if (hasTimezone) {\n        // For ISO strings with timezone info, use native Date parsing to preserve timezone\n        return new Date(dateString).getTime();\n      } else {\n        // For timezone-less ISO strings, use manual parsing for cross-platform consistency\n        const [datePart, timePart] = dateString.split('T');\n        const [year, month, day] = datePart.split('-').map(Number);\n        \n        // Validate date components\n        if (!this.isValidDateComponents(year, month, day)) {\n          throw new Error('Invalid date components');\n        }\n        \n        if (timePart && timePart.includes(':')) {\n          const [hour, minute, second] = timePart.split(':').map(parseFloat);\n          \n          // Validate time components\n          if (!this.isValidTimeComponents(hour, minute, second)) {\n            throw new Error('Invalid time components');\n          }\n          \n          return new Date(year, month - 1, day, hour, minute, second || 0).getTime();\n        } else {\n          return new Date(year, month - 1, day).getTime();\n        }\n      }\n    } else {\n      // Fallback to regular parsing for other formats\n      return new Date(dateString).getTime();\n    }\n  }\n\n  /**\n   * Validates date components\n   * @param {number} year - Year component\n   * @param {number} month - Month component (1-12)\n   * @param {number} day - Day component\n   * @returns {boolean} - Whether components are valid\n   */\n  static isValidDateComponents(year: number, month: number, day: number): boolean {\n    if (isNaN(year) || isNaN(month) || isNaN(day)) return false;\n    if (year < 1970 || year > 2100) return false;\n    if (month < 1 || month > 12) return false;\n    if (day < 1 || day > 31) return false;\n    \n    // Check days in month\n    const daysInMonth = [31, this.isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n    if (day > daysInMonth[month - 1]) return false;\n    \n    return true;\n  }\n\n  /**\n   * Validates time components\n   * @param {number} hour - Hour component\n   * @param {number} minute - Minute component\n   * @param {number} second - Second component\n   * @returns {boolean} - Whether components are valid\n   */\n  static isValidTimeComponents(hour: any, minute: any, second: any): boolean {\n    const h = parseInt(hour);\n    const m = parseInt(minute);\n    const s = parseInt(second);\n    \n    if (isNaN(h) || isNaN(m) || isNaN(s)) return false;\n    if (h < 0 || h > 23) return false;\n    if (m < 0 || m > 59) return false;\n    if (s < 0 || s > 59) return false;\n    \n    return true;\n  }\n\n  /**\n   * Final fallback parsing method\n   * @param {string} dateString - Date string to parse\n   * @returns {number} - Unix timestamp\n   */\n  static parseISODateFallback(dateString: string): number {\n    try {\n      const timestamp = Date.parse(dateString);\n      if (!isNaN(timestamp)) {\n        return timestamp;\n      }\n      \n      // Last resort: return current time as fallback\n      return Date.now();\n    } catch (error) {\n      return Date.now();\n    }\n  }\n}","/**\n * ConfigValidator - Comprehensive input validation for TimeFlow Card configuration\n * Ensures security, type safety, and data integrity with graceful error handling\n */\n\nexport interface ValidationError {\n  field: string;\n  message: string;\n  severity: 'critical' | 'warning' | 'info';\n  suggestion?: string;\n  value?: any;\n}\n\nexport interface ValidationResult {\n  isValid: boolean;\n  errors: ValidationError[];\n  hasCriticalErrors: boolean;\n  hasWarnings: boolean;\n  safeConfig?: any;\n}\n\nexport class ConfigValidator {\n  /**\n   * Comprehensive input validation for configuration with severity levels\n   * @param {Object} config - Configuration object to validate\n   * @returns {ValidationResult} - Detailed validation result\n   */\n  static validateConfig(config: any): ValidationResult {\n    const errors: ValidationError[] = [];\n    \n    // Check if config is null or undefined\n    if (!config) {\n      errors.push({\n        field: 'config',\n        message: 'Configuration object is missing or empty',\n        severity: 'critical',\n        suggestion: 'Provide a valid configuration object with at least a target_date field.',\n        value: config\n      });\n      return {\n        isValid: false,\n        errors,\n        hasCriticalErrors: true,\n        hasWarnings: false\n      };\n    }\n    \n    // Validate target_date (required field, unless using timer_entity, auto_discover_alexa, or auto_discover_google)\n    if (config.target_date) {\n      if (!this.isValidDateInput(config.target_date)) {\n        errors.push({\n          field: 'target_date',\n          message: 'Invalid target_date format',\n          severity: 'critical',\n          suggestion: 'Use ISO date string (2025-12-31T23:59:59), entity ID (sensor.my_date), or template ({{ states(\"sensor.date\") }}).',\n          value: config.target_date\n        });\n      }\n    } else if (!config.timer_entity && !config.auto_discover_alexa && !config.auto_discover_google) {\n      // target_date is only required if timer_entity, auto_discover_alexa, and auto_discover_google are not provided\n      errors.push({\n        field: 'target_date',\n        message: 'Either \"target_date\", \"timer_entity\", \"auto_discover_alexa\", or \"auto_discover_google\" must be provided',\n        severity: 'critical',\n        suggestion: 'Add target_date field with a valid date value like \"2025-12-31T23:59:59\" OR specify a timer_entity like \"timer.my_timer\" OR enable auto_discover_alexa OR enable auto_discover_google.',\n        value: undefined\n      });\n    }\n    \n    // Validate timer_entity if provided\n    if (config.timer_entity && !this.isValidEntityId(config.timer_entity)) {\n      errors.push({\n        field: 'timer_entity',\n        message: 'Invalid timer_entity format',\n        severity: 'warning',\n        suggestion: 'Use a valid entity ID like \"timer.my_timer\", \"sensor.alexa_timer\", or \"sensor.kitchen_display_timers\" (Google Home).',\n        value: config.timer_entity\n      });\n    }\n    \n    // Validate creation_date if provided (optional field)\n    if (config.creation_date && !this.isValidDateInput(config.creation_date)) {\n      errors.push({\n        field: 'creation_date',\n        message: 'Invalid creation_date format',\n        severity: 'warning',\n        suggestion: 'Use ISO date string, entity ID, or template. This field is optional.',\n        value: config.creation_date\n      });\n    }\n    \n    // Validate colors\n    const colorFields = ['text_color', 'background_color', 'progress_color'];\n    colorFields.forEach(field => {\n      if (config[field] && !this.isValidColorInput(config[field])) {\n        errors.push({\n          field,\n          message: `Invalid ${field} format`,\n          severity: 'warning',\n          suggestion: 'Use hex (#ff0000), rgb/rgba, hsl/hsla, CSS color name, entity ID, or template.',\n          value: config[field]\n        });\n      }\n    });\n    \n    // Validate dimensions\n    const dimensionFields = ['width', 'height', 'icon_size'];\n    dimensionFields.forEach(field => {\n      if (config[field] && !this.isValidDimensionInput(config[field])) {\n        errors.push({\n          field,\n          message: `Invalid ${field} format`,\n          severity: 'warning',\n          suggestion: 'Use pixel values (100px), percentages (50%), or CSS units (2rem).',\n          value: config[field]\n        });\n      }\n    });\n    \n    // Validate aspect_ratio\n    if (config.aspect_ratio && !this.isValidAspectRatioInput(config.aspect_ratio)) {\n      errors.push({\n        field: 'aspect_ratio',\n        message: 'Invalid aspect_ratio format',\n        severity: 'warning',\n        suggestion: 'Use format like \"16/9\", \"4/3\", or \"1/1\".',\n        value: config.aspect_ratio\n      });\n    }\n    \n    // Validate stroke_width\n    if (config.stroke_width !== undefined && !this.isValidNumberInput(config.stroke_width, 1, 50)) {\n      errors.push({\n        field: 'stroke_width',\n        message: 'Invalid stroke_width value',\n        severity: 'warning',\n        suggestion: 'Must be a number between 1 and 50.',\n        value: config.stroke_width\n      });\n    }\n    \n    // Validate boolean fields\n    const booleanFields = ['show_months', 'show_days', 'show_hours', 'show_minutes', 'show_seconds', 'expired_animation', 'show_progress_text'];\n    booleanFields.forEach(field => {\n      if (config[field] !== undefined && !this.isValidBooleanInput(config[field])) {\n        errors.push({\n          field,\n          message: `Invalid ${field} value`,\n          severity: 'warning',\n          suggestion: 'Must be true or false (boolean value).',\n          value: config[field]\n        });\n      }\n    });\n    \n    // Validate text fields for XSS prevention\n    const textFields = ['title', 'subtitle', 'expired_text'];\n    textFields.forEach(field => {\n      if (config[field] && !this.isValidTextInput(config[field])) {\n        errors.push({\n          field,\n          message: `Invalid ${field} - contains potentially unsafe content`,\n          severity: 'critical',\n          suggestion: 'Remove script tags, javascript: URLs, and event handlers for security.',\n          value: config[field]\n        });\n      }\n    });\n    \n    // Validate styles object\n    if (config.styles && !this.isValidStylesInput(config.styles)) {\n      errors.push({\n        field: 'styles',\n        message: 'Invalid styles object structure',\n        severity: 'warning',\n        suggestion: 'Must contain valid style arrays for card, title, subtitle, or progress_circle.',\n        value: config.styles\n      });\n    }\n\n    // Additional helpful validations\n    this._addHelpfulValidations(config, errors);\n\n    // Generate safe config for graceful degradation\n    const safeConfig = this._generateSafeConfig(config, errors);\n\n    const criticalErrors = errors.filter(e => e.severity === 'critical');\n    const warnings = errors.filter(e => e.severity === 'warning');\n\n    return {\n      isValid: criticalErrors.length === 0 && warnings.length === 0,\n      errors,\n      hasCriticalErrors: criticalErrors.length > 0,\n      hasWarnings: warnings.length > 0,\n      safeConfig\n    };\n  }\n\n  /**\n   * Add additional helpful validations and suggestions\n   */\n  private static _addHelpfulValidations(config: any, errors: ValidationError[]): void {\n    // No additional validations needed - only validate fields that exist in config\n    // Remove unknown field warnings as requested\n  }\n\n  /**\n   * Generate a safe configuration with fallback values\n   */\n  private static _generateSafeConfig(config: any, errors: ValidationError[]): any {\n    const safeConfig = { ...config };\n    \n    // Apply safe defaults for fields with errors\n    errors.forEach(error => {\n      if (error.severity === 'critical' || error.severity === 'warning') {\n        switch (error.field) {\n          case 'target_date':\n            if (!safeConfig.target_date && !safeConfig.timer_entity && !safeConfig.auto_discover_alexa && !safeConfig.auto_discover_google) {\n              // Only set a default target_date if no timer_entity or auto-discovery is provided\n              const tomorrow = new Date();\n              tomorrow.setDate(tomorrow.getDate() + 1);\n              safeConfig.target_date = tomorrow.toISOString();\n            }\n            break;\n          case 'background_color':\n            if (!this.isValidColorInput(safeConfig.background_color)) {\n              delete safeConfig.background_color;\n            }\n            break;\n          case 'progress_color':\n            if (!this.isValidColorInput(safeConfig.progress_color)) {\n              safeConfig.progress_color = '#4caf50';\n            }\n            break;\n          case 'stroke_width':\n            if (!this.isValidNumberInput(safeConfig.stroke_width, 1, 50)) {\n              safeConfig.stroke_width = 15;\n            }\n            break;\n          case 'icon_size':\n            if (!this.isValidDimensionInput(safeConfig.icon_size)) {\n              safeConfig.icon_size = 100;\n            }\n            break;\n        }\n      }\n    });\n\n    return safeConfig;\n  }\n\n  /**\n   * Legacy method for backward compatibility - now throws ValidationError\n   * @deprecated Use validateConfig() instead which returns ValidationResult\n   */\n  static validateConfigLegacy(config: any): void {\n    const result = this.validateConfig(config);\n    if (result.hasCriticalErrors) {\n      const criticalErrors = result.errors.filter(e => e.severity === 'critical');\n      throw new Error(`Configuration validation failed:\\n ${criticalErrors.map(e => e.message).join('\\n ')}`);\n    }\n  }\n  \n  /**\n   * Validates date input (string, entity, or template)\n   * @param {*} value - Value to validate\n   * @returns {boolean} - Whether the value is valid\n   */\n  static isValidDateInput(value: any): boolean {\n    if (!value) return false;\n    \n    // Allow templates\n    if (this.isTemplate(value)) return true;\n    \n    // Allow entity IDs\n    if (typeof value === 'string' && value.includes('.')) return true;\n    \n    // Validate date string format\n    if (typeof value === 'string') {\n      try {\n        const date = new Date(value);\n        return !isNaN(date.getTime());\n      } catch (e) {\n        return false;\n      }\n    }\n    \n    return false;\n  }\n  \n  /**\n   * Validates color input (color value, entity, or template)\n   * @param {*} value - Value to validate\n   * @returns {boolean} - Whether the value is valid\n   */\n  static isValidColorInput(value: any): boolean {\n    if (!value) return false;\n    \n    // Allow templates and entities\n    if (this.isTemplate(value) || (typeof value === 'string' && value.includes('.'))) return true;\n    \n    if (typeof value !== 'string') return false;\n    \n    // Check hex colors\n    if (/^#([0-9A-F]{3}){1,2}$/i.test(value)) return true;\n    \n    // Check rgb/rgba\n    if (/^rgba?\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*(,\\s*[\\d.]+\\s*)?\\)$/i.test(value)) return true;\n    \n    // Check hsl/hsla\n    if (/^hsla?\\(\\s*\\d+\\s*,\\s*\\d+%\\s*,\\s*\\d+%\\s*(,\\s*[\\d.]+\\s*)?\\)$/i.test(value)) return true;\n    \n    // Check CSS color names (expanded list)\n    const cssColors = [\n      'red', 'blue', 'green', 'yellow', 'orange', 'purple', 'pink', 'brown', 'black', 'white', 'gray', 'grey',\n      'cyan', 'magenta', 'lime', 'maroon', 'navy', 'olive', 'teal', 'silver', 'gold', 'indigo', 'violet',\n      'transparent', 'currentColor', 'inherit', 'initial', 'unset'\n    ];\n    \n    return cssColors.includes(value.toLowerCase());\n  }\n  \n  /**\n   * Validates dimension input (dimension value, entity, or template)\n   * @param {*} value - Value to validate\n   * @returns {boolean} - Whether the value is valid\n   */\n  static isValidDimensionInput(value: any): boolean {\n    if (!value) return false;\n    \n    // Allow templates and entities\n    if (this.isTemplate(value) || (typeof value === 'string' && value.includes('.'))) return true;\n    \n    // Allow numbers\n    if (typeof value === 'number') return true;\n    \n    if (typeof value !== 'string') return false;\n    \n    // Check pixel values (0-10000px)\n    const pxMatch = value.match(/^(\\d+(?:\\.\\d+)?)px$/i);\n    if (pxMatch) {\n      const px = parseFloat(pxMatch[1]);\n      return px >= 0 && px <= 10000;\n    }\n    \n    // Check percentage values (0-1000%)\n    const percentMatch = value.match(/^(\\d+(?:\\.\\d+)?)%$/i);\n    if (percentMatch) {\n      const percent = parseFloat(percentMatch[1]);\n      return percent >= 0 && percent <= 1000;\n    }\n    \n    // Check other valid CSS units\n    const validUnits = ['em', 'rem', 'vh', 'vw', 'vmin', 'vmax', 'ch', 'ex'];\n    for (const unit of validUnits) {\n      const regex = new RegExp(`^(\\\\d+(?:\\\\.\\\\d+)?)${unit}$`, 'i');\n      const match = value.match(regex);\n      if (match) {\n        const unitValue = parseFloat(match[1]);\n        return unitValue >= 0 && unitValue <= 1000; // Reasonable bounds\n      }\n    }\n    \n    // Check for 'auto', 'fit-content', etc.\n    const validKeywords = ['auto', 'fit-content', 'min-content', 'max-content'];\n    return validKeywords.includes(value.toLowerCase());\n  }\n  \n  /**\n   * Validates aspect ratio input\n   * @param {*} value - Value to validate\n   * @returns {boolean} - Whether the value is valid\n   */\n  static isValidAspectRatioInput(value: any): boolean {\n    if (!value) return false;\n    \n    // Allow templates and entities\n    if (this.isTemplate(value) || (typeof value === 'string' && value.includes('.'))) return true;\n    \n    if (typeof value !== 'string') return false;\n    \n    // Check aspect ratio format: number/number\n    const aspectMatch = value.match(/^(\\d+(?:\\.\\d+)?)\\/(\\d+(?:\\.\\d+)?)$/);\n    if (aspectMatch) {\n      const width = parseFloat(aspectMatch[1]);\n      const height = parseFloat(aspectMatch[2]);\n      return width > 0 && height > 0 && width <= 20 && height <= 20; // Reasonable bounds\n    }\n    \n    return false;\n  }\n  \n  /**\n   * Validates number input with optional bounds\n   * @param {*} value - Value to validate\n   * @param {number} min - Minimum allowed value\n   * @param {number} max - Maximum allowed value\n   * @returns {boolean} - Whether the value is valid\n   */\n  static isValidNumberInput(value: any, min: number = -Infinity, max: number = Infinity): boolean {\n    if (value === undefined || value === null) return false;\n    \n    // Allow templates and entities\n    if (typeof value === 'string') {\n      if (this.isTemplate(value) || value.includes('.')) return true;\n      // Try to parse string numbers\n      const parsed = parseFloat(value);\n      return !isNaN(parsed) && parsed >= min && parsed <= max;\n    }\n    \n    return typeof value === 'number' && !isNaN(value) && value >= min && value <= max;\n  }\n  \n  /**\n   * Validates boolean input\n   * @param {*} value - Value to validate\n   * @returns {boolean} - Whether the value is valid\n   */\n  static isValidBooleanInput(value: any): boolean {\n    return typeof value === 'boolean';\n  }\n  \n  /**\n   * Validates text input for XSS prevention\n   * @param {*} value - Value to validate\n   * @returns {boolean} - Whether the value is valid\n   */\n  static isValidTextInput(value: any): boolean {\n    if (!value) return true;\n    \n    // Allow templates and entities\n    if (this.isTemplate(value) || (typeof value === 'string' && value.includes('.'))) return true;\n    \n    if (typeof value !== 'string') return false;\n    \n    // Check for potentially dangerous content\n    const dangerousPatterns = [\n      /<script/i,\n      /javascript:/i,\n      /vbscript:/i,\n      /on\\w+\\s*=/i, // Event handlers like onclick=\n      /<iframe/i,\n      /<object/i,\n      /<embed/i,\n      /<form/i\n    ];\n    \n    return !dangerousPatterns.some(pattern => pattern.test(value));\n  }\n  \n  /**\n   * Validates styles object structure\n   * @param {*} styles - Styles object to validate\n   * @returns {boolean} - Whether the styles are valid\n   */\n  static isValidStylesInput(styles: any): boolean {\n    if (!styles || typeof styles !== 'object') return false;\n    \n    const validStyleKeys = ['card', 'title', 'subtitle', 'progress_circle'];\n    \n    // Check that all keys are valid\n    const styleKeys = Object.keys(styles);\n    if (!styleKeys.every(key => validStyleKeys.includes(key))) return false;\n    \n    // Check that all values are arrays\n    return styleKeys.every(key => Array.isArray(styles[key]));\n  }\n\n  /**\n   * Detects if a value contains Home Assistant templates\n   * @param {*} value - Value to check\n   * @returns {boolean} - Whether the value is a template\n   */\n  static isTemplate(value: any): boolean {\n    return typeof value === 'string' && \n           value.includes('{{') && \n           value.includes('}}');\n  }\n\n  /**\n   * Validates entity ID format\n   * @param {*} value - Value to validate\n   * @returns {boolean} - Whether the value is a valid entity ID\n   */\n  static isValidEntityId(value: any): boolean {\n    if (!value || typeof value !== 'string') return false;\n    \n    // Allow templates\n    if (this.isTemplate(value)) return true;\n    \n    // Basic entity ID format: domain.entity_name\n    const entityPattern = /^[a-z_]+\\.[a-z0-9_]+$/;\n    return entityPattern.test(value);\n  }\n}\n","import { HomeAssistant, TimeFlowCard, RenderTemplateResult, subscribeRenderTemplate, UnsubscribeFunc } from '../types/index';\n\n/**\n * CacheManager - Simple cache with time-based expiration \n * Used to persist template results across disconnect/reconnect\n */\nclass CacheManager<T> {\n  private _expiration?: number;\n  private _cache = new Map<string, T>();\n\n  constructor(expiration?: number) {\n    this._expiration = expiration;\n  }\n\n  public get(key: string): T | undefined {\n    return this._cache.get(key);\n  }\n\n  public set(key: string, value: T): void {\n    this._cache.set(key, value);\n    if (this._expiration) {\n      window.setTimeout(() => this._cache.delete(key), this._expiration);\n    }\n  }\n\n  public has(key: string): boolean {\n    return this._cache.has(key);\n  }\n\n  public delete(key: string): boolean {\n    return this._cache.delete(key);\n  }\n\n  public clear(): void {\n    this._cache.clear();\n  }\n}\n\n// Global cache for template results - persists across card reconnects (1 minute expiration)\nconst templateCache = new CacheManager<RenderTemplateResult>(60000);\n\n/**\n * TemplateService - Handles Home Assistant template evaluation using WebSocket subscriptions\n * \n * KEY CHANGES from HTTP API approach:\n * - Uses WebSocket subscriptions (subscribeRenderTemplate) instead of HTTP POST\n * - Real-time updates when template dependencies change\n * - Significantly fewer API calls (only one subscription per unique template)\n * - No polling needed - HA pushes updates automatically\n */\nexport class TemplateService {\n  // Map of template string -> subscription unsubscribe function\n  private _unsubRenderTemplates: Map<string, Promise<UnsubscribeFunc>> = new Map();\n\n  // Map of template string -> current result\n  private _templateResults: Map<string, RenderTemplateResult> = new Map();\n\n  // Reference to the card component\n  public card?: TimeFlowCard;\n\n  // Flag to track connection state\n  private _connected: boolean = false;\n\n  constructor() { }\n\n  /**\n   * Connect to template subscriptions - call this in connectedCallback\n   */\n  connect(): void {\n    this._connected = true;\n    // Restore any cached results\n    this._templateResults.forEach((_, template) => {\n      if (templateCache.has(template)) {\n        this._templateResults.set(template, templateCache.get(template)!);\n      }\n    });\n  }\n\n  /**\n   * Disconnect from all template subscriptions - call this in disconnectedCallback\n   * Saves current results to cache for quick restore on reconnect\n   */\n  async disconnect(): Promise<void> {\n    this._connected = false;\n\n    // Save current results to cache before disconnecting\n    this._templateResults.forEach((result, template) => {\n      templateCache.set(template, result);\n    });\n\n    // Unsubscribe from all templates\n    for (const [template, unsubPromise] of this._unsubRenderTemplates.entries()) {\n      try {\n        const unsub = await unsubPromise;\n        unsub();\n      } catch (err: any) {\n        // Connection might already be closed, ignore these errors\n        if (err.code !== 'not_found' && err.code !== 'template_error') {\n          console.warn('[TimeFlow] Error unsubscribing from template:', err);\n        }\n      }\n    }\n    this._unsubRenderTemplates.clear();\n  }\n\n  /**\n   * Subscribe to a template and get real-time updates\n   * Uses WebSocket subscription - much more efficient than HTTP polling\n   */\n  private async _subscribeToTemplate(template: string): Promise<void> {\n    const hass = this.card?.hass;\n\n    if (!hass || !hass.connection || !this._connected) {\n      return;\n    }\n\n    // Already subscribed to this template\n    if (this._unsubRenderTemplates.has(template)) {\n      return;\n    }\n\n    // Check cache first for immediate display\n    if (templateCache.has(template)) {\n      this._templateResults.set(template, templateCache.get(template)!);\n    }\n\n    try {\n      const sub = subscribeRenderTemplate(\n        hass.connection,\n        (result: RenderTemplateResult) => {\n          // Store the result and trigger card update\n          this._templateResults.set(template, result);\n          // Also update the cache for persistence\n          templateCache.set(template, result);\n          // Request card update to reflect new value\n          if (this.card && (this.card as any).requestUpdate) {\n            (this.card as any).requestUpdate();\n          }\n        },\n        {\n          template: template,\n          variables: {\n            user: hass.user?.name ?? 'User',\n          },\n          strict: true, // Fail on invalid templates\n        }\n      );\n\n      this._unsubRenderTemplates.set(template, sub);\n      await sub;\n    } catch (err: any) {\n      // Template subscription failed - use fallback value\n      const fallback = this.extractFallbackFromTemplate(template);\n      this._templateResults.set(template, {\n        result: fallback,\n        listeners: {\n          all: false,\n          domains: [],\n          entities: [],\n          time: false,\n        },\n      });\n      // Remove the failed subscription attempt\n      this._unsubRenderTemplates.delete(template);\n    }\n  }\n\n  /**\n   * Unsubscribe from a specific template\n   */\n  async unsubscribeFromTemplate(template: string): Promise<void> {\n    const unsubPromise = this._unsubRenderTemplates.get(template);\n    if (!unsubPromise) return;\n\n    try {\n      const unsub = await unsubPromise;\n      unsub();\n      this._unsubRenderTemplates.delete(template);\n      this._templateResults.delete(template);\n    } catch (err: any) {\n      if (err.code !== 'not_found' && err.code !== 'template_error') {\n        console.warn('[TimeFlow] Error unsubscribing from template:', err);\n      }\n    }\n  }\n\n  /**\n   * Evaluates a Home Assistant template using WebSocket subscription\n   * Returns cached value immediately if available, subscribes for updates\n   * \n   * @param {string} template - Template string to evaluate\n   * @param {Object} hass - Home Assistant object (not used directly but kept for API compatibility)\n   * @returns {Promise<*>} - Evaluated template result\n   */\n  async evaluateTemplate(template: string, hass: HomeAssistant | null): Promise<any> {\n    if (!template) {\n      return template;\n    }\n\n    // Ensure we're subscribed to this template\n    if (this._connected && this.card?.hass?.connection) {\n      await this._subscribeToTemplate(template);\n    }\n\n    // Return cached result if available\n    if (this._templateResults.has(template)) {\n      return this._templateResults.get(template)!.result;\n    }\n\n    // Check global cache\n    if (templateCache.has(template)) {\n      const cached = templateCache.get(template)!;\n      this._templateResults.set(template, cached);\n      return cached.result;\n    }\n\n    // No cached result yet, return fallback\n    return this.extractFallbackFromTemplate(template);\n  }\n\n  /**\n   * Extracts fallback value from template expressions with 'or' operator\n   * @param {string} template - Template string\n   * @returns {string} - Extracted fallback value\n   */\n  extractFallbackFromTemplate(template: string): string {\n    if (!template || typeof template !== 'string') {\n      return template;\n    }\n\n    try {\n      // Remove the outer {{ }} to work with the inner expression\n      const innerTemplate = template.replace(/^\\{\\{\\s*/, '').replace(/\\s*\\}\\}$/, '').trim();\n\n      // Look for patterns like \"states('entity') or 'fallback'\"\n      const simpleOrPattern = /^(.+?)\\s+or\\s+['\"`]([^'\"`]+)['\"`]$/;\n      const simpleOrMatch = innerTemplate.match(simpleOrPattern);\n\n      if (simpleOrMatch && simpleOrMatch[2]) {\n        return simpleOrMatch[2];\n      }\n\n      // Look for chained or patterns like \"states('entity1') or states('entity2') or 'fallback'\"\n      const chainedOrPattern = /^(.+?)\\s+or\\s+(.+?)\\s+or\\s+['\"`]([^'\"`]+)['\"`]$/;\n      const chainedMatch = innerTemplate.match(chainedOrPattern);\n\n      if (chainedMatch && chainedMatch[3]) {\n        return chainedMatch[3];\n      }\n\n      // Look for conditional patterns like \"'value' if condition else 'fallback'\"\n      const conditionalPattern = /^['\"`]([^'\"`]+)['\"`]\\s+if\\s+(.+?)\\s+else\\s+['\"`]([^'\"`]+)['\"`]$/;\n      const conditionalMatch = innerTemplate.match(conditionalPattern);\n\n      if (conditionalMatch && conditionalMatch[3]) {\n        return conditionalMatch[3];\n      }\n\n      // Look for reverse conditional patterns like \"condition if test else 'fallback'\"\n      const reverseConditionalPattern = /^(.+?)\\s+if\\s+(.+?)\\s+else\\s+['\"`]([^'\"`]+)['\"`]$/;\n      const reverseMatch = innerTemplate.match(reverseConditionalPattern);\n\n      if (reverseMatch && reverseMatch[3]) {\n        return reverseMatch[3];\n      }\n\n      // If no fallback pattern found, return a helpful message\n      return 'Unavailable';\n    } catch (error) {\n      return 'Template Error';\n    }\n  }\n\n  /**\n   * Detects if a value contains Home Assistant templates\n   * @param {*} value - Value to check\n   * @returns {boolean} - Whether the value is a template\n   */\n  isTemplate(value: any): boolean {\n    return typeof value === 'string' &&\n      value.includes('{{') &&\n      value.includes('}}');\n  }\n\n  /**\n   * Validates template format to prevent bad API calls\n   * @param {string} template - Template string to validate\n   * @returns {boolean} - Whether template is valid\n   */\n  isValidTemplate(template: string): boolean {\n    if (!template || typeof template !== 'string') return false;\n\n    // Check for basic template format\n    if (!template.includes('{{') || !template.includes('}}')) return false;\n\n    // Check for balanced braces\n    const openBraces = (template.match(/\\{\\{/g) || []).length;\n    const closeBraces = (template.match(/\\}\\}/g) || []).length;\n    if (openBraces !== closeBraces) return false;\n\n    // Check for empty template\n    const content = template.replace(/\\{\\{\\s*/, '').replace(/\\s*\\}\\}/, '').trim();\n    if (!content) return false;\n\n    return true;\n  }\n\n  /**\n   * Enhanced value resolver that handles entities, templates, and plain strings\n   * @param {*} value - Value to resolve\n   * @returns {Promise<*>} - Resolved value\n   */\n  async resolveValue(value: string): Promise<string | undefined> {\n    if (!value) return undefined;\n\n    if (this.isTemplate(value)) {\n      const hass = this.card?.hass || null;\n      const result = await this.evaluateTemplate(value, hass);\n      return result || undefined;\n    }\n\n    // Handle entity state\n    const hass = this.card?.hass;\n    if (typeof value === 'string' && value.includes('.') && hass && hass.states[value]) {\n      const entity = hass.states[value];\n      if (!entity) {\n        return undefined;\n      }\n      return entity.state;\n    }\n\n    return value;\n  }\n\n  /**\n   * Clears template subscriptions and results\n   * Note: With WebSocket subscriptions, this is less commonly needed\n   * as the subscriptions auto-update when dependencies change\n   */\n  clearTemplateCache(): void {\n    // Disconnect from all subscriptions\n    this.disconnect();\n    // Clear local results\n    this._templateResults.clear();\n  }\n\n  /**\n   * Checks if the current config contains any templates\n   * @param {Object} config - Configuration object\n   * @returns {boolean} - Whether config contains templates\n   */\n  hasTemplatesInConfig(config: any): boolean {\n    if (!config) return false;\n\n    // Check common template-enabled properties\n    const templateProperties = [\n      'target_date', 'creation_date', 'title', 'subtitle',\n      'color', 'background_color', 'progress_color', 'primary_color', 'secondary_color'\n    ];\n\n    return templateProperties.some(prop =>\n      config[prop] && this.isTemplate(config[prop])\n    );\n  }\n\n  /**\n   * Escapes HTML special characters to prevent XSS and ensure proper display\n   * @param {*} text - Text to escape\n   * @returns {string} - Escaped text\n   */\n  escapeHtml(text: string): string {\n    if (text == null || text === undefined) return '';\n    return String(text)\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#39;');\n  }\n}","// Enhanced types/index.ts with Alexa Timer support and Action handling\n// Updated to support WebSocket subscriptions for efficient template evaluation\n\nimport { UnsubscribeFunc, Connection } from 'home-assistant-js-websocket';\n\nexport interface HomeAssistant {\n  states: { [entity_id: string]: any };\n  callService: (domain: string, service: string, serviceData?: any) => void;\n  callApi: (method: string, path: string, data?: any) => Promise<any>;\n  connection: Connection; // WebSocket connection for subscriptions\n  user?: {\n    name: string;\n    id: string;\n    is_admin: boolean;\n    is_owner: boolean;\n  };\n  locale: {\n    language: string;\n    [key: string]: any;\n  };\n  // Add other HA properties as needed\n}\n\n// WebSocket template rendering types (matches Home Assistant's API)\nexport interface RenderTemplateResult {\n  result: string;\n  listeners: TemplateListeners;\n}\n\nexport interface TemplateListeners {\n  all: boolean;\n  domains: string[];\n  entities: string[];\n  time: boolean;\n}\n\n// Function to subscribe to template rendering via WebSocket\nexport const subscribeRenderTemplate = (\n  conn: Connection,\n  onChange: (result: RenderTemplateResult) => void,\n  params: {\n    template: string;\n    entity_ids?: string | string[];\n    variables?: Record<string, unknown>;\n    timeout?: number;\n    strict?: boolean;\n  }\n): Promise<UnsubscribeFunc> =>\n  conn.subscribeMessage<RenderTemplateResult>((msg) => onChange(msg), {\n    type: 'render_template',\n    ...params,\n  });\n\n// Re-export for convenience\nexport type { UnsubscribeFunc };\n\nexport interface CountdownState {\n  months: number;\n  days: number;\n  hours: number;\n  minutes: number;\n  seconds: number;\n  total: number;\n}\n\n// Add TimeFlowCard interface for TemplateService\nexport interface TimeFlowCard {\n  hass: HomeAssistant | null;\n  // Add other properties as needed\n}\n\n// Action configuration types\nexport interface ActionConfig {\n  action: 'more-info' | 'toggle' | 'call-service' | 'navigate' | 'url' | 'none';\n  entity?: string;\n  service?: string;\n  service_data?: { [key: string]: any };\n  data?: { [key: string]: any };\n  target?: {\n    entity_id?: string | string[];\n    device_id?: string | string[];\n    area_id?: string | string[];\n  };\n  navigation_path?: string;\n  url_path?: string;\n  confirmation?: boolean | {\n    text?: string;\n    exemptions?: Array<{ user: string }>;\n  };\n  haptic?: 'success' | 'warning' | 'failure' | 'light' | 'medium' | 'heavy' | 'selection';\n}\n\n// Action handler event interface\nexport interface ActionHandlerEvent extends Event {\n  detail: {\n    action: 'tap' | 'hold' | 'double_tap';\n  };\n}\n\n// Card style options\nexport type CardStyle = 'classic' | 'eventy' | 'classic-compact';\n\nexport interface CardConfig {\n  type: string;\n\n  // Card style\n  style?: CardStyle;  // 'classic' = circle progress, 'eventy' = compact horizontal, 'classic-compact' = horizontal with circle\n\n  // Basic countdown configuration\n  target_date?: string;\n  creation_date?: string;\n\n  // Timer entity configuration (enhanced for Alexa and Google Home)\n  timer_entity?: string;\n  auto_discover_alexa?: boolean; // NEW: Automatically find and use Alexa timers\n  auto_discover_google?: boolean; // NEW: Automatically find and use Google Home timers\n  alexa_device_filter?: string[];  // NEW: Only use timers from specific Alexa devices\n  prefer_labeled_timers?: boolean; // NEW: Prefer timers with labels over unnamed ones\n\n  // Display configuration\n  title?: string;\n  subtitle?: string;\n  subtitle_prefix?: string;  // Text to prepend to countdown (e.g., \"in\", \"Only\")\n  subtitle_suffix?: string;  // Text to append to countdown (e.g., \"left\", \"remaining\")\n\n  // Header icon configuration\n  header_icon?: string;           // Icon to display next to title (e.g., \"mdi:cake-variant\")\n  header_icon_color?: string;     // Icon color (e.g., \"#3b82f6\")\n  header_icon_background?: string; // Icon background color (e.g., \"rgba(59, 130, 246, 0.2)\")\n\n  // Time unit visibility\n  show_months?: boolean;\n  show_days?: boolean;\n  show_hours?: boolean;\n  show_minutes?: boolean;\n  show_seconds?: boolean;\n\n  // Subtitle format configuration\n  compact_format?: boolean;  // Use compact format (auto-enabled if 3+ units shown)\n\n  // Action configuration\n  tap_action?: ActionConfig;\n  hold_action?: ActionConfig;\n  double_tap_action?: ActionConfig;\n\n  // Styling\n  text_color?: string;\n  background_color?: string;\n  progress_color?: string;\n  primary_color?: string;\n  secondary_color?: string;\n  stroke_width?: number;\n  icon_size?: number;\n\n  // Card dimensions\n  width?: string | number;\n  height?: string | number;\n  aspect_ratio?: string;\n\n  // Completion behavior\n  expired_animation?: boolean;\n  expired_text?: string;\n\n  // Alexa-specific styling (NEW)\n  alexa_color?: string;           // Custom color for Alexa timers\n  show_alexa_device?: boolean;    // Show device name in subtitle\n  alexa_icon?: string;           // Custom icon for Alexa timers\n\n  // Debug options\n  debug?: boolean;\n  show_timer_info?: boolean;     // NEW: Show debug info about discovered timers\n\n  // Allow any additional string properties to fix template key indexing\n  [key: string]: any;\n}","/**\n * TimeUtils - Shared time constants and utilities\n * Provides centralized time conversion constants and helper functions\n * to eliminate magic numbers and duplicate logic across the codebase.\n */\n\n// ============================================================================\n// Time Conversion Constants (in milliseconds)\n// ============================================================================\n\nexport const MS_PER_SECOND = 1000;\nexport const MS_PER_MINUTE = 60 * MS_PER_SECOND;      // 60,000\nexport const MS_PER_HOUR = 60 * MS_PER_MINUTE;        // 3,600,000\nexport const MS_PER_DAY = 24 * MS_PER_HOUR;           // 86,400,000\n\n// Seconds-based constants (for timer calculations)\nexport const SECONDS_PER_MINUTE = 60;\nexport const SECONDS_PER_HOUR = 60 * SECONDS_PER_MINUTE;   // 3,600\nexport const SECONDS_PER_DAY = 24 * SECONDS_PER_HOUR;      // 86,400\n\n// ============================================================================\n// CSS/Style Constants\n// ============================================================================\n\n/** Default background color - inherits from HA card theming */\nexport const DEFAULT_BACKGROUND = 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color, transparent)))';\n\n/** Default text color - inherits from HA theme */\nexport const DEFAULT_TEXT_COLOR = 'var(--primary-text-color, inherit)';\n\n// ============================================================================\n// Time Units Interface\n// ============================================================================\n\nexport interface TimeUnits {\n  days: number;\n  hours: number;\n  minutes: number;\n  seconds: number;\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Parses milliseconds into time units (days, hours, minutes, seconds)\n * @param ms - Total milliseconds\n * @returns TimeUnits object with days, hours, minutes, seconds\n */\nexport function parseMillisecondsToUnits(ms: number): TimeUnits {\n  if (ms <= 0) {\n    return { days: 0, hours: 0, minutes: 0, seconds: 0 };\n  }\n  \n  const days = Math.floor(ms / MS_PER_DAY);\n  const hours = Math.floor((ms % MS_PER_DAY) / MS_PER_HOUR);\n  const minutes = Math.floor((ms % MS_PER_HOUR) / MS_PER_MINUTE);\n  const seconds = Math.floor((ms % MS_PER_MINUTE) / MS_PER_SECOND);\n  \n  return { days, hours, minutes, seconds };\n}\n\n/**\n * Parses seconds into time units (for timer entity remaining time)\n * @param totalSeconds - Total seconds\n * @returns TimeUnits object with days, hours, minutes, seconds\n */\nexport function parseSecondsToUnits(totalSeconds: number): TimeUnits {\n  if (totalSeconds <= 0) {\n    return { days: 0, hours: 0, minutes: 0, seconds: 0 };\n  }\n  \n  const days = Math.floor(totalSeconds / SECONDS_PER_DAY);\n  const hours = Math.floor((totalSeconds % SECONDS_PER_DAY) / SECONDS_PER_HOUR);\n  const minutes = Math.floor((totalSeconds % SECONDS_PER_HOUR) / SECONDS_PER_MINUTE);\n  const seconds = Math.floor(totalSeconds % SECONDS_PER_MINUTE);\n  \n  return { days, hours, minutes, seconds };\n}\n\n// ============================================================================\n// Singular/Plural Label Utilities\n// ============================================================================\n\n/**\n * Unit label definitions for consistent singular/plural handling\n * Maps time units to their singular and plural forms for different display contexts\n */\nexport const TIME_UNIT_LABELS = {\n  // Compact uppercase labels (for Eventy style)\n  eventy: {\n    month: { singular: 'MONTH', plural: 'MONTHS' },\n    day: { singular: 'DAY', plural: 'DAYS' },\n    hour: { singular: 'HOUR', plural: 'HOURS' },\n    minute: { singular: 'MIN', plural: 'MINS' },\n    second: { singular: 'SEC', plural: 'SECS' },\n  },\n  // Standard labels with \"left\" suffix (for main display)\n  mainDisplay: {\n    month: { singular: 'month left', plural: 'months left' },\n    day: { singular: 'day left', plural: 'days left' },\n    hour: { singular: 'hour left', plural: 'hours left' },\n    minute: { singular: 'minute left', plural: 'minutes left' },\n    second: { singular: 'second left', plural: 'seconds left' },\n  },\n  // Standard labels without suffix (for timer displays)\n  timer: {\n    month: { singular: 'month', plural: 'months' },\n    day: { singular: 'day', plural: 'days' },\n    hour: { singular: 'hour', plural: 'hours' },\n    minute: { singular: 'minute', plural: 'minutes' },\n    second: { singular: 'second', plural: 'seconds' },\n  },\n} as const;\n\nexport type TimeUnitType = 'month' | 'day' | 'hour' | 'minute' | 'second';\nexport type LabelStyle = keyof typeof TIME_UNIT_LABELS;\n\n/**\n * Gets the appropriate singular or plural label for a time unit\n * @param unit - The time unit type (month, day, hour, minute, second)\n * @param value - The numeric value to determine singular/plural\n * @param style - The label style ('eventy', 'mainDisplay', or 'timer')\n * @returns The appropriate label string\n */\nexport function getUnitLabel(unit: TimeUnitType, value: number, style: LabelStyle = 'mainDisplay'): string {\n  const labels = TIME_UNIT_LABELS[style][unit];\n  return value === 1 ? labels.singular : labels.plural;\n}\n\n/**\n * Translation key mapping for eventy-style labels\n * Maps unit type and plurality to the correct localization key\n */\nconst EVENTY_TRANSLATION_KEYS: Record<TimeUnitType, { singular: string; plural: string }> = {\n  month: { singular: 'time.month_eventy', plural: 'time.months_eventy' },\n  day: { singular: 'time.day_eventy', plural: 'time.days_eventy' },\n  hour: { singular: 'time.hour_eventy', plural: 'time.hours_eventy' },\n  minute: { singular: 'time.minute_eventy', plural: 'time.minutes_eventy' },\n  second: { singular: 'time.second_eventy', plural: 'time.seconds_eventy' },\n};\n\n/**\n * LocalizeFunction type - matches the signature from localize.ts\n */\ntype LocalizeFn = (key: string, args?: Record<string, any>) => string;\n\n/**\n * Gets the appropriate localized label for a time unit in Eventy style\n * @param unit - The time unit type (month, day, hour, minute, second)\n * @param value - The numeric value to determine singular/plural\n * @param localize - The localization function from setupLocalize()\n * @returns The localized label string (e.g., 'DAS' in Spanish for days > 1)\n */\nexport function getLocalizedEventyLabel(unit: TimeUnitType, value: number, localize?: LocalizeFn): string {\n  // If no localize function provided, fall back to hardcoded English\n  if (!localize) {\n    return getUnitLabel(unit, value, 'eventy');\n  }\n  \n  const keys = EVENTY_TRANSLATION_KEYS[unit];\n  const key = value === 1 ? keys.singular : keys.plural;\n  return localize(key);\n}\n","import { TemplateService } from './TemplateService';\nimport { HomeAssistant, CountdownState, CardConfig } from '../types/index';\nimport { TimerEntityService, TimerData } from './Timer';\nimport { LocalizeFunction } from '../utils/localize';\nimport { \n  MS_PER_SECOND, \n  MS_PER_MINUTE, \n  MS_PER_HOUR, \n  MS_PER_DAY,\n  SECONDS_PER_MINUTE,\n  SECONDS_PER_HOUR,\n  parseMillisecondsToUnits,\n  parseSecondsToUnits,\n  getUnitLabel\n} from '../utils/TimeUtils';\n\n/**\n * CountdownService - Enhanced with Alexa Timer support\n * Handles countdown calculations and time unit management\n * Provides clean separation of countdown logic from presentation\n */\nexport class CountdownService {\n  private templateService: any;\n  private dateParser: any;\n  private timeRemaining: CountdownState;\n  private expired: boolean;\n  // Cache last selected smart timer (for autodiscovery finished display - Alexa or Google)\n  private lastAlexaTimerData: any | null;\n\n  constructor(templateService: any, dateParser: any) {\n    this.templateService = templateService;\n    this.dateParser = dateParser;\n    this.timeRemaining = { months: 0, days: 0, hours: 0, minutes: 0, seconds: 0, total: 0 };\n    this.expired = false;\n    this.lastAlexaTimerData = null;\n  }\n\n  /**\n   * Calculates precise calendar months between now and target date\n   * Returns the number of full calendar months and remaining milliseconds\n   * @param {Date} nowDate - Current date\n   * @param {Date} targetDate - Target date\n   * @returns {{ months: number, remainingMs: number }} - Calendar months and remaining time\n   */\n  private _calculateCalendarMonths(nowDate: Date, targetDate: Date): { months: number; remainingMs: number } {\n    // Handle expired case\n    if (targetDate <= nowDate) {\n      return { months: 0, remainingMs: 0 };\n    }\n\n    // Count full calendar months by iterating\n    let months = 0;\n    const tempDate = new Date(nowDate);\n\n    while (true) {\n      const nextMonth = new Date(tempDate);\n      nextMonth.setMonth(nextMonth.getMonth() + 1);\n      if (nextMonth <= targetDate) {\n        months++;\n        tempDate.setMonth(tempDate.getMonth() + 1);\n      } else {\n        break;\n      }\n    }\n\n    // Calculate remaining milliseconds after full months\n    const remainingMs = targetDate.getTime() - tempDate.getTime();\n\n    return { months, remainingMs };\n  }\n\n  /**\n   * Discovers and selects the best smart timer based on priority:\n   * active  paused  finished\n   * \n   * @param config - Card configuration\n   * @param hass - Home Assistant object\n   * @returns Object with chosen entity ID and timer data, or null if none found\n   */\n  private _findBestSmartTimer(\n    config: CardConfig,\n    hass: HomeAssistant\n  ): { entityId: string; timerData: TimerData } | null {\n    // Skip if explicit timer_entity is configured\n    if (config.timer_entity) return null;\n\n    // Skip if auto-discovery is not enabled\n    if (!config.auto_discover_alexa && !config.auto_discover_google) return null;\n\n    const smartTimers: string[] = [];\n\n    if (config.auto_discover_alexa) {\n      smartTimers.push(...TimerEntityService.discoverAlexaTimers(hass));\n    }\n    if (config.auto_discover_google) {\n      smartTimers.push(...TimerEntityService.discoverGoogleTimers(hass));\n    }\n\n    if (smartTimers.length === 0) return null;\n\n    // Priority selection: active  paused  finished\n    const priorities: Array<(data: TimerData) => boolean> = [\n      (t) => t.isActive,\n      (t) => t.isPaused,\n      (t) => !!t.finished,\n    ];\n\n    for (const predicate of priorities) {\n      const entityId = smartTimers.find(id => {\n        const data = TimerEntityService.getTimerData(id, hass);\n        return data && predicate(data);\n      });\n\n      if (entityId) {\n        const timerData = TimerEntityService.getTimerData(entityId, hass);\n        if (timerData) {\n          return { entityId, timerData };\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Updates the countdown based on current configuration (enhanced for Alexa)\n   * @param {Object} config - Card configuration\n   * @param {Object} hass - Home Assistant object\n   * @returns {Promise<Object>} - Time remaining object\n   */\n  async updateCountdown(config: CardConfig, hass: HomeAssistant | null): Promise<CountdownState> {\n    try {\n      // TIMER ENTITY SUPPORT (including Alexa timers)\n      if (config.timer_entity && hass) {\n        const timerData = TimerEntityService.getTimerData(config.timer_entity, hass);\n        if (timerData) {\n          // Convert TimerData to CountdownState\n          this.timeRemaining = this._timerDataToCountdownState(timerData);\n          this.expired = TimerEntityService.isTimerExpired(timerData);\n          return this.timeRemaining;\n        }\n      }\n\n      // AUTO-DISCOVERY: Try smart assistant timers if enabled\n      if (hass) {\n        const smartTimer = this._findBestSmartTimer(config, hass);\n        if (smartTimer) {\n          // Cache for later finished display when list becomes empty\n          this.lastAlexaTimerData = smartTimer.timerData;\n          this.timeRemaining = this._timerDataToCountdownState(smartTimer.timerData);\n          this.expired = TimerEntityService.isTimerExpired(smartTimer.timerData);\n          return this.timeRemaining;\n        }\n\n        // Check if auto-discovery was enabled but no timer found\n        if (config.auto_discover_alexa || config.auto_discover_google) {\n          // Fallback: if we have cached data and it's finished, return finished state\n          if (this.lastAlexaTimerData && TimerEntityService.isTimerExpired(this.lastAlexaTimerData)) {\n            this.timeRemaining = this._timerDataToCountdownState(this.lastAlexaTimerData);\n            this.expired = true;\n            return this.timeRemaining;\n          }\n          // No active or paused timers - clear state\n          this.lastAlexaTimerData = null;\n          this.timeRemaining = { months: 0, days: 0, hours: 0, minutes: 0, seconds: 0, total: 0 };\n          this.expired = false;\n          return this.timeRemaining;\n        }\n      }\n\n      if (!config.target_date) return this.timeRemaining;\n\n      const now = new Date().getTime();\n      const targetDateValue = await this.templateService.resolveValue(config.target_date);\n\n      if (!targetDateValue) {\n        return this.timeRemaining;\n      }\n\n      // Use the helper method for consistent date parsing\n      const targetDate = this.dateParser.parseISODate(targetDateValue);\n\n      if (isNaN(targetDate)) {\n        return this.timeRemaining;\n      }\n\n      const difference = targetDate - now;\n\n      if (difference > 0) {\n        // Calculate time units based on what's enabled - cascade disabled units into enabled ones\n        const { show_months, show_days, show_hours, show_minutes, show_seconds } = config;\n\n        let months = 0, days = 0, hours = 0, minutes = 0, seconds = 0;\n        let totalMilliseconds = difference;\n\n        // Use calendar-based month calculation for precise results\n        if (show_months) {\n          const nowDate = new Date(now);\n          const targetDateObj = new Date(targetDate);\n          const calendarResult = this._calculateCalendarMonths(nowDate, targetDateObj);\n          months = calendarResult.months;\n          totalMilliseconds = calendarResult.remainingMs;\n        }\n\n        if (show_days) {\n          days = Math.floor(totalMilliseconds / MS_PER_DAY);\n          totalMilliseconds %= MS_PER_DAY;\n        } else if (show_months && !show_days) {\n          // If days are disabled but months are enabled, convert remaining days to additional months\n          // Use calendar logic: count how many more full months fit in the remaining time\n          const nowDate = new Date(now);\n          nowDate.setMonth(nowDate.getMonth() + months);\n          const targetDateObj = new Date(targetDate);\n          const additionalResult = this._calculateCalendarMonths(nowDate, targetDateObj);\n          months += additionalResult.months;\n          totalMilliseconds = additionalResult.remainingMs;\n        }\n\n        if (show_hours) {\n          hours = Math.floor(totalMilliseconds / MS_PER_HOUR);\n          totalMilliseconds %= MS_PER_HOUR;\n        } else if ((show_months || show_days) && !show_hours) {\n          // If hours are disabled but larger units are enabled, add hours to the largest enabled unit\n          const extraHours = Math.floor(totalMilliseconds / MS_PER_HOUR);\n          if (show_days) {\n            days += Math.floor(extraHours / 24);\n          }\n          // Note: We don't add hours to months anymore since calendar months are precise\n          totalMilliseconds %= MS_PER_HOUR;\n        }\n\n        if (show_minutes) {\n          minutes = Math.floor(totalMilliseconds / MS_PER_MINUTE);\n          totalMilliseconds %= MS_PER_MINUTE;\n        } else if ((show_months || show_days || show_hours) && !show_minutes) {\n          // If minutes are disabled but larger units are enabled, add minutes to the largest enabled unit\n          const extraMinutes = Math.floor(totalMilliseconds / MS_PER_MINUTE);\n          if (show_hours) {\n            hours += Math.floor(extraMinutes / SECONDS_PER_MINUTE);\n          } else if (show_days) {\n            days += Math.floor(extraMinutes / (SECONDS_PER_MINUTE * 24));\n          }\n          totalMilliseconds %= MS_PER_MINUTE;\n        }\n\n        if (show_seconds) {\n          seconds = Math.floor(totalMilliseconds / MS_PER_SECOND);\n        } else if ((show_months || show_days || show_hours || show_minutes) && !show_seconds) {\n          // If seconds are disabled but larger units are enabled, add seconds to the largest enabled unit\n          const extraSeconds = Math.floor(totalMilliseconds / MS_PER_SECOND);\n          if (show_minutes) {\n            minutes += Math.floor(extraSeconds / SECONDS_PER_MINUTE);\n          } else if (show_hours) {\n            hours += Math.floor(extraSeconds / SECONDS_PER_HOUR);\n          } else if (show_days) {\n            days += Math.floor(extraSeconds / (SECONDS_PER_HOUR * 24));\n          }\n        }\n\n        this.timeRemaining = { months, days, hours, minutes, seconds, total: difference };\n        this.expired = false;\n      } else {\n        this.timeRemaining = { months: 0, days: 0, hours: 0, minutes: 0, seconds: 0, total: 0 };\n        this.expired = true;\n      }\n\n      return this.timeRemaining;\n    } catch (error) {\n      return this.timeRemaining;\n    }\n  }\n\n  /**\n   * Calculates progress percentage (enhanced for Alexa and Google Home)\n   * @param {Object} config - Card configuration\n   * @param {Object} hass - Home Assistant object\n   * @returns {Promise<number>} - Progress percentage (0-100)\n   */\n  async calculateProgress(config: CardConfig, hass: HomeAssistant | null): Promise<number> {\n    // TIMER ENTITY SUPPORT (including Alexa and Google timers)\n    if (config.timer_entity && hass) {\n      const timerData = TimerEntityService.getTimerData(config.timer_entity, hass);\n      if (!timerData) return 0;\n      return timerData.progress;\n    }\n\n    // AUTO-DISCOVERY: Try smart assistant timers if enabled\n    if (hass) {\n      const smartTimer = this._findBestSmartTimer(config, hass);\n      if (smartTimer) {\n        return smartTimer.timerData.progress;\n      }\n    }\n\n    const targetDateValue = await this.templateService.resolveValue(config.target_date);\n    if (!targetDateValue) return 0;\n\n    // Use the helper method for consistent date parsing\n    const targetDate = this.dateParser.parseISODate(targetDateValue);\n    const now = Date.now();\n\n    let creationDate;\n    if (config.creation_date) {\n      const creationDateValue = await this.templateService.resolveValue(config.creation_date);\n\n      if (creationDateValue) {\n        // Use the helper method for consistent date parsing\n        creationDate = this.dateParser.parseISODate(creationDateValue);\n      } else {\n        creationDate = now;\n      }\n    } else {\n      creationDate = now; // Fallback to now if somehow no creation date\n    }\n\n    const totalDuration = targetDate - creationDate;\n    if (totalDuration <= 0) return 100;\n\n    const elapsed = now - creationDate;\n    const progress = Math.min(100, Math.max(0, (elapsed / totalDuration) * 100));\n\n    return this.expired ? 100 : progress;\n  }\n\n  /**\n   * Gets the main display value and label (enhanced for Alexa and Google Home)\n   * @param {Object} config - Card configuration\n   * @param {Object} hass - Home Assistant object (NEW parameter)\n   * @returns {Object} - Object with value and label properties\n   */\n  getMainDisplay(config: CardConfig, hass?: HomeAssistant | null): { value: string; label: string } {\n    // TIMER ENTITY SUPPORT (including Alexa and Google timers)\n    if (config.timer_entity && hass) {\n      const timerData = TimerEntityService.getTimerData(config.timer_entity, hass);\n      if (timerData) {\n        const { hours, minutes, seconds } = this.timeRemaining;\n\n        // Special handling for smart assistant timers\n        if (timerData.isAlexaTimer || timerData.isGoogleTimer) {\n          if (TimerEntityService.isTimerExpired(timerData)) {\n            return { value: '', label: TimerEntityService.getTimerSubtitle(timerData, false) };\n          }\n          if (hours > 0) return { value: hours.toString(), label: getUnitLabel('hour', hours, 'mainDisplay') };\n          if (minutes > 0) return { value: minutes.toString(), label: getUnitLabel('minute', minutes, 'mainDisplay') };\n          return { value: seconds.toString(), label: getUnitLabel('second', seconds, 'mainDisplay') };\n        }\n\n        // Standard timer handling\n        if (hours > 0) return { value: hours.toString(), label: getUnitLabel('hour', hours, 'timer') };\n        if (minutes > 0) return { value: minutes.toString(), label: getUnitLabel('minute', minutes, 'timer') };\n        return { value: seconds.toString(), label: getUnitLabel('second', seconds, 'timer') };\n      }\n    }\n\n    // AUTO-DISCOVERY: Try smart assistant timers if enabled\n    if (hass) {\n      const smartTimer = this._findBestSmartTimer(config, hass);\n      if (smartTimer) {\n        const { timerData } = smartTimer;\n        // Cache for finished view if list empties out later\n        this.lastAlexaTimerData = timerData;\n        // Update time remaining for proper display calculation\n        this.timeRemaining = this._timerDataToCountdownState(timerData);\n        const { hours, minutes, seconds } = this.timeRemaining;\n        if (TimerEntityService.isTimerExpired(timerData)) {\n          return { value: '', label: TimerEntityService.getTimerSubtitle(timerData, false) };\n        }\n        if (hours > 0) return { value: hours.toString(), label: getUnitLabel('hour', hours, 'mainDisplay') };\n        if (minutes > 0) return { value: minutes.toString(), label: getUnitLabel('minute', minutes, 'mainDisplay') };\n        return { value: seconds.toString(), label: getUnitLabel('second', seconds, 'mainDisplay') };\n      }\n\n      // No timer found; check if auto-discovery was enabled\n      if (config.auto_discover_alexa || config.auto_discover_google) {\n        // Fallback: if we have a cached timer that's finished, show its finished label\n        if (this.lastAlexaTimerData && TimerEntityService.isTimerExpired(this.lastAlexaTimerData)) {\n          return { value: '', label: TimerEntityService.getTimerSubtitle(this.lastAlexaTimerData, false) };\n        }\n      }\n    }\n\n    const { show_months, show_days, show_hours, show_minutes, show_seconds } = config;\n    const { months, days, hours, minutes, seconds } = this.timeRemaining;\n\n    if (this.expired) {\n      // For auto-discovered smart assistant timers, prefer timer-style expired text and cached label if available\n      if (config.auto_discover_alexa || config.auto_discover_google) {\n        if (this.lastAlexaTimerData) {\n          return { value: '', label: TimerEntityService.getTimerSubtitle(this.lastAlexaTimerData, false) };\n        }\n        return { value: '', label: 'Timer complete' };\n      }\n      return { value: 'Done', label: 'Completed!' };\n    }\n\n    // Show the largest time unit that is enabled and has a value > 0\n    if (show_months && months > 0) {\n      return { value: months.toString(), label: getUnitLabel('month', months, 'mainDisplay') };\n    } else if (show_days && days > 0) {\n      return { value: days.toString(), label: getUnitLabel('day', days, 'mainDisplay') };\n    } else if (show_hours && hours > 0) {\n      return { value: hours.toString(), label: getUnitLabel('hour', hours, 'mainDisplay') };\n    } else if (show_minutes && minutes > 0) {\n      return { value: minutes.toString(), label: getUnitLabel('minute', minutes, 'mainDisplay') };\n    } else if (show_seconds && seconds >= 0) {\n      return { value: seconds.toString(), label: getUnitLabel('second', seconds, 'mainDisplay') };\n    }\n\n    return { value: '0', label: getUnitLabel('second', 0, 'mainDisplay') };\n  }\n\n  /**\n   * Gets the subtitle text showing time breakdown (enhanced for Alexa and Google Home)\n   * @param {Object} config - Card configuration\n   * @param {Object} hass - Home Assistant object\n   * @param {LocalizeFunction} localize - Optional localization function\n   * @returns {string} - Formatted subtitle text\n   */\n  getSubtitle(config: CardConfig, hass: HomeAssistant | null, localize?: LocalizeFunction, useCompact: boolean = true): string {\n    const t = localize || ((key: string) => key);\n    // TIMER ENTITY SUPPORT (Handles explicit entity)\n    if (config.timer_entity && hass) {\n      const timerData = TimerEntityService.getTimerData(config.timer_entity, hass);\n      if (timerData) {\n        // For smart assistant timers, always use their specific subtitle logic\n        if (timerData.isAlexaTimer || timerData.isGoogleTimer) {\n          return TimerEntityService.getTimerSubtitle(timerData, config.show_seconds !== false, localize, useCompact);\n        }\n        // For standard HA timers, use the timer subtitle if available\n        return TimerEntityService.getTimerSubtitle(timerData, config.show_seconds !== false, localize, useCompact);\n      }\n      return 'Timer not found';\n    }\n\n    // --- AUTO-DISCOVERY: Try smart assistant timers if enabled ---\n    if (hass) {\n      const smartTimer = this._findBestSmartTimer(config, hass);\n      if (smartTimer) {\n        const { timerData } = smartTimer;\n        // Cache for finished fallback\n        this.lastAlexaTimerData = timerData;\n        this.timeRemaining = this._timerDataToCountdownState(timerData);\n        return TimerEntityService.getTimerSubtitle(timerData, config.show_seconds !== false, localize, useCompact);\n      }\n\n      // Check if auto-discovery was enabled but no timer found\n      if (config.auto_discover_alexa || config.auto_discover_google) {\n        // Fallback: if we have a cached timer that just finished, show its subtitle\n        if (this.lastAlexaTimerData && TimerEntityService.isTimerExpired(this.lastAlexaTimerData)) {\n          return TimerEntityService.getTimerSubtitle(this.lastAlexaTimerData, config.show_seconds !== false, localize, useCompact);\n        }\n        // No smart timer entities were discovered at all\n        return t('timer.no_timers');\n      }\n    }\n\n    // --- FALLBACK TO STANDARD COUNTDOWN ---\n    if (this.expired) {\n      const { expired_text = t('countdown.completed') } = config;\n      return expired_text;\n    }\n\n    const { months, days, hours, minutes, seconds } = this.timeRemaining || { months: 0, days: 0, hours: 0, minutes: 0, seconds: 0 };\n    const { show_months, show_days, show_hours, show_minutes, show_seconds, compact_format, subtitle_prefix, subtitle_suffix } = config;\n\n    const parts = [];\n\n    if (show_months && months > 0) parts.push({ value: months, unit: months === 1 ? t('time.month_full') : t('time.months_full') });\n    if (show_days && days > 0) parts.push({ value: days, unit: days === 1 ? t('time.day_full') : t('time.days_full') });\n    if (show_hours && hours > 0) parts.push({ value: hours, unit: hours === 1 ? t('time.hour_full') : t('time.hours_full') });\n    if (show_minutes && minutes > 0) parts.push({ value: minutes, unit: minutes === 1 ? t('time.minute_full') : t('time.minutes_full') });\n    if (show_seconds && seconds > 0) parts.push({ value: seconds, unit: seconds === 1 ? t('time.second_full') : t('time.seconds_full') });\n\n    // Helper to apply prefix/suffix\n    const applyPrefixSuffix = (text: string): string => {\n      const prefix = subtitle_prefix ? `${subtitle_prefix} ` : '';\n      const suffix = subtitle_suffix ? ` ${subtitle_suffix}` : '';\n      return `${prefix}${text}${suffix}`;\n    };\n\n    if (parts.length === 0) {\n      // Fallback: show the highest available time unit when selected units have no remaining time\n      // This handles cases like: user selected only \"days\" but less than 24 hours remain\n      // We need to calculate from total since disabled units may not be populated\n      const totalMs = this.timeRemaining?.total || 0;\n      const fallback = parseMillisecondsToUnits(totalMs);\n\n      if (fallback.hours > 0) {\n        return applyPrefixSuffix(`${fallback.hours} ${fallback.hours === 1 ? t('time.hour_full') : t('time.hours_full')}`);\n      }\n      if (fallback.minutes > 0) {\n        return applyPrefixSuffix(`${fallback.minutes} ${fallback.minutes === 1 ? t('time.minute_full') : t('time.minutes_full')}`);\n      }\n      if (fallback.seconds > 0) {\n        return applyPrefixSuffix(`${fallback.seconds} ${fallback.seconds === 1 ? t('time.second_full') : t('time.seconds_full')}`);\n      }\n      // Only show \"0 seconds\" or \"starting\" if truly at zero\n      if (show_seconds) return applyPrefixSuffix(`0 ${t('time.seconds_full')}`);\n      return t('countdown.starting');\n    }\n\n    // If only one unit, always show full format\n    if (parts.length === 1) return applyPrefixSuffix(`${parts[0].value} ${parts[0].unit}`);\n\n    // For 2+ units, decide format:\n    // - If compact_format is explicitly true, use compact\n    // - If compact_format is explicitly false, use full\n    // - If compact_format is undefined (auto), use compact only if 3+ units\n    const useCompactFormat = compact_format === true || (compact_format !== false && parts.length >= 3);\n\n    if (useCompactFormat) {\n      const compact = parts.map(p => `${p.value}${p.unit.charAt(0)}`).join(' ');\n      return applyPrefixSuffix(compact);\n    }\n\n    // Full format for 2 units\n    return applyPrefixSuffix(parts.map(p => `${p.value} ${p.unit}`).join(' '));\n  }\n\n  /**\n   * Converts TimerData to CountdownState for unified interface\n   */\n  private _timerDataToCountdownState(timerData: any): CountdownState {\n    const units = parseSecondsToUnits(timerData.remaining);\n    return {\n      months: 0,\n      days: units.days,\n      hours: units.hours,\n      minutes: units.minutes,\n      seconds: units.seconds,\n      total: timerData.remaining * MS_PER_SECOND // ms for consistency\n    };\n  }\n\n  /**\n   * Gets current time remaining\n   * @returns {Object} - Time remaining object\n   */\n  getTimeRemaining(): CountdownState {\n    return this.timeRemaining;\n  }\n\n  /**\n   * Gets expired status\n   * @returns {boolean} - Whether countdown has expired\n   */\n  isExpired(): boolean {\n    return this.expired;\n  }\n\n  /**\n   * Gets available Alexa timers for debugging/info\n   * @param {Object} hass - Home Assistant object\n   * @returns {string[]} - Array of Alexa timer entity IDs\n   */\n  getAvailableAlexaTimers(hass: HomeAssistant | null): string[] {\n    if (!hass) return [];\n    return TimerEntityService.discoverAlexaTimers(hass);\n  }\n\n  /**\n   * Gets available Google Home timers for debugging/info\n   * @param {Object} hass - Home Assistant object\n   * @returns {string[]} - Array of Google Home timer entity IDs\n   */\n  getAvailableGoogleTimers(hass: HomeAssistant | null): string[] {\n    if (!hass) return [];\n    return TimerEntityService.discoverGoogleTimers(hass);\n  }\n\n  /**\n   * Get the current timer entity being used (for default actions)\n   */\n  getCurrentTimerEntity(config: any, hass: any): string | null {\n    // If explicit timer entity is configured, use it\n    if (config.timer_entity) {\n      return config.timer_entity;\n    }\n\n    // If auto-discovery is enabled, try to find the best smart assistant timer\n    if ((config.auto_discover_alexa || config.auto_discover_google) && hass) {\n      let smartTimers: string[] = [];\n\n      // Discover Alexa timers if enabled\n      if (config.auto_discover_alexa) {\n        const alexaTimers = TimerEntityService.discoverAlexaTimers(hass);\n        smartTimers.push(...alexaTimers);\n      }\n\n      // Discover Google Home timers if enabled\n      if (config.auto_discover_google) {\n        const googleTimers = TimerEntityService.discoverGoogleTimers(hass);\n        smartTimers.push(...googleTimers);\n      }\n\n      if (smartTimers.length > 0) {\n        // Find the first active timer, or return the first timer if none are active\n        for (const entityId of smartTimers) {\n          const timerData = TimerEntityService.getTimerData(entityId, hass);\n          if (timerData && timerData.isActive) {\n            return entityId;\n          }\n        }\n        // No active timers found, return the first one\n        return smartTimers[0];\n      }\n    }\n\n    return null;\n  }\n}","/**\n * StyleManager - Handles styling calculations and CSS processing\n * Provides dynamic sizing, proportional scaling, and style management\n */\nexport class StyleManager {\n  // Constants for icon and stroke size limits\n  static MIN_ICON_SIZE = 40;\n  static MAX_ICON_SIZE = 300;  // Increased from 120 to 300\n  static MIN_STROKE = 4;\n  static MAX_STROKE = 50;      // Increased from 20 to 50\n\n  private cache: {\n    dynamicIconSize: number | null;\n    dynamicStrokeWidth: number | null;\n    customStyles: any | null;\n    lastConfigHash: string | null;\n    lastIconConfigHash?: string | null;\n    lastStrokeConfigHash?: string | null;\n  };\n\n  constructor() {\n    this.cache = {\n      dynamicIconSize: null,\n      dynamicStrokeWidth: null,\n      customStyles: null,\n      lastConfigHash: null\n    };\n  }\n\n  /**\n   * Processes styles array into CSS string\n   * @param {Array} styles - Array of style objects or strings\n   * @returns {string} - CSS string\n   */\n  processStyles(styles: any[]): string {\n    if (!styles || !Array.isArray(styles)) return '';\n    \n    return styles.map(style => {\n      try {\n        if (typeof style === 'string') {\n          return style;\n        } else if (typeof style === 'object' && style !== null) {\n          return Object.entries(style)\n            .map(([prop, value]) => `${prop}: ${value}`)\n            .join('; ');\n        }\n        return '';\n      } catch (e) {\n        return '';\n      }\n    }).join('; ');\n  }\n\n  /**\n   * Builds styles object from configuration\n   * @param {Object} config - Card configuration\n   * @returns {Object} - Processed styles object\n   */\n  buildStylesObject(config: any): any {\n    // Use cached value if available and config hasn't changed\n    const configHash = JSON.stringify(config.styles || {});\n    if (this.cache.customStyles !== null && this.cache.lastConfigHash === configHash) {\n      return this.cache.customStyles;\n    }\n\n    const { styles = {} } = config;\n    \n    try {\n      const processedStyles = {\n        card: this.processStyles(styles.card),\n        title: this.processStyles(styles.title),\n        subtitle: this.processStyles(styles.subtitle),\n        progress_circle: this.processStyles(styles.progress_circle)\n      };\n\n      this.cache.customStyles = processedStyles;\n      this.cache.lastConfigHash = configHash;\n      return processedStyles;\n    } catch (e) {\n      this.cache.customStyles = {\n        card: '',\n        title: '',\n        subtitle: '',\n        progress_circle: ''\n      };\n      return this.cache.customStyles;\n    }\n  }\n\n  /**\n   * Internal helper to get card dimensions based on width, height, and aspect ratio\n   */\n  _getCardDimensions(width: any, height: any, aspect_ratio: any): any {\n    const defaultWidth = 300;\n    const defaultHeight = 150;\n    let cardWidth = defaultWidth;\n    let cardHeight = defaultHeight;\n    if (width && height) {\n      const parsedW = this.parseDimension(width);\n      const parsedH = this.parseDimension(height);\n      cardWidth = parsedW || defaultWidth;\n      cardHeight = parsedH || defaultHeight;\n    } else if (width && aspect_ratio) {\n      const parsedW = this.parseDimension(width);\n      cardWidth = parsedW || defaultWidth;\n      const [ratioW, ratioH] = aspect_ratio.split('/').map(parseFloat);\n      if (!isNaN(ratioW) && !isNaN(ratioH) && ratioW > 0) {\n        cardHeight = cardWidth * (ratioH / ratioW);\n      }\n    } else if (height && aspect_ratio) {\n      const parsedH = this.parseDimension(height);\n      cardHeight = parsedH || defaultHeight;\n      const [ratioW, ratioH] = aspect_ratio.split('/').map(parseFloat);\n      if (!isNaN(ratioW) && !isNaN(ratioH) && ratioH > 0) {\n        cardWidth = cardHeight * (ratioW / ratioH);\n      }\n    } else if (aspect_ratio) {\n      const [ratioW, ratioH] = aspect_ratio.split('/').map(parseFloat);\n      if (!isNaN(ratioW) && !isNaN(ratioH) && ratioW > 0) {\n        cardHeight = defaultWidth * (ratioH / ratioW);\n      }\n      cardWidth = defaultWidth;\n    }\n    if (!cardWidth || isNaN(cardWidth) || cardWidth <= 0) cardWidth = defaultWidth;\n    if (!cardHeight || isNaN(cardHeight) || cardHeight <= 0) cardHeight = defaultHeight;\n    return { cardWidth, cardHeight };\n  }\n\n  /**\n   * Calculate dynamic icon size based on card dimensions - now truly proportional\n   * @param {*} width - Card width\n   * @param {*} height - Card height\n   * @param {string} aspect_ratio - Aspect ratio string\n   * @param {*} icon_size - Explicit icon size\n   * @returns {number} - Calculated icon size in pixels\n   */\n  calculateDynamicIconSize(width: any, height: any, aspect_ratio: any, icon_size: any): number {\n    // Use cached value if available and config hasn't changed\n    const configKey = JSON.stringify({ width, height, aspect_ratio, icon_size });\n    if (this.cache.dynamicIconSize !== null && this.cache.lastIconConfigHash === configKey) {\n      return this.cache.dynamicIconSize;\n    }\n\n    try {\n      const { cardWidth, cardHeight } = this._getCardDimensions(width, height, aspect_ratio);\n      const minDimension = Math.min(cardWidth, cardHeight);\n      const proportionalSize = minDimension * 0.4;\n      let size = proportionalSize;\n\n      // Respect explicit icon_size if provided, otherwise use proportional\n      if (icon_size && icon_size !== '100px') {\n        const baseSize = typeof icon_size === 'string' ?\n          parseInt(icon_size.replace('px', '')) :\n          (typeof icon_size === 'number' ? icon_size : proportionalSize);\n        // If explicit size is provided, use it directly (within max limit)\n        size = (!isNaN(baseSize)) ? baseSize : proportionalSize;\n      }\n\n      this.cache.dynamicIconSize = Math.max(StyleManager.MIN_ICON_SIZE, Math.min(size, StyleManager.MAX_ICON_SIZE));\n      this.cache.lastIconConfigHash = configKey;\n      return this.cache.dynamicIconSize;\n    } catch (error) {\n      this.cache.dynamicIconSize = StyleManager.MIN_ICON_SIZE; // Safe fallback\n      return this.cache.dynamicIconSize;\n    }\n  }\n\n  /**\n   * Calculate dynamic stroke width based on icon size\n   * @param {number} iconSize - Icon size in pixels\n   * @param {*} stroke_width - Explicit stroke width\n   * @returns {number} - Calculated stroke width\n   */\n  calculateDynamicStrokeWidth(iconSize: any, stroke_width: any): number {\n    // Use cached value if available and config hasn't changed\n    const configKey = JSON.stringify({ iconSize, stroke_width });\n    if (this.cache.dynamicStrokeWidth !== null && this.cache.lastStrokeConfigHash === configKey) {\n      return this.cache.dynamicStrokeWidth;\n    }\n\n    try {\n      // If explicit stroke_width is provided, use it directly\n      if (stroke_width && typeof stroke_width === 'number') {\n        this.cache.dynamicStrokeWidth = Math.max(StyleManager.MIN_STROKE, Math.min(stroke_width, StyleManager.MAX_STROKE));\n      } else {\n        // Otherwise calculate proportional stroke based on icon size\n        const ratio = 0.15;\n        const calculated = Math.round(iconSize * ratio);\n        this.cache.dynamicStrokeWidth = Math.max(StyleManager.MIN_STROKE, Math.min(calculated, StyleManager.MAX_STROKE));\n      }\n      \n      this.cache.lastStrokeConfigHash = configKey;\n      return this.cache.dynamicStrokeWidth;\n    } catch (error) {\n      this.cache.dynamicStrokeWidth = StyleManager.MIN_STROKE; // Safe fallback\n      return this.cache.dynamicStrokeWidth;\n    }\n  }\n\n  /**\n   * Calculate proportional font sizes based on card dimensions\n   * @param {*} width - Card width\n   * @param {*} height - Card height\n   * @param {string} aspect_ratio - Aspect ratio string\n   * @returns {Object} - Object with font sizes and dimensions\n   */\n  calculateProportionalSizes(width: any, height: any, aspect_ratio: any): any {\n    try {\n      const { cardWidth, cardHeight } = this._getCardDimensions(width, height, aspect_ratio);\n      const defaultArea = 300 * 150;\n      const scaleFactor = Math.sqrt((cardWidth * cardHeight) / defaultArea);\n\n      return {\n        titleSize: Math.max(1.2, Math.min(2.2, 1.6 * scaleFactor)),\n        subtitleSize: Math.max(0.9, Math.min(1.4, 1.1 * scaleFactor)),\n        cardWidth,\n        cardHeight\n      };\n    } catch (error) {\n      return { titleSize: 1.6, subtitleSize: 1.1, cardWidth: 300, cardHeight: 150 };\n    }\n  }\n\n  /**\n   * Helper to parse dimension strings (e.g., \"200px\", \"100%\") to numbers\n   * @param {*} dimension - Dimension value to parse\n   * @returns {number|null} - Parsed dimension in pixels\n   */\n  parseDimension(dimension: any): number | null {\n    try {\n      if (typeof dimension === 'number') return dimension;\n      if (typeof dimension !== 'string') return null;\n      // Normalize string for case-insensitive matching\n      const dimStr = dimension.toLowerCase();\n      // Handle percentage values - assume 300px base for calculations\n      if (dimStr.includes('%')) {\n        const percent = parseFloat(dimStr.replace('%', ''));\n        return isNaN(percent) ? null : (percent / 100) * 300; // 300px as base\n      }\n      // Handle pixel values\n      if (dimStr.includes('px')) {\n        const pixels = parseFloat(dimStr.replace('px', ''));\n        return isNaN(pixels) ? null : pixels;\n      }\n      // Try to parse as number\n      const parsed = parseFloat(dimStr);\n      return isNaN(parsed) ? null : parsed;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  /**\n   * Generates card dimensions CSS based on configuration\n   * @param {*} width - Card width\n   * @param {*} height - Card height\n   * @param {string} aspect_ratio - Aspect ratio string\n   * @returns {Array} - Array of CSS style strings\n   */\n  generateCardDimensionStyles(width: any, height: any, aspect_ratio: any): string[] {\n    const cardStyles = [];\n    \n    // Apply width if specified\n    if (width) {\n      const formattedWidth = this._formatDimensionValue(width);\n      if (formattedWidth) {\n        cardStyles.push(`width: ${formattedWidth}`);\n      }\n    }\n    \n    // Apply height if specified\n    if (height) {\n      const formattedHeight = this._formatDimensionValue(height);\n      if (formattedHeight) {\n        cardStyles.push(`height: ${formattedHeight}`);\n      }\n    } else if (aspect_ratio && !height) {\n      // Use aspect-ratio if height not specified\n      cardStyles.push(`aspect-ratio: ${aspect_ratio}`);\n    }\n    \n    // Add a minimum height if no height or aspect ratio is specified\n    if (!height && !aspect_ratio) {\n      cardStyles.push('min-height: 120px');\n    }\n\n    return cardStyles;\n  }\n\n  /**\n   * Helper method to format dimension values with proper units\n   * @param {*} value - The dimension value (string or number)\n   * @returns {string|null} - Formatted CSS value or null if invalid\n   */\n  private _formatDimensionValue(value: any): string | null {\n    if (!value) return null;\n    \n    const strValue = String(value).trim();\n    \n    // If it already has units (px, %, em, rem, vh, vw, etc.), use as-is\n    if (/^[\\d.]+\\s*(px|%|em|rem|vh|vw|vmin|vmax|ch|ex)$/i.test(strValue)) {\n      return strValue;\n    }\n    \n    // If it's a pure number, add 'px' unit\n    const numValue = parseFloat(strValue);\n    if (!isNaN(numValue)) {\n      return `${numValue}px`;\n    }\n    \n    // Invalid value\n    return null;\n  }\n\n  /**\n   * Clears style cache\n   */\n  clearCache() {\n    this.cache = {\n      dynamicIconSize: null,\n      dynamicStrokeWidth: null,\n      customStyles: null,\n      lastConfigHash: null\n    };\n  }\n\n  /**\n   * Public method to get card dimensions based on configuration\n   * @param {*} width - Card width\n   * @param {*} height - Card height\n   * @param {string} aspect_ratio - Aspect ratio string\n   * @returns {Object} - Object with cardWidth and cardHeight\n   */\n  getCardDimensions(width: any, height: any, aspect_ratio: any): { cardWidth: number; cardHeight: number } {\n    return this._getCardDimensions(width, height, aspect_ratio);\n  }\n}\n","import { HomeAssistant } from '../types/index';\n\ntype LanguageRecord = Record<string, any>;\n\nconst DEFAULT_LANG = 'en';\n\n// Inline translations for all languages\nconst languages: Record<string, LanguageRecord> = {\n  en: {\n    timer: {\n      complete: 'Timer complete',\n      complete_with_label: '{label} timer complete',\n      paused: 'Paused',\n      paused_with_time: '{label} timer paused - {time} left',\n      paused_without_label: 'Timer paused - {time} left',\n      paused_alexa: 'Timer paused on {device} - {time} left',\n      ready: 'Ready',\n      ready_with_time: 'Ready - {time}',\n      no_timers: 'No timers',\n      no_timers_device: 'No timers on {device}',\n      no_timers_google: 'No Google Home timers',\n      remaining: '{time} remaining',\n      remaining_with_label: '{time} remaining on {label} timer',\n      remaining_with_device: '{time} remaining on {device}',\n      paused_time_left: 'Timer paused - {time} left',\n      google_paused: 'Google Home timer paused - {time} left',\n      timer_ready: 'Timer ready',\n    },\n    countdown: {\n      starting: 'Starting...',\n      completed: 'Completed!'\n    },\n    time: {\n      hour_compact: 'h',\n      day_compact: 'd',\n      month_compact: 'mo',\n      minute_compact: 'm',\n      second_compact: 's',\n      hour_full: 'hour',\n      hours_full: 'hours',\n      day_full: 'day',\n      days_full: 'days',\n      month_full: 'month',\n      months_full: 'months',\n      minute_full: 'minute',\n      minutes_full: 'minutes',\n      second_full: 'second',\n      seconds_full: 'seconds',\n      // Eventy style (uppercase abbreviated)\n      month_eventy: 'MONTH',\n      months_eventy: 'MONTHS',\n      day_eventy: 'DAY',\n      days_eventy: 'DAYS',\n      hour_eventy: 'HOUR',\n      hours_eventy: 'HOURS',\n      minute_eventy: 'MIN',\n      minutes_eventy: 'MINS',\n      second_eventy: 'SEC',\n      seconds_eventy: 'SECS',\n    },\n  },\n  fr: {\n    timer: {\n      complete: 'Minuteur termin',\n      complete_with_label: 'Minuteur {label} termin',\n      paused: 'En pause',\n      paused_with_time: 'Minuteur {label} en pause - {time} restant',\n      paused_without_label: 'Minuteur en pause - {time} restant',\n      paused_alexa: 'Minuteur en pause sur {device} - {time} restant',\n      ready: 'Prt',\n      ready_with_time: 'Prt - {time}',\n      no_timers: 'Aucun minuteur',\n      no_timers_device: 'Aucun minuteur sur {device}',\n      no_timers_google: 'Aucun minuteur Google Home',\n      remaining: '{time} restant',\n      remaining_with_label: '{time} restant sur le minuteur {label}',\n      remaining_with_device: '{time} restant sur {device}',\n      paused_time_left: 'Minuteur en pause - {time} restant',\n      google_paused: 'Minuteur Google Home en pause - {time} restant',\n      timer_ready: 'Minuteur prt',\n    },\n    countdown: {\n      starting: 'Dmarrage...',\n      completed: 'Termin!'\n    },\n    time: {\n      hour_compact: 'h',\n      day_compact: 'j',\n      month_compact: 'mo',\n      minute_compact: 'min',\n      second_compact: 's',\n      hour_full: 'heure',\n      hours_full: 'heures',\n      day_full: 'jour',\n      days_full: 'jours',\n      month_full: 'mois',\n      months_full: 'mois',\n      minute_full: 'minute',\n      minutes_full: 'minutes',\n      second_full: 'seconde',\n      seconds_full: 'secondes',\n      // Eventy style (uppercase abbreviated)\n      month_eventy: 'MOIS',\n      months_eventy: 'MOIS',\n      day_eventy: 'JOUR',\n      days_eventy: 'JOURS',\n      hour_eventy: 'HEURE',\n      hours_eventy: 'HEURES',\n      minute_eventy: 'MIN',\n      minutes_eventy: 'MINS',\n      second_eventy: 'SEC',\n      seconds_eventy: 'SECS',\n    },\n  },\n  de: {\n    timer: {\n      complete: 'Timer abgelaufen',\n      complete_with_label: 'Timer {label} abgelaufen',\n      paused: 'Pausiert',\n      paused_with_time: 'Timer {label} pausiert - {time} verbleibend',\n      paused_without_label: 'Timer pausiert - {time} verbleibend',\n      paused_alexa: 'Timer pausiert auf {device} - {time} verbleibend',\n      ready: 'Bereit',\n      ready_with_time: 'Bereit - {time}',\n      no_timers: 'Keine Timer',\n      no_timers_device: 'Keine Timer auf {device}',\n      no_timers_google: 'Keine Google Home Timer',\n      remaining: '{time} verbleibend',\n      remaining_with_label: '{time} verbleibend bei Timer {label}',\n      remaining_with_device: '{time} verbleibend auf {device}',\n      paused_time_left: 'Timer pausiert - {time} verbleibend',\n      google_paused: 'Google Home Timer pausiert - {time} verbleibend',\n      timer_ready: 'Timer bereit',\n    },\n    countdown: {\n      starting: 'Startet...',\n      completed: 'Abgeschlossen!'\n    },\n    time: {\n      hour_compact: 'Std',\n      day_compact: 'T',\n      month_compact: 'Mon',\n      minute_compact: 'Min',\n      second_compact: 's',\n      hour_full: 'Stunde',\n      hours_full: 'Stunden',\n      day_full: 'Tag',\n      days_full: 'Tage',\n      month_full: 'Monat',\n      months_full: 'Monate',\n      minute_full: 'Minute',\n      minutes_full: 'Minuten',\n      second_full: 'Sekunde',\n      seconds_full: 'Sekunden',\n      // Eventy style (uppercase abbreviated)\n      month_eventy: 'MONAT',\n      months_eventy: 'MONATE',\n      day_eventy: 'TAG',\n      days_eventy: 'TAGE',\n      hour_eventy: 'STD',\n      hours_eventy: 'STD',\n      minute_eventy: 'MIN',\n      minutes_eventy: 'MIN',\n      second_eventy: 'SEK',\n      seconds_eventy: 'SEK',\n    },\n  },\n  es: {\n    timer: {\n      complete: 'Temporizador finalizado',\n      complete_with_label: 'Temporizador {label} finalizado',\n      paused: 'Pausado',\n      paused_with_time: 'Temporizador {label} pausado - {time} restante',\n      paused_without_label: 'Temporizador pausado - {time} restante',\n      paused_alexa: 'Temporizador pausado en {device} - {time} restante',\n      ready: 'Listo',\n      ready_with_time: 'Listo - {time}',\n      no_timers: 'Sin temporizadores',\n      no_timers_device: 'Sin temporizadores en {device}',\n      no_timers_google: 'Sin temporizadores de Google Home',\n      remaining: '{time} restante',\n      remaining_with_label: '{time} restante en temporizador {label}',\n      remaining_with_device: '{time} restante en {device}',\n      paused_time_left: 'Temporizador pausado - {time} restante',\n      google_paused: 'Temporizador de Google Home pausado - {time} restante',\n      timer_ready: 'Temporizador listo',\n    },\n    countdown: {\n      starting: 'Iniciando...',\n      completed: 'Completado!'\n    },\n    time: {\n      hour_compact: 'h',\n      day_compact: 'd',\n      month_compact: 'mes',\n      minute_compact: 'min',\n      second_compact: 's',\n      hour_full: 'hora',\n      hours_full: 'horas',\n      day_full: 'da',\n      days_full: 'das',\n      month_full: 'mes',\n      months_full: 'meses',\n      minute_full: 'minuto',\n      minutes_full: 'minutos',\n      second_full: 'segundo',\n      seconds_full: 'segundos',\n      // Eventy style (uppercase abbreviated)\n      month_eventy: 'MES',\n      months_eventy: 'MESES',\n      day_eventy: 'DA',\n      days_eventy: 'DAS',\n      hour_eventy: 'HORA',\n      hours_eventy: 'HORAS',\n      minute_eventy: 'MIN',\n      minutes_eventy: 'MINS',\n      second_eventy: 'SEG',\n      seconds_eventy: 'SEGS',\n    },\n  },\n  it: {\n    timer: {\n      complete: 'Timer completato',\n      complete_with_label: 'Timer {label} completato',\n      paused: 'In pausa',\n      paused_with_time: 'Timer {label} in pausa - {time} rimanente',\n      paused_without_label: 'Timer in pausa - {time} rimanente',\n      paused_alexa: 'Timer in pausa su {device} - {time} rimanente',\n      ready: 'Pronto',\n      ready_with_time: 'Pronto - {time}',\n      no_timers: 'Nessun timer',\n      no_timers_device: 'Nessun timer su {device}',\n      no_timers_google: 'Nessun timer Google Home',\n      remaining: '{time} rimanente',\n      remaining_with_label: '{time} rimanente sul timer {label}',\n      remaining_with_device: '{time} rimanente su {device}',\n      paused_time_left: 'Timer in pausa - {time} rimanente',\n      google_paused: 'Timer Google Home in pausa - {time} rimanente',\n      timer_ready: 'Timer pronto',\n    },\n    countdown: {\n      starting: 'Avvio...',\n      completed: 'Completato!'\n    },\n    time: {\n      hour_compact: 'h',\n      day_compact: 'g',\n      month_compact: 'mo',\n      minute_compact: 'min',\n      second_compact: 's',\n      hour_full: 'ora',\n      hours_full: 'ore',\n      day_full: 'giorno',\n      days_full: 'giorni',\n      month_full: 'mese',\n      months_full: 'mesi',\n      minute_full: 'minuto',\n      minutes_full: 'minuti',\n      second_full: 'secondo',\n      seconds_full: 'secondi',\n      // Eventy style (uppercase abbreviated)\n      month_eventy: 'MESE',\n      months_eventy: 'MESI',\n      day_eventy: 'GIORNO',\n      days_eventy: 'GIORNI',\n      hour_eventy: 'ORA',\n      hours_eventy: 'ORE',\n      minute_eventy: 'MIN',\n      minutes_eventy: 'MIN',\n      second_eventy: 'SEC',\n      seconds_eventy: 'SEC',\n    },\n  },\n  nl: {\n    timer: {\n      complete: 'Timer klaar',\n      complete_with_label: 'Timer {label} klaar',\n      paused: 'Gepauzeerd',\n      paused_with_time: 'Timer {label} gepauzeerd - {time} resterend',\n      paused_without_label: 'Timer gepauzeerd - {time} resterend',\n      paused_alexa: 'Timer gepauzeerd op {device} - {time} resterend',\n      ready: 'Klaar',\n      ready_with_time: 'Klaar - {time}',\n      no_timers: 'Geen timers',\n      no_timers_device: 'Geen timers op {device}',\n      no_timers_google: 'Geen Google Home timers',\n      remaining: '{time} resterend',\n      remaining_with_label: '{time} resterend op timer {label}',\n      remaining_with_device: '{time} resterend op {device}',\n      paused_time_left: 'Timer gepauzeerd - {time} resterend',\n      google_paused: 'Google Home timer gepauzeerd - {time} resterend',\n      timer_ready: 'Timer klaar',\n    },\n    countdown: {\n      starting: 'Starten...',\n      completed: 'Voltooid!'\n    },\n    time: {\n      hour_compact: 'u',\n      day_compact: 'd',\n      month_compact: 'mnd',\n      minute_compact: 'min',\n      second_compact: 's',\n      hour_full: 'uur',\n      hours_full: 'uren',\n      day_full: 'dag',\n      days_full: 'dagen',\n      month_full: 'maand',\n      months_full: 'maanden',\n      minute_full: 'minuut',\n      minutes_full: 'minuten',\n      second_full: 'seconde',\n      seconds_full: 'seconden',\n      // Eventy style (uppercase abbreviated)\n      month_eventy: 'MAAND',\n      months_eventy: 'MAANDEN',\n      day_eventy: 'DAG',\n      days_eventy: 'DAGEN',\n      hour_eventy: 'UUR',\n      hours_eventy: 'UREN',\n      minute_eventy: 'MIN',\n      minutes_eventy: 'MIN',\n      second_eventy: 'SEC',\n      seconds_eventy: 'SEC',\n    },\n  },\n};\n\n/**\n * Get a translated string from the translation files\n * @param key - Dot-separated key (e.g., 'timer.complete')\n * @param lang - Language code (e.g., 'en', 'fr')\n * @returns Translated string or undefined if not found\n */\nfunction getTranslatedString(key: string, lang: string): string | undefined {\n  try {\n    const keys = key.split('.');\n    let obj: any = languages[lang];\n    \n    if (!obj) return undefined;\n    \n    for (const k of keys) {\n      obj = obj[k];\n      if (obj === undefined) return undefined;\n    }\n    \n    return typeof obj === 'string' ? obj : undefined;\n  } catch (_) {\n    return undefined;\n  }\n}\n\n/**\n * Format a translated string with placeholders\n * Replaces {key} style placeholders with values from the arguments object\n * @param text - Translated text with {placeholder} style placeholders\n * @param args - Object with placeholder values\n * @returns Formatted string\n */\nfunction formatString(text: string, args: Record<string, any> = {}): string {\n  if (!text) return '';\n  \n  return text.replace(/\\{([^}]+)\\}/g, (_, key) => {\n    return String(args[key] ?? `{${key}}`);\n  });\n}\n\n/**\n * Setup localization function for the card\n * Returns a function that translates keys based on Home Assistant's language setting\n * @param hass - Home Assistant object\n * @returns Localize function\n */\nexport function setupLocalize(hass?: HomeAssistant) {\n  return function localize(\n    key: string,\n    argObject: Record<string, any> = {}\n  ): string {\n    const lang = hass?.locale?.language ?? DEFAULT_LANG;\n\n    // Try to get translation in the user's language\n    let translated = getTranslatedString(key, lang);\n    \n    // Fall back to English if translation not found\n    if (!translated) {\n      translated = getTranslatedString(key, DEFAULT_LANG);\n    }\n\n    // If still not found, return the key itself\n    if (!translated) {\n      return key;\n    }\n\n    // Format the string with placeholders\n    return formatString(translated, argObject);\n  };\n}\n\nexport type LocalizeFunction = ReturnType<typeof setupLocalize>;\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},e=t=>(...e)=>({_$litDirective$:t,values:e});class i{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}export{i as Directive,t as PartType,e as directive};\n//# sourceMappingURL=directive.js.map\n","/**\n * Action Handling Code for Home Assistant\n */\n\nimport { HomeAssistant, ActionConfig } from '../types/index';\n\n/**\n * Fire a custom event on an element\n */\nexport function fireEvent(\n  node: HTMLElement,\n  type: string,\n  detail?: any,\n  options?: { bubbles?: boolean; cancelable?: boolean; composed?: boolean }\n): void {\n  const event = new CustomEvent(type, {\n    bubbles: options?.bubbles ?? true,\n    cancelable: options?.cancelable ?? true,\n    composed: options?.composed ?? true,\n    detail,\n  });\n  node.dispatchEvent(event);\n}\n\n/**\n * Handle action execution for Home Assistant cards\n */\nexport const handleAction = (\n  node: HTMLElement,\n  _hass: HomeAssistant,\n  config: {\n    entity?: string;\n    camera_image?: string;\n    hold_action?: ActionConfig;\n    tap_action?: ActionConfig;\n    double_tap_action?: ActionConfig;\n  },\n  action: string\n): void => {\n  fireEvent(node, \"hass-action\", { config, action });\n};\n","/**\n * Consolidated action handler for Home Assistant\n * Combines directive and helper functions\n */\n\nimport { noChange } from \"lit\";\nimport { AttributePart, directive, Directive, DirectiveParameters } from \"lit/directive.js\";\nimport { ActionHandlerEvent, HomeAssistant, CardConfig } from '../types/index';\nimport { handleAction } from './handle-action';\n\ninterface ActionHandler extends HTMLElement {\n  holdTime: number;\n  bind(element: Element, options?: ActionHandlerOptions): void;\n}\n\ninterface ActionHandlerElement extends HTMLElement {\n  actionHandler?: {\n    options: ActionHandlerOptions;\n    start?: (ev: Event) => void;\n    end?: (ev: Event) => void;\n    handleEnter?: (ev: KeyboardEvent) => void;\n  };\n}\n\ntype ActionHandlerOptions = {\n  hasHold?: boolean;\n  hasDoubleClick?: boolean;\n};\n\nconst getActionHandler = (): ActionHandler | null => {\n  const body = document.body;\n  if (body.querySelector(\"action-handler\")) {\n    return body.querySelector(\"action-handler\") as ActionHandler;\n  }\n\n  const actionhandler = document.createElement(\"action-handler\");\n  body.appendChild(actionhandler);\n\n  return actionhandler as ActionHandler;\n};\n\nexport const actionHandlerBind = (\n  element: ActionHandlerElement,\n  options?: ActionHandlerOptions\n) => {\n  const actionhandler: ActionHandler | null = getActionHandler();\n  if (!actionhandler) {\n    return;\n  }\n  actionhandler.bind(element, options);\n};\n\nexport const actionHandler = directive(\n  class extends Directive {\n    update(part: AttributePart, [options]: DirectiveParameters<this>) {\n      actionHandlerBind(part.element as ActionHandlerElement, options);\n      return noChange;\n    }\n\n    render(_options?: ActionHandlerOptions) {\n      return noChange;\n    }\n  }\n);\n\n/**\n * Check if an action is configured\n */\nexport function hasAction(config?: any): boolean {\n  return config !== undefined && config.action !== 'none';\n}\n\n/**\n * Create action handler with proper options\n */\nexport function createActionHandler(config: CardConfig) {\n  return actionHandler({\n    hasHold: hasAction(config.hold_action),\n    hasDoubleClick: hasAction(config.double_tap_action),\n  });\n}\n\n/**\n * Create handle action function for events\n */\nexport function createHandleAction(hass: HomeAssistant, config: CardConfig) {\n  return (ev: ActionHandlerEvent) => {\n    handleAction(ev.target as any, hass, config, ev.detail.action);\n  };\n}\n","import { LitElement, html, css, TemplateResult, CSSResult } from 'lit';\nimport { property } from 'lit/decorators.js';\n\nexport interface ValidationError {\n  field: string;\n  message: string;\n  severity: 'critical' | 'warning' | 'info';\n  suggestion?: string;\n  value?: any;\n}\n\nexport class ErrorDisplay extends LitElement {\n  @property({ type: Array }) errors: ValidationError[] = [];\n  @property({ type: String }) title: string = 'Configuration Issues';\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        display: block;\n        font-family: var(--font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif);\n      }\n\n      .error-container {\n        background: #332022;\n        border: 1px solid #582533ff;\n        border-radius: 1px;\n        padding: 16px;\n        margin: 8px;\n        color: #ffffff;\n      }\n\n      .error-list {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n      }\n\n      .error-item {\n        margin-bottom: 8px;\n        line-height: 1.4;\n      }\n\n      .error-field {\n        font-weight: 600;\n        color: #D74133;\n      }\n    `;\n  }\n\n  render(): TemplateResult {\n    if (!this.errors || this.errors.length === 0) {\n      return html``;\n    }\n\n    // Filter out info messages, only show critical and warning\n    const relevantErrors = this.errors.filter(e => e.severity === 'critical' || e.severity === 'warning');\n\n    if (relevantErrors.length === 0) {\n      return html``;\n    }\n\n    return html`\n      <div class=\"error-container\">\n        <ul class=\"error-list\">\n          ${relevantErrors.map(error => html`\n            <li class=\"error-item\">\n              <span class=\"error-field\">${error.field}:</span> ${error.message}\n            </li>\n          `)}\n        </ul>\n      </div>\n    `;\n  }\n}\n","//TimeFlowCard.ts\nimport { LitElement, html, css, TemplateResult, CSSResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { TimerEntityService } from '../services/Timer';\nimport { DateParser } from '../utils/DateParser';\nimport { ConfigValidator, ValidationResult, ValidationError } from '../utils/ConfigValidator';\nimport { TemplateService } from '../services/TemplateService';\nimport { CountdownService } from '../services/CountdownService';\nimport { StyleManager } from '../utils/StyleManager';\nimport { setupLocalize, LocalizeFunction } from '../utils/localize';\nimport { HomeAssistant, CountdownState, CardConfig, ActionHandlerEvent } from '../types/index';\nimport { createActionHandler, createHandleAction } from '../utils/action-handler';\nimport { parseMillisecondsToUnits, getUnitLabel, getLocalizedEventyLabel } from '../utils/TimeUtils';\nimport '../utils/ErrorDisplay';\n\nexport class TimeFlowCard extends LitElement {\n  public static async getConfigElement(): Promise<HTMLElement> {\n    return document.createElement('timeflow-card-editor');\n  }\n\n  // Reactive properties to trigger updates\n  @property({ type: Object }) hass: HomeAssistant | null = null;\n  @property({ type: Object }) config: CardConfig = TimeFlowCard.getStubConfig();\n\n  // Internal reactive state for resolved config props and countdown state\n  @state() private _resolvedConfig: CardConfig = TimeFlowCard.getStubConfig();\n  @state() private _progress: number = 0;\n  @state() private _countdown: CountdownState = {\n    months: 0,\n    days: 0,\n    hours: 0,\n    minutes: 0,\n    seconds: 0,\n    total: 0\n  };\n  @state() private _expired: boolean = false;\n  @state() private _validationResult: ValidationResult | null = null;\n  @state() private _initialized: boolean = false; // Track initialization\n  @state() private _localize: LocalizeFunction | null = null; // Localization function\n\n  // Timer ID\n  private _timerId: ReturnType<typeof setInterval> | null = null;\n\n  // Services instances (could be injected if needed)\n  private templateService = new TemplateService();\n  private countdownService = new CountdownService(this.templateService, DateParser);\n  private styleManager = new StyleManager();\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        display: block;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n        color: var(--primary-text-color, #222);\n        --progress-color: var(--progress-color, #4caf50);\n      }\n      \n      /* FIXED: Set initial background immediately to prevent white flash */\n      ha-card {\n        display: flex;\n        flex-direction: column;\n        padding: 0;\n        /* Use HA theme border-radius: defaults to 12px, respects user theme */\n        border-radius: var(--ha-card-border-radius, var(--ha-border-radius-lg, 12px));\n        position: relative;\n        overflow: hidden;\n        /* Use HA theme background: respects user theme changes */\n        background: var(--ha-card-background, var(--card-background-color, var(--secondary-background-color, transparent)));\n        /* Use HA theme box-shadow: respects user theme */\n        box-shadow: var(--ha-card-box-shadow, 0 2px 10px rgba(0, 0, 0, 0.1));\n        /* Use HA theme border: respects user theme */\n        border-width: var(--ha-card-border-width, 1px);\n        border-style: solid;\n        border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));\n        /* REMOVED: transition that causes flash - only animate specific properties if needed */\n        /* transition: background-color 0.3s ease; */\n        /* min-height removed - let content determine height, especially for eventy style */\n        user-select: none; /* Prevent text selection during interactions */\n      }\n      \n      /* Classic style needs minimum height, but compact styles should auto-size */\n      ha-card:not(:has(.card-content-list)):not(:has(.card-content-compact)) {\n        min-height: 120px;\n      }\n      \n      /* Make card interactive when actions are configured */\n      ha-card[actionHandler] {\n        cursor: pointer;\n      }\n      \n      ha-card[actionHandler]:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);\n        transition: transform 0.2s ease, box-shadow 0.2s ease;\n      }\n      \n      ha-card[actionHandler]:active {\n        transform: translateY(0);\n        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n      }\n      \n      /* Error message styling */\n      .error {\n        color: #721c24;\n        padding: 12px;\n        border-radius: 16px;\n        white-space: pre-wrap;\n        word-break: break-word;\n      }\n      \n      /* FIXED: Only show card after initialization to prevent white flash */\n      ha-card:not(.initialized) {\n        opacity: 0;\n      }\n      \n      ha-card.initialized {\n        opacity: 1;\n        transition: opacity 0.2s ease-in;\n      }\n      \n      ha-card.expired {\n        animation: celebration 0.8s ease-in-out;\n      }\n      \n      .card-content {\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n        padding: 20px;\n        height: 100%;\n        /* FIXED: Ensure content has proper background inheritance */\n        background: inherit;\n      }\n      \n      .header {\n        display: flex;\n        justify-content: space-between;\n        align-items: flex-start;\n        margin-bottom: 0;\n      }\n      \n      .header-icon {\n        flex-shrink: 0;\n        margin-right: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        /* Size matches title + subtitle height */\n        width: var(--header-icon-container-size, 44px);\n        height: var(--header-icon-container-size, 44px);\n      }\n      \n      .header-icon ha-icon {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        --mdc-icon-size: var(--header-icon-size, 24px);\n      }\n      \n      .title-section {\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n      }\n      \n      .title {\n        font-size: var(--timeflow-title-size, 1.5rem);\n        font-weight: 500;\n        margin: 0;\n        opacity: 0.9;\n        line-height: 1.3;\n        letter-spacing: -0.01em;\n        color: var(--timeflow-card-text-color, inherit);\n      }\n      \n      .subtitle {\n        font-size: var(--timeflow-subtitle-size, 1rem);\n        opacity: 0.65;\n        margin: 0;\n        font-weight: 400;\n        line-height: 1.2;\n        color: var(--timeflow-card-text-color, inherit);\n      }\n      \n      .progress-section {\n        flex-shrink: 0;\n        margin-left: auto;\n      }\n      \n      .content {\n        display: flex;\n        align-items: flex-end;\n        justify-content: flex-end;\n        margin-top: auto;\n        padding-top: 12px;\n      }\n      \n      .progress-circle {\n        opacity: 0.9;\n      }\n      \n      /* \n         LIST LAYOUT STYLES - Compact horizontal view\n          */\n      \n      .card-content-list {\n        display: grid;\n        grid-template-areas: \"icon title countdown\";\n        grid-template-columns: auto 1fr auto;\n        align-items: center;\n        gap: 12px;\n        padding: 12px 20px;\n        min-height: 50px;\n      }\n      \n      .list-icon {\n        grid-area: icon;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: var(--list-icon-size, 44px);\n        height: var(--list-icon-size, 44px);\n        border-radius: var(--ha-card-border-radius, 12px);\n        flex-shrink: 0;\n      }\n      \n      .list-icon ha-icon {\n        --mdc-icon-size: calc(var(--list-icon-size, 44px) * 0.55);\n      }\n      \n      .list-title-section {\n        grid-area: title;\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n        min-width: 0; /* Allow text truncation */\n      }\n      \n      .list-title {\n        font-weight: 600;\n        font-size: var(--list-title-size, 16px);\n        line-height: 1.2;\n        color: var(--timeflow-card-text-color, var(--primary-text-color));\n        margin: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      \n      .list-subtitle {\n        font-size: var(--list-subtitle-size, 13px);\n        font-weight: 400;\n        line-height: 1.2;\n        color: var(--timeflow-card-text-color, var(--primary-text-color));\n        margin: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      \n      .list-countdown {\n        grid-area: countdown;\n        display: flex;\n        flex-direction: column;\n        align-items: flex-end;\n        line-height: 1;\n        flex-shrink: 0;\n      }\n      \n      .list-countdown-value {\n        font-size: var(--list-countdown-size, 26px);\n        font-weight: 700;\n        color: var(--timeflow-card-text-color, var(--primary-text-color));\n      }\n      \n      .list-countdown-unit {\n        font-size: 10px;\n        font-weight: 700;\n        opacity: 0.6;\n        margin-top: 2px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      \n      /* \n         CLASSIC COMPACT LAYOUT STYLES - Horizontal view with progress circle\n          */\n      \n      .card-content-compact {\n        display: grid;\n        grid-template-areas: \"icon title progress\";\n        grid-template-columns: auto 1fr auto;\n        align-items: center;\n        gap: 12px;\n        padding: 12px 16px;\n        min-height: 50px;\n      }\n      \n      .compact-icon {\n        grid-area: icon;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: var(--compact-icon-size, 44px);\n        height: var(--compact-icon-size, 44px);\n        border-radius: var(--ha-card-border-radius, 12px);\n        flex-shrink: 0;\n      }\n      \n      .compact-icon ha-icon {\n        --mdc-icon-size: calc(var(--compact-icon-size, 44px) * 0.55);\n      }\n      \n      .compact-title-section {\n        grid-area: title;\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n        min-width: 0; /* Allow text truncation */\n      }\n      \n      .compact-title {\n        font-weight: 600;\n        font-size: var(--compact-title-size, 16px);\n        line-height: 1.2;\n        color: var(--timeflow-card-text-color, var(--primary-text-color));\n        margin: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      \n      .compact-subtitle {\n        font-size: var(--compact-subtitle-size, 13px);\n        font-weight: 400;\n        line-height: 1.2;\n        color: var(--timeflow-card-text-color, var(--primary-text-color));\n        opacity: 0.7;\n        margin: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      \n      .compact-progress {\n        grid-area: progress;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n      }\n      \n      .compact-progress progress-circle {\n        opacity: 0.9;\n      }\n      \n      @keyframes celebration {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.05); }\n        100% { transform: scale(1); }\n      }\n      \n      /* Dark mode support */\n      @media (prefers-color-scheme: dark) {\n        ha-card {\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        }\n      }\n    `;\n  }\n\n  constructor() {\n    super();\n    // Initialize with proper stub config\n    const stubConfig = TimeFlowCard.getStubConfig();\n    this.config = stubConfig;\n    this._resolvedConfig = stubConfig;\n  }\n\n  // Provide default configuration stub \n  static getStubConfig(): CardConfig {\n    return {\n      type: 'custom:timeflow-card',\n      target_date: '2026-12-31T23:59:59',\n      creation_date: '2025-12-31T23:59:59',\n      timer_entity: '',\n      title: 'New Year Countdown',\n      show_days: true,\n      show_hours: true,\n      show_minutes: true,\n      show_seconds: true,\n      progress_color: '',\n      background_color: \"\",\n      stroke_width: 15,\n      icon_size: 100,\n      expired_animation: false,\n      expired_text: '',\n    };\n  }\n\n  setConfig(config: CardConfig): void {\n    try {\n      // Validate the config with new enhanced validation\n      const validationResult = ConfigValidator.validateConfig(config);\n      this._validationResult = validationResult;\n\n      // Determine if we should proceed with the configuration\n      if (validationResult.hasCriticalErrors) {\n        // Use safe config if available, otherwise use stub config\n        this.config = validationResult.safeConfig || TimeFlowCard.getStubConfig();\n        this._resolvedConfig = { ...this.config };\n      } else if (validationResult.hasWarnings) {\n        // Configuration has warnings - don't proceed with normal flow\n        this.config = { ...config };\n        this._resolvedConfig = { ...config };\n        this._initialized = true; // Set as initialized to show the warning\n        this.requestUpdate();\n        return; // Don't proceed with countdown updates\n      } else {\n        // Configuration is valid\n        this.config = { ...config };\n        this._resolvedConfig = { ...config };\n      }\n\n      this._initialized = false; // Reset initialization flag\n      this.templateService.clearTemplateCache();\n      this.styleManager.clearCache();\n\n      // Trigger immediate update after config change\n      this._updateCountdownAndRender().then(() => {\n        this._initialized = true;\n        this.requestUpdate();\n      });\n    } catch (err) {\n      // Handle unexpected validation errors\n\n      // Create a validation result for unexpected errors\n      this._validationResult = {\n        isValid: false,\n        errors: [{\n          field: 'config',\n          message: (err as Error).message || 'Unexpected configuration error',\n          severity: 'critical',\n          suggestion: 'Check console for details and verify your configuration syntax.',\n          value: config\n        }],\n        hasCriticalErrors: true,\n        hasWarnings: false,\n        safeConfig: TimeFlowCard.getStubConfig()\n      };\n\n      this.config = TimeFlowCard.getStubConfig();\n      this._resolvedConfig = { ...this.config };\n      this._initialized = true; // Make sure we're initialized to render the error\n\n      // Force update to show error message\n      this.requestUpdate();\n    }\n  }\n\n  // Lit lifecycle: Called when component is first updated after initial render\n  firstUpdated(): void {\n    // Set up template service with card reference\n    this.templateService.card = this;\n\n    // FIXED: Initialize immediately on first update\n    this._updateCountdownAndRender().then(() => {\n      this._initialized = true;\n      this.requestUpdate();\n      this._startCountdownUpdates();\n    });\n  }\n\n  // Connect template subscriptions when card is added to DOM\n  connectedCallback(): void {\n    super.connectedCallback();\n    // Connect template service for WebSocket subscriptions\n    this.templateService.connect();\n  }\n\n  // Cleanup on disconnect - unsubscribe from all WebSocket connections\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._stopCountdownUpdates();\n    // Disconnect template service - saves cache and unsubscribes\n    this.templateService.disconnect();\n  }\n\n  updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    if (changedProperties.has('hass') || changedProperties.has('config')) {\n      // Initialize/update localization based on Home Assistant language setting\n      if (this.hass) {\n        this._localize = setupLocalize(this.hass);\n      }\n\n      // Note: With WebSocket subscriptions, templates auto-update when dependencies change.\n      // No manual cache clearing needed - the subscriptions handle freshness automatically.\n      this._updateCountdownAndRender();\n    }\n  }\n\n  /**\n   * Starts ticking the countdown every second\n   */\n  _startCountdownUpdates(): void {\n    this._stopCountdownUpdates(); // clear previous interval\n    this._timerId = setInterval(() => {\n      this._updateCountdownAndRender();\n    }, 1000);\n  }\n\n  /**\n   * Clears the countdown update timer\n   */\n  _stopCountdownUpdates(): void {\n    if (this._timerId) {\n      clearInterval(this._timerId);\n      this._timerId = null;\n    }\n  }\n\n  /**\n   * Resolves templates and updates countdown data, then requests re-render\n   */\n  async _updateCountdownAndRender() {\n    // If we have critical configuration errors, skip updates\n    if (this._validationResult?.hasCriticalErrors) return;\n\n    // Clone config for resolution\n    const resolvedConfig = { ...this.config };\n\n    // List of config keys that can be templates\n    const templateKeys = [\n      'target_date',\n      'creation_date',\n      'timer_entity',\n      'title',\n      'subtitle',\n      'text_color',\n      'background_color',\n      'progress_color',\n      'primary_color',\n      'secondary_color',\n      'expired_text',\n      'header_icon',\n      'header_icon_color',\n      'header_icon_background'\n    ] as const;\n\n    // Resolve templates AND entity IDs where applicable\n    // The resolveValue method handles both templates ({{ }}) and entity IDs (sensor.xxx)\n    // EXCEPTION: timer_entity should NOT be resolved - it must remain as an entity ID\n    // for TimerEntityService to look up directly via hass.states[entityId]\n    for (const key of templateKeys) {\n      if (typeof resolvedConfig[key] === 'string') {\n        // timer_entity should only be resolved if it's a template, not if it's a plain entity ID\n        if (key === 'timer_entity') {\n          if (this.templateService.isTemplate(resolvedConfig[key] as string)) {\n            const resolvedValue = await this.templateService.resolveValue(resolvedConfig[key] as string);\n            resolvedConfig[key] = resolvedValue || undefined;\n          }\n          // Otherwise keep the entity ID as-is\n        } else {\n          const resolvedValue = await this.templateService.resolveValue(resolvedConfig[key] as string);\n          resolvedConfig[key] = resolvedValue || undefined;\n        }\n      }\n    }\n\n    // Store resolved config in reactive state\n    this._resolvedConfig = resolvedConfig;\n\n    // Calculate countdown data\n    await this.countdownService.updateCountdown(resolvedConfig, this.hass);\n\n    // Update countdown state\n    this._countdown = { ...this.countdownService.getTimeRemaining() };\n    this._expired = this.countdownService.isExpired();\n\n    // Calculate progress (0-100)\n    this._progress = await this.countdownService.calculateProgress(resolvedConfig, this.hass);\n\n    this.requestUpdate();\n  }\n\n  render(): TemplateResult {\n    // Handle validation errors and configuration issues\n    if (this._validationResult && !this._validationResult.isValid) {\n      // Show error display for any validation issues (critical errors or warnings)\n      return html`\n        <error-display\n          .errors=\"${this._validationResult.errors}\"\n          .title=\"${this._validationResult.hasCriticalErrors ? 'Configuration Error' : 'Configuration Issues'}\"\n        ></error-display>\n      `;\n    }\n\n    // Choose style based on config\n    const style = this._resolvedConfig.style || 'classic';\n    \n    if (style === 'eventy') {\n      return this._renderEventyCard();\n    }\n    \n    if (style === 'classic-compact') {\n      return this._renderClassicCompactCard();\n    }\n    \n    // Classic: circle progress style\n    return this._renderCard();\n  }\n\n  private _renderCard(): TemplateResult {\n\n    const {\n      title,\n      subtitle,\n      text_color,\n      background_color,\n      progress_color,\n      stroke_width,\n      icon_size,\n      expired_animation = true,\n      expired_text = '',\n      width,\n      height,\n      aspect_ratio,\n      show_months,\n      show_days,\n      show_hours,\n      show_minutes,\n      show_seconds,\n      compact_format\n    } = this._resolvedConfig;\n\n    // Compute effective compact_format state\n    const enabledUnits = [show_months, show_days, show_hours, show_minutes, show_seconds].filter(v => v === true).length;\n    const useCompact = compact_format === true || (compact_format !== false && enabledUnits >= 3);\n\n    // Get card colors using helper\n    const { cardBackground, textColor } = this._getCardColors();\n    const mainProgressColor = progress_color || text_color || 'var(--progress-color, #4caf50)';\n\n    // Calculate dynamic circle size based on card dimensions to prevent overflow\n    const dynamicCircleSize = this.styleManager.calculateDynamicIconSize(width, height, aspect_ratio, icon_size);\n    const dynamicStroke = this.styleManager.calculateDynamicStrokeWidth(dynamicCircleSize, stroke_width);\n\n    // Calculate proportional text sizes\n    const proportionalSizes = this.styleManager.calculateProportionalSizes(width, height, aspect_ratio);\n\n    // Generate dimension styles for the card\n    const dimensionStyles = this.styleManager.generateCardDimensionStyles(width, height, aspect_ratio);\n\n    // FIXED: Compose CSS styles - only override background/color when user explicitly configured them\n    const cardStyles = [\n      ...(cardBackground ? [`background: ${cardBackground}`, `--timeflow-card-background-color: ${cardBackground}`] : []),\n      ...(textColor ? [`color: ${textColor}`, `--timeflow-card-text-color: ${textColor}`, `--progress-text-color: ${textColor}`] : []),\n      `--timeflow-card-progress-color: ${mainProgressColor}`,\n      `--timeflow-card-icon-size: ${dynamicCircleSize}px`,\n      `--timeflow-card-stroke-width: ${dynamicStroke}`,\n      `--timeflow-title-size: ${proportionalSizes.titleSize}rem`,\n      `--timeflow-subtitle-size: ${proportionalSizes.subtitleSize}rem`,\n      ...dimensionStyles\n    ].join('; ');\n\n    // Determine if this is a timer display (timer_entity or auto_discover_*)\n    const isTimerDisplay = this._resolvedConfig.timer_entity || this._resolvedConfig.auto_discover_alexa || this._resolvedConfig.auto_discover_google;\n    // For timers, always use compact format by default (show: 5h30m25s); for countdowns, use the calculated useCompact\n    const timeFormatCompact = isTimerDisplay ? (compact_format !== false) : useCompact;\n\n    // Compose subtitle text\n    let subtitleText: string;\n    if (this._resolvedConfig.timer_entity && this.hass) {\n      const timerData = TimerEntityService.getTimerData(this._resolvedConfig.timer_entity, this.hass);\n      if (timerData) {\n        // If expired and it's an Alexa or Google timer, show dynamic \"timer complete\" text (with label when available)\n        if (this._expired && (timerData.isAlexaTimer || timerData.isGoogleTimer)) {\n          subtitleText = TimerEntityService.getTimerSubtitle(\n            timerData,\n            this._resolvedConfig.show_seconds !== false,\n            this._localize || undefined,\n            timeFormatCompact\n          );\n        } else if (!this._expired) {\n          subtitleText = subtitle || TimerEntityService.getTimerSubtitle(\n            timerData,\n            this._resolvedConfig.show_seconds !== false,\n            this._localize || undefined,\n            timeFormatCompact\n          );\n        } else {\n          subtitleText = expired_text || this.countdownService.getSubtitle(this._resolvedConfig, this.hass, this._localize || undefined, timeFormatCompact);\n        }\n      } else {\n        subtitleText = this._expired ? (expired_text || this.countdownService.getSubtitle(this._resolvedConfig, this.hass, this._localize || undefined, timeFormatCompact)) : (subtitle || this.countdownService.getSubtitle(this._resolvedConfig, this.hass, this._localize || undefined, timeFormatCompact));\n      }\n    } else {\n      // In auto-discovery, always defer to service subtitle (handles Alexa finished/none states)\n      if (this._resolvedConfig.auto_discover_alexa) {\n        subtitleText = subtitle || this.countdownService.getSubtitle(this._resolvedConfig, this.hass, this._localize || undefined, timeFormatCompact);\n      } else {\n        subtitleText = this._expired ? (expired_text || this.countdownService.getSubtitle(this._resolvedConfig, this.hass, this._localize || undefined, timeFormatCompact)) : (subtitle || this.countdownService.getSubtitle(this._resolvedConfig, this.hass, this._localize || undefined, timeFormatCompact));\n      }\n    }\n\n    // Compose title text with fallback using helper\n    const titleText = this._getTitleText();\n\n    // Get card classes using helper\n    const cardClasses = this._getCardClasses(expired_animation);\n\n    // Get action config using helper\n    const { configWithDefaults, shouldEnableActions } = this._getActionConfig();\n\n    return html`\n      <ha-card \n        class=\"${cardClasses}\" \n        style=\"${cardStyles}\"\n        ?actionHandler=${shouldEnableActions}\n        .actionHandler=${shouldEnableActions ? createActionHandler(configWithDefaults) : undefined}\n        @action=${shouldEnableActions && this.hass ? createHandleAction(this.hass, configWithDefaults) : undefined}\n      >\n        <div class=\"card-content\">\n          <header class=\"header\" style=\"${this._resolvedConfig.header_icon ? `--header-icon-container-size: calc(${proportionalSizes.titleSize}rem * 1.3 + ${proportionalSizes.subtitleSize}rem * 1.2 + 2px); --header-icon-size: calc(${proportionalSizes.titleSize}rem * 0.9 + ${proportionalSizes.subtitleSize}rem * 0.7);` : ''}\">\n            ${this._resolvedConfig.header_icon ? html`\n              <div class=\"header-icon\" style=\"${this._resolvedConfig.header_icon_background ? `background: ${this._resolvedConfig.header_icon_background}; border-radius: var(--ha-card-border-radius, 12px);` : ''}\">\n                <ha-icon \n                  icon=\"${this._resolvedConfig.header_icon}\"\n                  style=\"color: ${this._resolvedConfig.header_icon_color || 'var(--primary-text-color)'}\"\n                ></ha-icon>\n              </div>\n            ` : ''}\n            <div class=\"title-section\">\n              <h2 class=\"title\" aria-live=\"polite\">${titleText}</h2>\n              <p class=\"subtitle\" aria-live=\"polite\">${subtitleText}</p>\n            </div>\n          </header>\n          \n          <div class=\"content\" role=\"group\" aria-label=\"Countdown Progress\">\n            <div class=\"progress-section\">\n              <progress-circle\n                class=\"progress-circle\"\n                .progress=\"${this._progress}\"\n                .color=\"${mainProgressColor}\"\n                .size=\"${dynamicCircleSize}\"\n                .strokeWidth=\"${dynamicStroke}\"\n                aria-label=\"Countdown progress: ${Math.round(this._progress)}%\"\n              ></progress-circle>\n            </div>\n          </div>\n        </div>\n      </ha-card>\n    `;\n  }\n\n  /**\n   * Renders the Eventy style - compact horizontal view with icon, title/subtitle, and countdown\n   */\n  private _renderEventyCard(): TemplateResult {\n    const {\n      title,\n      subtitle,\n      text_color,\n      background_color,\n      expired_animation = true,\n      expired_text = '',\n      header_icon = 'mdi:calendar-clock',\n      header_icon_color,\n      header_icon_background,\n      show_months,\n      show_days,\n      show_hours,\n      show_minutes,\n      show_seconds,\n      compact_format\n    } = this._resolvedConfig;\n\n    // Determine the primary countdown unit to display prominently\n    const { primaryValue, primaryUnit } = this._getPrimaryCountdownUnit();\n\n    // Get card colors using helper\n    const { cardBackground, textColor } = this._getCardColors();\n\n    const cardStyles = [\n      ...(cardBackground ? [`background: ${cardBackground}`, `--timeflow-card-background-color: ${cardBackground}`] : []),\n      ...(textColor ? [`color: ${textColor}`, `--timeflow-card-text-color: ${textColor}`] : []),\n    ].join('; ');\n\n    // Get card classes using helper\n    const cardClasses = this._getCardClasses(expired_animation);\n\n    // Compose subtitle text - for Eventy style, show formatted target date\n    let subtitleText: string;\n    if (subtitle) {\n      // Use custom subtitle if provided\n      subtitleText = subtitle;\n    } else if (this._expired) {\n      // Show expired text when countdown is complete\n      subtitleText = expired_text || 'Completed';\n    } else {\n      // Format target date for display (e.g., \"Tue, Feb 3\")\n      subtitleText = this._formatTargetDate();\n    }\n\n    // Get title text using helper\n    const titleText = this._getTitleText();\n\n    // Get action config using helper\n    const { configWithDefaults, shouldEnableActions } = this._getActionConfig();\n\n    return html`\n      <ha-card \n        class=\"${cardClasses}\" \n        style=\"${cardStyles}\"\n        ?actionHandler=${shouldEnableActions}\n        .actionHandler=${shouldEnableActions ? createActionHandler(configWithDefaults) : undefined}\n        @action=${shouldEnableActions && this.hass ? createHandleAction(this.hass, configWithDefaults) : undefined}\n      >\n        <div class=\"card-content-list\">\n          <!-- Icon -->\n          <div \n            class=\"list-icon\" \n            style=\"background: ${header_icon_background || 'rgba(var(--rgb-primary-color, 66, 133, 244), 0.15)'};\"\n          >\n            <ha-icon \n              icon=\"${header_icon}\"\n              style=\"color: ${header_icon_color || 'var(--primary-color, var(--primary-text-color))'}\"\n            ></ha-icon>\n          </div>\n          \n          <!-- Title & Subtitle -->\n          <div class=\"list-title-section\">\n            <h2 class=\"list-title\">${titleText}</h2>\n            <p class=\"list-subtitle\">${subtitleText}</p>\n          </div>\n          \n          <!-- Countdown Display -->\n          <div class=\"list-countdown\">\n            <span class=\"list-countdown-value\">${primaryValue}</span>\n            <span class=\"list-countdown-unit\">${primaryUnit}</span>\n          </div>\n        </div>\n      </ha-card>\n    `;\n  }\n\n  /**\n   * Renders the Classic Compact style - horizontal view with icon, title/subtitle, and progress circle\n   */\n  private _renderClassicCompactCard(): TemplateResult {\n    const {\n      title,\n      subtitle,\n      text_color,\n      background_color,\n      progress_color,\n      stroke_width = 15,\n      icon_size = 100,\n      expired_animation = true,\n      expired_text = '',\n      header_icon = 'mdi:calendar-clock',\n      header_icon_color,\n      header_icon_background,\n      compact_format\n    } = this._resolvedConfig;\n\n    // Get card colors using helper\n    const { cardBackground, textColor } = this._getCardColors();\n\n    const cardStyles = [\n      ...(cardBackground ? [`background: ${cardBackground}`, `--timeflow-card-background-color: ${cardBackground}`] : []),\n      ...(textColor ? [`color: ${textColor}`, `--timeflow-card-text-color: ${textColor}`] : []),\n    ].join('; ');\n\n    // Get card classes using helper\n    const cardClasses = this._getCardClasses(expired_animation);\n\n    // Compose subtitle text - show countdown time like classic\n    const timeFormatCompact = compact_format !== false;\n    let subtitleText: string;\n    if (subtitle) {\n      subtitleText = subtitle;\n    } else if (this._expired) {\n      subtitleText = expired_text || 'Completed';\n    } else {\n      subtitleText = this.countdownService.getSubtitle(this._resolvedConfig, this.hass, this._localize || undefined, timeFormatCompact);\n    }\n\n    // Get title text using helper\n    const titleText = this._getTitleText();\n\n    // Get action config using helper\n    const { configWithDefaults, shouldEnableActions } = this._getActionConfig();\n\n    // Calculate dynamic circle size for compact layout (smaller than classic)\n    const baseCircleSize = icon_size || 100;\n    const compactCircleSize = Math.min(baseCircleSize, 50); // Max 50px for compact\n    const compactStroke = Math.max(4, (stroke_width || 15) * 0.4); // Proportionally thinner\n\n    // Get progress color\n    const mainProgressColor = progress_color || 'var(--primary-color)';\n\n    return html`\n      <ha-card \n        class=\"${cardClasses}\" \n        style=\"${cardStyles}\"\n        ?actionHandler=${shouldEnableActions}\n        .actionHandler=${shouldEnableActions ? createActionHandler(configWithDefaults) : undefined}\n        @action=${shouldEnableActions && this.hass ? createHandleAction(this.hass, configWithDefaults) : undefined}\n      >\n        <div class=\"card-content-compact\">\n          <!-- Icon -->\n          <div \n            class=\"compact-icon\" \n            style=\"background: ${header_icon_background || 'rgba(var(--rgb-primary-color, 66, 133, 244), 0.15)'};\"\n          >\n            <ha-icon \n              icon=\"${header_icon}\"\n              style=\"color: ${header_icon_color || 'var(--primary-color, var(--primary-text-color))'}\"\n            ></ha-icon>\n          </div>\n          \n          <!-- Title & Subtitle -->\n          <div class=\"compact-title-section\">\n            <h2 class=\"compact-title\">${titleText}</h2>\n            <p class=\"compact-subtitle\">${subtitleText}</p>\n          </div>\n          \n          <!-- Progress Circle -->\n          <div class=\"compact-progress\">\n            <progress-circle\n              .progress=\"${this._progress}\"\n              .color=\"${mainProgressColor}\"\n              .size=\"${compactCircleSize}\"\n              .strokeWidth=\"${compactStroke}\"\n              aria-label=\"Countdown progress: ${Math.round(this._progress)}%\"\n            ></progress-circle>\n          </div>\n        </div>\n      </ha-card>\n    `;\n  }\n\n  /**\n   * Gets the primary countdown value and unit to display in Eventy layout\n   * Returns the largest non-zero unit (e.g., \"11\" and \"DAYS\")\n   * Auto-switches to next available unit when current unit reaches 0 (same as Classic style)\n   * Supports localization for multi-language displays\n   */\n  private _getPrimaryCountdownUnit(): { primaryValue: number; primaryUnit: string } {\n    const { months, days, hours, minutes, seconds, total } = this._countdown;\n    const { show_months, show_days, show_hours, show_minutes, show_seconds } = this._resolvedConfig;\n    const t = this._localize || undefined;\n\n    // First, try to return an enabled unit that has a non-zero value\n    if (show_months !== false && months > 0) {\n      return { primaryValue: months, primaryUnit: getLocalizedEventyLabel('month', months, t) };\n    }\n    if (show_days !== false && days > 0) {\n      // Calculate total days including months if months are hidden\n      const totalDays = (show_months === false ? months * 30 : 0) + days;\n      return { primaryValue: totalDays, primaryUnit: getLocalizedEventyLabel('day', totalDays, t) };\n    }\n    if (show_hours !== false && hours > 0) {\n      return { primaryValue: hours, primaryUnit: getLocalizedEventyLabel('hour', hours, t) };\n    }\n    if (show_minutes !== false && minutes > 0) {\n      return { primaryValue: minutes, primaryUnit: getLocalizedEventyLabel('minute', minutes, t) };\n    }\n    if (show_seconds !== false && seconds > 0) {\n      return { primaryValue: seconds, primaryUnit: getLocalizedEventyLabel('second', seconds, t) };\n    }\n\n    // Fallback: All enabled units are zero, calculate from total milliseconds\n    // This handles cases like: user only enabled \"days\" but less than 24 hours remain\n    const totalMs = total || 0;\n    \n    if (totalMs <= 0) {\n      // Countdown is complete\n      return { primaryValue: 0, primaryUnit: show_seconds !== false ? getLocalizedEventyLabel('second', 0, t) : getLocalizedEventyLabel('day', 0, t) };\n    }\n\n    // Calculate fallback values from total milliseconds using shared utility\n    const fallback = parseMillisecondsToUnits(totalMs);\n\n    // Return the highest non-zero fallback unit\n    if (fallback.days > 0) {\n      return { primaryValue: fallback.days, primaryUnit: getLocalizedEventyLabel('day', fallback.days, t) };\n    }\n    if (fallback.hours > 0) {\n      return { primaryValue: fallback.hours, primaryUnit: getLocalizedEventyLabel('hour', fallback.hours, t) };\n    }\n    if (fallback.minutes > 0) {\n      return { primaryValue: fallback.minutes, primaryUnit: getLocalizedEventyLabel('minute', fallback.minutes, t) };\n    }\n    if (fallback.seconds > 0) {\n      return { primaryValue: fallback.seconds, primaryUnit: getLocalizedEventyLabel('second', fallback.seconds, t) };\n    }\n\n    // Truly at zero\n    return { primaryValue: 0, primaryUnit: getLocalizedEventyLabel('second', 0, t) };\n  }\n\n  /**\n   * Formats the target date for display in Eventy style (e.g., \"Tue, Feb 3\")\n   */\n  private _formatTargetDate(): string {\n    const targetDate = this._resolvedConfig.target_date;\n    if (!targetDate) return '';\n\n    try {\n      const date = new Date(targetDate);\n      if (isNaN(date.getTime())) return '';\n\n      // Get user's locale from Home Assistant or browser\n      const locale = this.hass?.locale?.language || navigator.language || 'en';\n\n      // Format: \"Tue, Feb 3\" style\n      const options: Intl.DateTimeFormatOptions = {\n        weekday: 'short',\n        month: 'short',\n        day: 'numeric',\n      };\n\n      return date.toLocaleDateString(locale, options);\n    } catch {\n      return '';\n    }\n  }\n\n  /**\n   * Gets card background and text colors with proper fallbacks\n   */\n  private _getCardColors(): { cardBackground: string; textColor: string } {\n    const { background_color, text_color } = this._resolvedConfig;\n    return {\n      cardBackground: background_color || '',\n      textColor: text_color || ''\n    };\n  }\n\n  /**\n   * Gets card CSS classes based on initialization and expired state\n   */\n  private _getCardClasses(expired_animation: boolean = true): string {\n    return [\n      this._initialized ? 'initialized' : '',\n      (this._expired && expired_animation) ? 'expired' : ''\n    ].filter(Boolean).join(' ');\n  }\n\n  /**\n   * Gets title text with fallback logic for timers and auto-discovery\n   */\n  private _getTitleText(): string {\n    const { title, expired_text = '' } = this._resolvedConfig;\n    \n    if (title !== undefined && title !== null && !(typeof title === 'string' && title.trim() === '')) {\n      return title;\n    }\n    \n    // Fallback: try to get title from timer entity\n    if (this._resolvedConfig.timer_entity && this.hass) {\n      return TimerEntityService.getTimerTitle(this._resolvedConfig.timer_entity, this.hass);\n    }\n    \n    // Fallback: for auto-discovery or expired state\n    if (this._resolvedConfig.auto_discover_alexa || this._resolvedConfig.auto_discover_google) {\n      return 'Countdown Timer';\n    }\n    \n    return this._expired ? expired_text || 'Countdown Timer' : 'Countdown Timer';\n  }\n\n  /**\n   * Gets action handler configuration with proper defaults\n   */\n  private _getActionConfig(): { configWithDefaults: CardConfig; shouldEnableActions: boolean } {\n    const configWithDefaults = { ...this._resolvedConfig };\n    \n    // Map timer_entity to entity field for action handling compatibility\n    if (configWithDefaults.timer_entity && !configWithDefaults.entity) {\n      configWithDefaults.entity = configWithDefaults.timer_entity;\n    }\n    \n    // Set default tap action if entity exists but no tap action defined\n    if (configWithDefaults.entity && !configWithDefaults.tap_action) {\n      configWithDefaults.tap_action = { action: 'more-info' };\n    }\n    \n    const shouldEnableActions = !!(configWithDefaults.tap_action || configWithDefaults.hold_action || configWithDefaults.double_tap_action);\n    \n    return { configWithDefaults, shouldEnableActions };\n  }\n\n  /**\n   * Helper: Returns card size (in Home Assistant's grid rows approx)\n   */\n  getCardSize(): number {\n    const { aspect_ratio = '2/1', height, style } = this.config;\n    \n    // Eventy style is always compact (1 row)\n    if (style === 'eventy') {\n      return 1;\n    }\n    \n    if (height) {\n      const heightValue = parseInt(typeof height === 'string' ? height : height.toString());\n      if (heightValue <= 100) return 1;\n      if (heightValue <= 150) return 2;\n      if (heightValue <= 200) return 3;\n      return 4;\n    }\n    if (aspect_ratio) {\n      const [width, height] = aspect_ratio.split('/').map(Number);\n      if (!width || !height) return 3;\n      const ratio = height / width;\n      if (ratio >= 1.5) return 4;\n      if (ratio >= 1) return 3;\n      if (ratio >= 0.75) return 2;\n      return 2;\n    }\n    return 3;\n  }\n\n  // Static version info\n  static get version() {\n    return '3.2';\n  }\n}","// ProgressCircle.ts\nimport { LitElement, html, css, CSSResult, TemplateResult, PropertyValues } from 'lit';\nimport { property } from 'lit/decorators.js';\n\nexport class ProgressCircle extends LitElement {\n  @property({ type: Number }) progress: number = 0;\n  @property({ type: String }) color: string = '#4CAF50';\n  @property({ type: Number }) size: number = 100;\n  @property({ type: Number }) strokeWidth: number = 15;\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        display: inline-block;\n        vertical-align: middle;\n      }\n      .progress-wrapper {\n        position: relative;\n      }\n      svg {\n        display: block;\n        margin: 0 auto;\n      }\n      .updating {\n        transition: stroke-dashoffset 0.3s ease;\n      }\n    `;\n  }\n\n  constructor() {\n    super();\n    this.progress = 0;\n    this.color = '#4CAF50';\n    this.size = 100;\n    this.strokeWidth = 15;\n  }\n\n  updated(changed: PropertyValues): void {\n    // Animate stroke-dashoffset if progress changes\n    if (changed.has('progress')) {\n      const circle = this.renderRoot?.querySelector('.progress-bar') as HTMLElement;\n      if (circle) {\n        circle.classList.add('updating');\n        setTimeout(() => {\n          if (circle) circle.classList.remove('updating');\n        }, 400);\n      }\n    }\n  }\n\n  // Expose imperative API for external modules, as before\n  updateProgress(progress: number, animate: boolean = true): void {\n    if (animate) {\n      this.progress = progress;\n    } else {\n      // Instantly set progress, skips animation\n      const bar = this.renderRoot?.querySelector('.progress-bar') as HTMLElement;\n      this.progress = progress;\n      if (bar) bar.style.transition = 'none';\n      setTimeout(() => { if (bar) bar.style.transition = ''; }, 20);\n    }\n  }\n\n  getProgress(): number {\n    return this.progress;\n  }\n\n  render(): TemplateResult {\n    const safeProgress = Math.max(0, Math.min(100, Number(this.progress) || 0));\n    const size = Number(this.size) || 100;\n    const stroke = Number(this.strokeWidth) || 15;\n    const radius = (size - stroke) / 2;\n    const circumference = 2 * Math.PI * radius;\n    const offset = circumference - (safeProgress / 100) * circumference;\n\n    return html`\n      <div class=\"progress-wrapper\" style=\"width:${size}px; height:${size}px;\">\n        <svg\n          class=\"progress-circle\"\n          height=\"${size}\" width=\"${size}\"\n          style=\"overflow:visible;\"\n        >\n          <circle\n            class=\"progress-bg\"\n            cx=\"${size / 2}\" cy=\"${size / 2}\"\n            r=\"${radius}\"\n            fill=\"none\"\n            stroke=\"#FFFFFF1A\"\n            stroke-width=\"${stroke}\"\n          ></circle>\n          <circle\n            class=\"progress-bar\"\n            cx=\"${size / 2}\" cy=\"${size / 2}\"\n            r=\"${radius}\"\n            fill=\"none\"\n            stroke=\"${this.color}\"\n            stroke-width=\"${stroke}\"\n            stroke-linecap=\"round\"\n            style=\"\n              stroke-dasharray: ${circumference};\n              stroke-dashoffset: ${offset};\n              transition: stroke-dashoffset 0.3s ease;\n              transform: rotate(-90deg);\n              transform-origin: ${size / 2}px ${size / 2}px;\n            \"\n          ></circle>\n        </svg>\n      </div>\n    `;\n  }\n}","import { LitElement, html, css, TemplateResult, CSSResult, nothing } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { CardConfig } from '../types/index';\n\n/**\n * TimeFlow Card Editor\n * Full-featured graphical editor for the TimeFlow custom card .\n * Emits `config-changed` events with the updated config.\n */\nexport class TimeFlowCardEditor extends LitElement {\n    @property({ type: Object }) hass: any = null;\n    @state() private _config: CardConfig = { type: 'custom:timeflow-card' } as CardConfig;\n\n    // Track which date fields are in \"template mode\"\n    @state() private _targetDateTemplateMode: boolean = false;\n    @state() private _creationDateTemplateMode: boolean = false;\n\n    static get styles(): CSSResult {\n        return css`\n            .section-header {\n                font-weight: 500;\n                font-size: 14px;\n                color: var(--primary-text-color);\n                margin: 16px 0 8px 0;\n                padding-bottom: 4px;\n                border-bottom: 1px solid var(--divider-color);\n            }\n            .section-header:first-of-type {\n                margin-top: 8px;\n            }\n            ha-form {\n                display: block;\n            }\n            \n            /* Date field with mode toggle */\n            .date-field-container {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                margin-bottom: 16px;\n            }\n            .date-field-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n            .date-field-label {\n                font-weight: 500;\n                font-size: 14px;\n                color: var(--primary-text-color);\n            }\n            .mode-toggle {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                font-size: 12px;\n                color: var(--secondary-text-color);\n                cursor: pointer;\n                padding: 4px 8px;\n                border-radius: 4px;\n                background: var(--secondary-background-color);\n                border: none;\n            }\n            .mode-toggle:hover {\n                background: var(--primary-color);\n                color: var(--text-primary-color);\n            }\n            .mode-toggle ha-icon {\n                --mdc-icon-size: 16px;\n            }\n            .date-helper {\n                font-size: 12px;\n                color: var(--secondary-text-color);\n                margin-top: 4px;\n            }\n            ha-textfield, input[type=\"datetime-local\"] {\n                width: 100%;\n            }\n            input[type=\"datetime-local\"] {\n                padding: 12px;\n                border: 1px solid var(--divider-color);\n                border-radius: 4px;\n                background: var(--card-background-color);\n                color: var(--primary-text-color);\n                font-size: 14px;\n            }\n            input[type=\"datetime-local\"]:focus {\n                outline: none;\n                border-color: var(--primary-color);\n            }\n            .date-fields-section {\n                display: flex;\n                flex-direction: column;\n                gap: 16px;\n                padding: 16px 0;\n            }\n        `;\n    }\n\n    setConfig(config: CardConfig) {\n        this._config = { ...config } as CardConfig;\n\n        // Auto-detect if existing values are templates\n        const targetDate = config.target_date || '';\n        const creationDate = config.creation_date || '';\n        this._targetDateTemplateMode = this._isTemplate(targetDate);\n        this._creationDateTemplateMode = this._isTemplate(creationDate);\n    }\n\n    private _isTemplate(value: string): boolean {\n        return value.includes('{{') || value.includes('{%');\n    }\n\n    private _convertToDatetimeLocal(isoDate: string): string {\n        if (!isoDate || this._isTemplate(isoDate)) return '';\n        // Convert ISO format to datetime-local format (YYYY-MM-DDTHH:MM)\n        // Use local time components to avoid timezone shift from toISOString()\n        try {\n            const date = new Date(isoDate);\n            if (isNaN(date.getTime())) return '';\n            const year = date.getFullYear();\n            const month = String(date.getMonth() + 1).padStart(2, '0');\n            const day = String(date.getDate()).padStart(2, '0');\n            const hours = String(date.getHours()).padStart(2, '0');\n            const minutes = String(date.getMinutes()).padStart(2, '0');\n            return `${year}-${month}-${day}T${hours}:${minutes}`;\n        } catch {\n            return '';\n        }\n    }\n\n    private _convertFromDatetimeLocal(localDate: string): string {\n        if (!localDate) return '';\n        // Convert datetime-local to ISO format with seconds\n        return localDate + ':00';\n    }\n\n    private _fireConfigChanged(config: CardConfig) {\n        this.dispatchEvent(new CustomEvent('config-changed', {\n            detail: { config },\n            bubbles: true,\n            composed: true\n        }));\n    }\n\n    private _formChanged(ev: CustomEvent) {\n        const value = ev.detail?.value || {};\n        // Merge with existing config and keep the card type\n        const newConfig = { ...(this._config || {}), ...value, type: this._config?.type || 'custom:timeflow-card' } as CardConfig;\n        this._config = newConfig;\n        this._fireConfigChanged(newConfig);\n    }\n\n    private _computeHelper(schema: any): string {\n        const helpers: Record<string, string> = {\n            // Timer Source\n            'timer_entity': 'Select a timer, sensor, or input_datetime entity',\n            'target_date': 'ISO date, entity, or template: \"2024-12-31T23:59:59\", \"{{ states(\\'input_datetime.deadline\\') }}\"',\n            'creation_date': 'Start date for progress calculation (optional)',\n            'auto_discover_alexa': 'Automatically find active Alexa timers',\n            'auto_discover_google': 'Automatically find active Google Home timers',\n            'alexa_device_filter': 'Comma-separated list of Alexa device names or IDs to filter timers (e.g., \"Kitchen, Living Room\")',\n            'prefer_labeled_timers': 'Prefer timers with labels over unnamed ones',\n\n            // Display\n            'title': 'Card title - supports templates: \"{{ states(\\'sensor.event_name\\') }}\"',\n            'subtitle': 'Shows time remaining by default; only set for custom text',\n            'subtitle_prefix': 'Text before countdown (e.g., \"in\", \"Only\")',\n            'subtitle_suffix': 'Text after countdown (e.g., \"left\", \"remaining\")',\n            'expired_text': 'Text shown when countdown completes',\n            'compact_format': '\"2d 5h 30m\" vs \"2 days 5 hours 30 minutes\"',\n\n            // Colors\n            'progress_color': 'Progress circle color (hex, name, rgb, or template)',\n            'background_color': 'Card background color',\n            'text_color': 'Text color for title and countdown',\n\n            // Layout\n            'width': 'Card width (e.g., \"300px\", \"100%\", \"20em\")',\n            'height': 'Card height (e.g., \"200px\", \"auto\")',\n            'aspect_ratio': 'Width:height ratio (e.g., \"16/9\", \"4/3\", \"1/1\")',\n\n            // Progress Circle\n            'stroke_width': 'Thickness of the progress circle ring',\n            'icon_size': 'Size of the progress circle',\n\n            // Header Icon\n            'header_icon': 'Material Design icon name (e.g., \"mdi:cake-variant\")',\n            'header_icon_color': 'Icon color (hex, name, or template)',\n            'header_icon_background': 'Icon background (e.g., \"rgba(59, 130, 246, 0.2)\")',\n\n            // Style\n            'style': 'Card style: Classic (vertical with circle), Eventy (compact horizontal), Classic Compact (horizontal with circle)',\n        };\n        return helpers[schema.name] || '';\n    }\n\n    private _computeLabel(schema: any): string {\n        if (schema.label)\n            return schema.label;\n\n        const labels: Record<string, string> = {\n            'timer_entity': 'Timer Entity',\n            'target_date': 'Target Date/Time',\n            'creation_date': 'Start Date (for progress)',\n            'auto_discover_alexa': 'Auto-discover Alexa Timers',\n            'auto_discover_google': 'Auto-discover Google Timers',\n            'alexa_device_filter': 'Alexa Device Filter',\n            'prefer_labeled_timers': 'Prefer Labeled Timers',\n            'show_alexa_device': 'Show Alexa Device Name',\n            'show_days': 'Days',\n            'show_hours': 'Hours',\n            'show_minutes': 'Minutes',\n            'show_seconds': 'Seconds',\n            'show_months': 'Months',\n            'compact_format': 'Compact Format',\n            'subtitle_prefix': 'Subtitle Prefix',\n            'subtitle_suffix': 'Subtitle Suffix',\n            'expired_animation': 'Expired Animation',\n            'expired_text': 'Expired Text',\n            'progress_color': 'Progress Color',\n            'background_color': 'Background Color',\n            'text_color': 'Text Color',\n            'stroke_width': 'Stroke Width',\n            'icon_size': 'Circle Size',\n            'aspect_ratio': 'Aspect Ratio',\n            'header_icon': 'Header Icon',\n            'header_icon_color': 'Icon Color',\n            'header_icon_background': 'Icon Background',\n            'style': 'Card Style',\n        };\n\n        if (labels[schema.name]) return labels[schema.name];\n\n        const key = (schema.name ?? '').toString();\n        if (!key) return '';\n        return key\n            .split('_')\n            .map((part: string) => part.charAt(0).toUpperCase() + part.slice(1))\n            .join(' ');\n    }\n\n    private _renderDateField(\n        configKey: 'target_date' | 'creation_date',\n        label: string,\n        helper: string,\n        templateMode: boolean,\n        toggleCallback: () => void\n    ): TemplateResult {\n        const value = this._config[configKey] || '';\n\n        return html`\n            <div class=\"date-field-container\">\n                <div class=\"date-field-header\">\n                    <span class=\"date-field-label\">${label}</span>\n                    <button \n                        class=\"mode-toggle\" \n                        @click=${toggleCallback}\n                        title=${templateMode ? 'Switch to date picker' : 'Switch to template/Jinja mode'}\n                    >\n                        <ha-icon icon=${templateMode ? 'mdi:calendar' : 'mdi:code-braces'}></ha-icon>\n                        ${templateMode ? 'Picker' : 'Template'}\n                    </button>\n                </div>\n                \n                ${templateMode\n                ? html`\n                        <ha-textfield\n                            .value=${value}\n                            .placeholder=${'{{ states(\\'input_datetime.my_date\\') }}'}\n                            @input=${(e: Event) => this._updateDateField(configKey, (e.target as HTMLInputElement).value)}\n                        ></ha-textfield>\n                        <div class=\"date-helper\">Enter Jinja template, entity, or ISO date string</div>\n                    `\n                : html`\n                        <input \n                            type=\"datetime-local\"\n                            .value=${this._convertToDatetimeLocal(value)}\n                            @input=${(e: Event) => this._updateDateField(configKey, this._convertFromDatetimeLocal((e.target as HTMLInputElement).value))}\n                        />\n                        <div class=\"date-helper\">${helper}</div>\n                    `\n            }\n            </div>\n        `;\n    }\n\n    private _updateDateField(configKey: string, value: string): void {\n        const newConfig = { ...this._config, [configKey]: value };\n        this._config = newConfig as CardConfig;\n        this._fireConfigChanged(newConfig as CardConfig);\n    }\n\n    private _toggleTargetDateMode(): void {\n        this._targetDateTemplateMode = !this._targetDateTemplateMode;\n    }\n\n    private _toggleCreationDateMode(): void {\n        this._creationDateTemplateMode = !this._creationDateTemplateMode;\n    }\n\n    /**\n     * Compute the effective compact_format state for display\n     * Auto-enables when 3+ units are selected (unless explicitly disabled)\n     */\n    private _getEffectiveCompactFormat(): boolean {\n        const { show_months, show_days, show_hours, show_minutes, show_seconds, compact_format } = this._config;\n\n        // If explicitly set, use that value\n        if (compact_format !== undefined) {\n            return compact_format;\n        }\n\n        // Otherwise, auto-enable if 3+ units are shown\n        const enabledUnits = [show_months, show_days, show_hours, show_minutes, show_seconds].filter(v => v === true).length;\n        return enabledUnits >= 3;\n    }\n\n    render(): TemplateResult {\n        const cfg = this._config || {};\n\n        // Create a display config that shows the effective compact_format state\n        const displayCfg = {\n            ...cfg,\n            // Show the effective compact_format value for UI consistency\n            compact_format: this._getEffectiveCompactFormat()\n        };\n\n        const schema = [\n            // \n            // CARD STYLE - Choose card appearance\n            // \n            { \n                name: 'style', \n                selector: { \n                    select: { \n                        options: [\n                            { value: 'classic', label: 'Classic (Circle Progress)' },\n                            { value: 'eventy', label: 'Eventy (Compact Horizontal)' },\n                            { value: 'classic-compact', label: 'Classic Compact (Horizontal + Circle)' }\n                        ],\n                        mode: 'dropdown'\n                    } \n                } \n            },\n\n            // \n            // TIMER SOURCE - Most important, always visible at top\n            // \n            { name: 'timer_entity', selector: { entity: { domain: ['timer', 'sensor', 'input_datetime'] } } },\n\n            // Smart Assistant Auto-Discovery (visible toggles)\n            {\n                type: 'grid',\n                schema: [\n                    { name: 'auto_discover_alexa', selector: { boolean: {} } },\n                    { name: 'auto_discover_google', selector: { boolean: {} } },\n                ]\n            },\n\n            // \n            // DISPLAY - Title, subtitle, and expired text\n            // \n            { name: 'title', selector: { text: {} } },\n            { name: 'subtitle', selector: { text: {} } },\n            {\n                type: 'grid',\n                schema: [\n                    { name: 'subtitle_prefix', selector: { text: {} } },\n                    { name: 'subtitle_suffix', selector: { text: {} } },\n                ]\n            },\n            { name: 'expired_text', selector: { text: {} } },\n\n            // \n            // HEADER ICON - Expandable\n            // \n            {\n                type: \"expandable\",\n                title: \"Header Icon\",\n                icon: \"mdi:image-filter-vintage\",\n                schema: [\n                    { name: 'header_icon', selector: { icon: {} } },\n                    {\n                        type: 'grid',\n                        schema: [\n                            { name: 'header_icon_color', selector: { text: {} } },\n                            { name: 'header_icon_background', selector: { text: {} } },\n                        ]\n                    },\n                ]\n            },\n\n            // \n            // TIME UNITS - Always visible as grid\n            // \n            {\n                type: 'grid',\n                schema: [\n                    { name: 'show_months', selector: { boolean: {} } },\n                    { name: 'show_days', selector: { boolean: {} } },\n                    { name: 'show_hours', selector: { boolean: {} } },\n                    { name: 'show_minutes', selector: { boolean: {} } },\n                    { name: 'show_seconds', selector: { boolean: {} } },\n                    { name: 'compact_format', selector: { boolean: {} } },\n                ]\n            },\n\n            // \n            // APPEARANCE - Expandable (secondary settings)\n            // \n            {\n                type: \"expandable\",\n                title: \"Appearance\",\n                icon: \"mdi:palette\",\n                schema: [\n                    { name: 'progress_color', selector: { text: {} } },\n                    { name: 'background_color', selector: { text: {} } },\n                    { name: 'text_color', selector: { text: {} } },\n                    { name: 'expired_animation', selector: { boolean: {} } },\n                ]\n            },\n\n            // \n            // LAYOUT - Expandable\n            // \n            {\n                type: \"expandable\",\n                title: \"Layout\",\n                icon: \"mdi:page-layout-body\",\n                schema: [\n                    {\n                        type: 'grid',\n                        schema: [\n                            { name: 'width', selector: { text: {} } },\n                            { name: 'height', selector: { text: {} } },\n                        ]\n                    },\n                    { name: 'aspect_ratio', selector: { text: {} } },\n                ]\n            },\n\n            // \n            // PROGRESS CIRCLE - Expandable\n            // \n            {\n                type: \"expandable\",\n                title: \"Progress Circle\",\n                icon: \"mdi:circle-slice-3\",\n                schema: [\n                    {\n                        type: \"grid\",\n                        schema: [\n                            { name: 'stroke_width', selector: { number: { min: 1, max: 50, step: 1 } } },\n                            { name: 'icon_size', selector: { number: { min: 10, max: 350, step: 5 } } },\n                        ]\n                    },\n                ]\n            },\n\n            // \n            // ALEXA/GOOGLE OPTIONS - Expandable\n            // \n            {\n                type: \"expandable\",\n                title: \"Smart Assistant Options\",\n                icon: \"mdi:home-assistant\",\n                schema: [\n                    { name: 'alexa_device_filter', selector: { text: {} } },\n                    { name: 'prefer_labeled_timers', selector: { boolean: {} } },\n                    { name: 'show_alexa_device', selector: { boolean: {} } },\n                ]\n            },\n\n            // \n            // ACTIONS - Expandable\n            // \n            {\n                type: \"expandable\",\n                title: \"Tap Actions\",\n                icon: \"mdi:gesture-tap\",\n                schema: [\n                    { name: 'tap_action', selector: { ui_action: {} } },\n                    { name: 'hold_action', selector: { ui_action: {} } },\n                    { name: 'double_tap_action', selector: { ui_action: {} } },\n                ]\n            },\n        ];\n\n        return html`\n            <!-- Date Fields with Template Toggle -->\n            <div class=\"date-fields-section\">\n                ${this._renderDateField(\n            'target_date',\n            'Target Date',\n            'Date/time when countdown ends',\n            this._targetDateTemplateMode,\n            () => this._toggleTargetDateMode()\n        )}\n                \n                ${this._renderDateField(\n            'creation_date',\n            'Creation Date',\n            'Start date (defaults to now)',\n            this._creationDateTemplateMode,\n            () => this._toggleCreationDateMode()\n        )}\n            </div>\n            \n            <ha-form\n                .hass=${this.hass}\n                .data=${displayCfg}\n                .schema=${schema}\n                @value-changed=${(e: CustomEvent) => this._formChanged(e)}\n                .computeLabel=${this._computeLabel}\n                .computeHelper=${this._computeHelper}\n            ></ha-form>\n        `;\n    }\n\n}\n\nexport default TimeFlowCardEditor;\n","/**\n * TimeFlow Card - Entry point for modular architecture with Lit components\n * Registers Lit-based custom elements and exposes the card to Home Assistant\n */\n\n// Type declarations for Home Assistant globals\ndeclare global {\n  interface Window {\n    customCards?: Array<{\n      type: string;\n      name: string;\n      description: string;\n      preview?: boolean;\n      documentationURL?: string;\n    }>;\n  }\n}\n\nimport { TimeFlowCard } from './components/TimeFlowCard';\nimport { ProgressCircle } from './components/ProgressCircle';\nimport { ErrorDisplay } from './utils/ErrorDisplay';\nimport { TimeFlowCardEditor } from './components/TimeFlowCardEditor';\n\n// Register Lit custom elements with duplicate protection\nif (!customElements.get('error-display')) {\n  customElements.define('error-display', ErrorDisplay);\n} else {\n  // Component already registered\n}\n\nif (!customElements.get('progress-circle')) {\n  customElements.define('progress-circle', ProgressCircle);\n} else {\n  // Component already registered\n}\n\nif (!customElements.get('timeflow-card')) {\n  customElements.define('timeflow-card', TimeFlowCard);\n} else {\n  // Component already registered\n}\n\nif (!customElements.get('timeflow-card-editor')) {\n  customElements.define('timeflow-card-editor', TimeFlowCardEditor);\n} else {\n  // Component already registered\n}\n\n// Register the card with Home Assistant\nwindow.customCards = window.customCards || [];\nwindow.customCards.push({\n  type: 'timeflow-card',\n  name: 'TimeFlow Card',\n  description: 'A beautiful countdown timer card with progress circle for Home Assistant, using Lit',\n  preview: true,\n  documentationURL: 'https://github.com/Rishi8078/TimeFlow-Card' // Update if needed\n});\n\n// Export main classes for external use or testing\nexport { TimeFlowCard, ProgressCircle, ErrorDisplay, TimeFlowCardEditor };"],"names":["__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","SuppressedError","t","globalThis","e","ShadowRoot","ShadyCSS","nativeShadow","Document","prototype","CSSStyleSheet","s","Symbol","o","WeakMap","n$3","constructor","this","_$cssResult$","Error","cssText","styleSheet","get","replaceSync","set","toString","reduce","n","cssRules","is","h","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","a","trustedTypes","l","emptyScript","p","reactiveElementPolyfillSupport","u","toAttribute","Boolean","Array","JSON","stringify","fromAttribute","Number","parse","f","b","attribute","type","String","converter","reflect","useDefault","hasChanged","metadata","litPropertyMetadata","HTMLElement","addInitializer","_$Ei","push","observedAttributes","finalize","_$Eh","keys","createProperty","state","hasOwnProperty","create","wrapped","elementProperties","noAccessor","getPropertyDescriptor","call","requestUpdate","configurable","enumerable","getPropertyOptions","Map","finalized","properties","_$Eu","elementStyles","finalizeStyles","styles","isArray","Set","flat","reverse","unshift","toLowerCase","super","_$Ep","isUpdatePending","hasUpdated","_$Em","_$Ev","_$ES","Promise","enableUpdating","_$AL","_$E_","forEach","addController","_$EO","add","renderRoot","isConnected","hostConnected","removeController","delete","size","createRenderRoot","shadowRoot","attachShadow","shadowRootOptions","adoptedStyleSheets","map","document","createElement","litNonce","setAttribute","textContent","appendChild","connectedCallback","disconnectedCallback","hostDisconnected","attributeChangedCallback","_$AK","_$ET","removeAttribute","_$Ej","hasAttribute","C","_$EP","has","_$Eq","reject","scheduleUpdate","performUpdate","shouldUpdate","willUpdate","hostUpdate","update","_$EM","_$AE","hostUpdated","firstUpdated","updated","updateComplete","getUpdateComplete","y","mode","ReactiveElement","reactiveElementVersions","createPolicy","createHTML","Math","random","toFixed","slice","createComment","v","_","m","RegExp","g","$","x","_$litType$","strings","values","T","for","E","A","createTreeWalker","P","V","lastIndex","exec","test","startsWith","N","parts","el","currentNode","content","firstChild","replaceWith","childNodes","nextNode","nodeType","hasAttributes","getAttributeNames","endsWith","getAttribute","split","index","name","ctor","H","I","L","k","tagName","append","data","indexOf","innerHTML","S","_$Co","_$Cl","_$litDirective$","_$AO","_$AT","_$AS","M","_$AV","_$AN","_$AD","_$AM","parentNode","_$AU","creationScope","importNode","R","nextSibling","z","_$AI","_$Cv","_$AH","_$AA","_$AB","options","startNode","endNode","_$AR","iterator","O","insertBefore","createTextNode","_$AC","_$AP","remove","setConnected","element","fill","j","toggleAttribute","capture","once","passive","removeEventListener","addEventListener","handleEvent","host","litHtmlPolyfillSupport","litHtmlVersions","renderOptions","_$Do","renderBefore","render","_$litPart$","_$litElement$","litElementHydrateSupport","LitElement","litElementPolyfillSupport","litElementVersions","kind","init","StandardTimerService","getStandardTimerData","entityId","entity","parseDuration","attributes","isActive","isPaused","isIdle","duration","remaining","finishesAt","finishes_at","Date","isNaN","getTime","max","floor","now","progress","elapsed","min","isAlexaTimer","AlexaTimerService","getAlexaTimerData","hass","isISOTimestamp","activeTimers","_a","parseJson","sorted_active","allTimers","_b","sorted_all","totalActive","_d","_c","total_active","totalAll","_f","_e","total_all","activeMap","entry","extractTimerEntry","id","allMap","nowTs","cache","alexaIdCache","finishedActiveIds","entries","trig","triggerTime","sort","finishedWhileActiveId","primaryId","isFinished","primaryTimer","_g","_h","bestId","best","shortest","POSITIVE_INFINITY","_j","remainingTime","mostRecentPaused","latest","Infinity","status","lastUpdatedDate","rtMs","odMs","originalDurationInMillis","parseFloat","includes","original_duration","last_changed","start","end","label","extractTimerLabel","firstActive","firstAll","finished","alexaDevice","extractAlexaDevice","timerLabel","timerStatus","userDefinedLabel","parseLegacyAlexaTimer","hasOriginalDuration","startTime","endTime","lastChanged","timeSinceChanged","estimatedDuration","friendly_name","timer_label","formatAlexaTimerName","undefined","discoverAlexaTimers","getTimerData","states","alexaTimers","hasActive","hasPaused","timerData","src","deviceName","replace","trim","devicePart","toUpperCase","device_name","device","GoogleTimerService","getGoogleTimerData","timers","entityCache","googleIdCache","finishedTimerId","lastDuration","lastLabel","isGoogleTimer","googleTimerId","googleTimerStatus","allTimersMap","timer","timer_id","finishedCandidates","timerId","fire_time","fireTime","finishedTimer","some","primaryTimerId","earliestFireTime","statusStr","isRinging","pausedSnapshots","previousSnapshot","fireTimeMs","pausedAt","wasActive","discoverGoogleTimers","googleTimers","clearFinishedTimer","TimerEntityService","isTimerEntity","str","seconds","formatRemainingTime","showSeconds","localize","useCompact","hours","minutes","padStart","hourUnit","minUnit","secUnit","join","getTimerTitle","customTitle","formatGoogleTimerName","isTimerExpired","getTimerSubtitle","time","getTimerStateColor","defaultColor","DateParser","parseISODate","dateString","manualResult","parseISODateManual","nativeResult","isValidDateResult","parseISODateFallback","dateObj","originalString","timestamp","minTimestamp","maxTimestamp","year","getFullYear","isLeapYear","datePart","timePart","month","day","isValidDateComponents","hour","minute","second","isValidTimeComponents","parseInt","error","ConfigValidator","validateConfig","config","errors","field","message","severity","suggestion","value","isValid","hasCriticalErrors","hasWarnings","target_date","isValidDateInput","timer_entity","auto_discover_alexa","auto_discover_google","isValidEntityId","creation_date","isValidColorInput","isValidDimensionInput","aspect_ratio","isValidAspectRatioInput","stroke_width","isValidNumberInput","isValidBooleanInput","isValidTextInput","isValidStylesInput","_addHelpfulValidations","safeConfig","_generateSafeConfig","criticalErrors","filter","warnings","tomorrow","setDate","getDate","toISOString","background_color","progress_color","icon_size","validateConfigLegacy","result","isTemplate","date","pxMatch","match","px","percentMatch","percent","validUnits","unit","regex","unitValue","aspectMatch","width","height","parsed","pattern","validStyleKeys","styleKeys","every","templateCache","expiration","_cache","_expiration","window","setTimeout","clear","TemplateService","_unsubRenderTemplates","_templateResults","_connected","connect","template","disconnect","unsubPromise","err","code","console","warn","_subscribeToTemplate","card","connection","sub","conn","onChange","params","variables","user","strict","subscribeMessage","msg","fallback","extractFallbackFromTemplate","listeners","all","domains","entities","unsubscribeFromTemplate","evaluateTemplate","cached","innerTemplate","simpleOrPattern","simpleOrMatch","chainedOrPattern","chainedMatch","conditionalPattern","conditionalMatch","reverseConditionalPattern","reverseMatch","isValidTemplate","resolveValue","clearTemplateCache","hasTemplatesInConfig","prop","escapeHtml","text","MS_PER_SECOND","MS_PER_MINUTE","MS_PER_HOUR","MS_PER_DAY","SECONDS_PER_MINUTE","SECONDS_PER_HOUR","parseMillisecondsToUnits","ms","days","TIME_UNIT_LABELS","eventy","singular","plural","mainDisplay","getUnitLabel","style","labels","EVENTY_TRANSLATION_KEYS","getLocalizedEventyLabel","CountdownService","templateService","dateParser","timeRemaining","months","total","expired","lastAlexaTimerData","_calculateCalendarMonths","nowDate","targetDate","remainingMs","tempDate","nextMonth","setMonth","getMonth","_findBestSmartTimer","smartTimers","priorities","predicate","find","updateCountdown","_timerDataToCountdownState","smartTimer","targetDateValue","difference","show_months","show_days","show_hours","show_minutes","show_seconds","totalMilliseconds","targetDateObj","calendarResult","additionalResult","extraHours","extraMinutes","extraSeconds","calculateProgress","creationDate","creationDateValue","totalDuration","getMainDisplay","getSubtitle","expired_text","compact_format","subtitle_prefix","subtitle_suffix","applyPrefixSuffix","compact","charAt","units","totalSeconds","getTimeRemaining","isExpired","getAvailableAlexaTimers","getAvailableGoogleTimers","getCurrentTimerEntity","StyleManager","dynamicIconSize","dynamicStrokeWidth","customStyles","lastConfigHash","processStyles","buildStylesObject","configHash","processedStyles","title","subtitle","progress_circle","_getCardDimensions","defaultWidth","defaultHeight","cardWidth","cardHeight","parseDimension","ratioW","ratioH","calculateDynamicIconSize","configKey","lastIconConfigHash","proportionalSize","baseSize","MIN_ICON_SIZE","MAX_ICON_SIZE","calculateDynamicStrokeWidth","iconSize","lastStrokeConfigHash","MIN_STROKE","MAX_STROKE","ratio","calculated","round","calculateProportionalSizes","defaultArea","scaleFactor","sqrt","titleSize","subtitleSize","dimension","dimStr","pixels","generateCardDimensionStyles","cardStyles","formattedWidth","_formatDimensionValue","formattedHeight","strValue","numValue","clearCache","getCardDimensions","languages","en","complete","complete_with_label","paused","paused_with_time","paused_without_label","paused_alexa","ready","ready_with_time","no_timers","no_timers_device","no_timers_google","remaining_with_label","remaining_with_device","paused_time_left","google_paused","timer_ready","countdown","starting","completed","hour_compact","day_compact","month_compact","minute_compact","second_compact","hour_full","hours_full","day_full","days_full","month_full","months_full","minute_full","minutes_full","second_full","seconds_full","month_eventy","months_eventy","day_eventy","days_eventy","hour_eventy","hours_eventy","minute_eventy","minutes_eventy","second_eventy","seconds_eventy","fr","de","es","it","nl","getTranslatedString","lang","obj","setupLocalize","argObject","translated","locale","language","args","formatString","_$Ct","_$Ci","handleAction","node","_hass","action","detail","event","CustomEvent","bubbles","cancelable","composed","dispatchEvent","fireEvent","actionHandlerBind","actionhandler","body","querySelector","getActionHandler","bind","actionHandler","directive","Directive","part","noChange","_options","hasAction","createActionHandler","hasHold","hold_action","hasDoubleClick","double_tap_action","createHandleAction","ev","ErrorDisplay","css","html","relevantErrors","property","TimeFlowCard","getConfigElement","getStubConfig","_resolvedConfig","_progress","_countdown","_expired","_validationResult","_initialized","_localize","_timerId","countdownService","styleManager","stubConfig","expired_animation","setConfig","validationResult","_updateCountdownAndRender","then","_startCountdownUpdates","_stopCountdownUpdates","changedProperties","setInterval","clearInterval","resolvedConfig","templateKeys","resolvedValue","_renderEventyCard","_renderClassicCompactCard","_renderCard","text_color","enabledUnits","cardBackground","textColor","_getCardColors","mainProgressColor","dynamicCircleSize","dynamicStroke","proportionalSizes","dimensionStyles","timeFormatCompact","subtitleText","titleText","_getTitleText","cardClasses","_getCardClasses","configWithDefaults","shouldEnableActions","_getActionConfig","header_icon","header_icon_background","header_icon_color","primaryValue","primaryUnit","_getPrimaryCountdownUnit","_formatTargetDate","baseCircleSize","compactCircleSize","compactStroke","totalDays","totalMs","navigator","weekday","toLocaleDateString","tap_action","getCardSize","heightValue","version","ProgressCircle","color","strokeWidth","changed","circle","classList","updateProgress","animate","bar","transition","getProgress","safeProgress","stroke","radius","circumference","PI","offset","TimeFlowCardEditor","_config","_targetDateTemplateMode","_creationDateTemplateMode","_isTemplate","_convertToDatetimeLocal","isoDate","getHours","getMinutes","_convertFromDatetimeLocal","localDate","_fireConfigChanged","_formChanged","newConfig","_computeHelper","schema","alexa_device_filter","prefer_labeled_timers","_computeLabel","show_alexa_device","_renderDateField","helper","templateMode","toggleCallback","_updateDateField","_toggleTargetDateMode","_toggleCreationDateMode","_getEffectiveCompactFormat","displayCfg","selector","select","domain","boolean","icon","number","step","ui_action","customElements","define","customCards","description","preview","documentationURL"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,19]}